
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7.2. Workflow Automation &#8212; Effective Python for Data Scientists</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "ðŸ’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.3. Code Review" href="code_review.html" />
    <link rel="prev" title="7.1. Alternative Approach" href="alternative_approach.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/data_simplified_icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Effective Python for Data Scientists</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    Efficient Python Tricks and Tools for Data Scientists
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../how_to_read.html">
   1. How to Read This Book
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter1/Chapter1.html">
   2. Python Built-in Methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/string.html">
     2.1. String
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/number.html">
     2.2. Number
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Chapter1/list/list.html">
     2.3. List
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/get_elements.html">
       2.3.1. Get Elements
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/unpack_iterables.html">
       2.3.2. Unpack Iterables
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/join_iterable.html">
       2.3.3. Join Iterables
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/interaction_between_2_lists.html">
       2.3.4. Interaction Between 2 Lists
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/apply_functions_to_elements.html">
       2.3.5. Apply Functions to Elements in a List
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/dictionary.html">
     2.4. Dictionary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/function.html">
     2.5. Function
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/class.html">
     2.6. Classes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/datetime.html">
     2.7. Datetime
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/code_speed.html">
     2.8. Code Speed
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/good_practices.html">
     2.9. Good Python Practices
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter2/Chapter2.html">
   3. Python Utility Libraries
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/collections.html">
     3.1. Collections
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/itertools.html">
     3.2. Itertools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/functools.html">
     3.3. Functools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/pydash.html">
     3.4. Pydash
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/sympy.html">
     3.5. SymPy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/operator.html">
     3.6. Operator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/dataclasses.html">
     3.7. Data Classes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/typing.html">
     3.8. Typing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/pathlib.html">
     3.9. pathlib
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter3/Chapter3.html">
   4. Pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/change_values.html">
     4.1. Change Values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/get_values.html">
     4.2. Get Certain Values From a DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/date_time.html">
     4.3. Work with Datetime
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/transform_dataframe.html">
     4.4. Transform a DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/create_dataframe.html">
     4.5. Create a DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/combine_dataframes.html">
     4.6. Combine Multiple DataFrames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/filter.html">
     4.7. Filter Rows or Columns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/data_types.html">
     4.8. Manipulate a DataFrame Using Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/sort_dataframe.html">
     4.9. Sort Rows or Columns of a DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/string.html">
     4.10. Work with String
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/style_dataframe.html">
     4.11. Style a DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/testing.html">
     4.12. Test
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter4/Chapter4.html">
   5. NumPy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter4/Numpy.html">
     5.1. NumPy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter5/Chapter5.html">
   6. Data Science Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/feature_extraction.html">
     6.1. Feature Extraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/feature_engineer.html">
     6.2. Feature Engineer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/get_data.html">
     6.3. Get Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/manage_data.html">
     6.4. Manage Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/machine_learning.html">
     6.5. Machine Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/natural_language_processing.html">
     6.6. Natural Language Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/time_series.html">
     6.7. Time Series
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/sharing_downloading.html">
     6.8. Sharing and Downloading
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/speed_up_code.html">
     6.9. Tools to Speed Up Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/visualization.html">
     6.10. Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/best_python_practice_tools.html">
     6.11. Tools for Best Python Practices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/better_pandas.html">
     6.12. Better Pandas
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter5/testing.html">
     6.13. Testing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Chapter6.html">
   7. Cool Tools
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="alternative_approach.html">
     7.1. Alternative Approach
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     7.2. Workflow Automation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="code_review.html">
     7.3. Code Review
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="logging_debugging.html">
     7.4. Logging and Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="better_outputs.html">
     7.5. Better Outputs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="git_github.html">
     7.6. Git and GitHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="env_management.html">
     7.7. Environment Management
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter7/Chapter7.html">
   8. Jupyter Notebook
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter7/jupyter_notebook.html">
     8.1. Jupyter Notebook
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/master?urlpath=tree/./Chapter6/workflow_automation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/blob/master/./Chapter6/workflow_automation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/issues/new?title=Issue%20on%20page%20%2FChapter6/workflow_automation.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/Chapter6/workflow_automation.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schedule-schedule-your-python-functions-to-run-at-a-specific-time">
   7.2.1. Schedule: Schedule your Python Functions to Run At a Specific Time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notify-send-send-a-desktop-notification-after-finishing-executing-a-file">
   7.2.2. notify-send: Send a Desktop Notification after Finishing Executing a File
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#effortlessly-create-sound-notifications-in-python">
   7.2.3. Effortlessly Create Sound Notifications in Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#knockknock-receive-an-email-when-your-code-finishes-executing">
   7.2.4. knockknock: Receive an Email When Your Code Finishes Executing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#makefile-organize-your-command-line">
   7.2.5. Makefile: Organize Your Command Line
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notedown-create-ipython-notebooks-from-markdown-and-vice-versa">
   7.2.6. notedown: Create IPython Notebooks from Markdown and Vice Versa
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#open-a-website-using-python">
   7.2.7. Open a Website Using Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#removestar-automate-replacing-start-imports-with-explicit-imports">
   7.2.8. removestar: Automate Replacing Start Imports with Explicit Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#whereami-use-machine-learning-to-predict-where-you-are">
   7.2.9. whereami: Use Machine Learning to Predict Where You Are
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#watchfiles-rerun-code-when-a-file-changes">
   7.2.10. watchfiles: Rerun Code When a File Changes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#limit-the-execution-time-of-a-function-call-with-prefect">
   7.2.11. Limit the Execution Time of a Function Call with Prefect
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#retry-on-failure-with-prefect">
   7.2.12. Retry on Failure with Prefect
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Workflow Automation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#schedule-schedule-your-python-functions-to-run-at-a-specific-time">
   7.2.1. Schedule: Schedule your Python Functions to Run At a Specific Time
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notify-send-send-a-desktop-notification-after-finishing-executing-a-file">
   7.2.2. notify-send: Send a Desktop Notification after Finishing Executing a File
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#effortlessly-create-sound-notifications-in-python">
   7.2.3. Effortlessly Create Sound Notifications in Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#knockknock-receive-an-email-when-your-code-finishes-executing">
   7.2.4. knockknock: Receive an Email When Your Code Finishes Executing
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#makefile-organize-your-command-line">
   7.2.5. Makefile: Organize Your Command Line
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notedown-create-ipython-notebooks-from-markdown-and-vice-versa">
   7.2.6. notedown: Create IPython Notebooks from Markdown and Vice Versa
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#open-a-website-using-python">
   7.2.7. Open a Website Using Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#removestar-automate-replacing-start-imports-with-explicit-imports">
   7.2.8. removestar: Automate Replacing Start Imports with Explicit Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#whereami-use-machine-learning-to-predict-where-you-are">
   7.2.9. whereami: Use Machine Learning to Predict Where You Are
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#watchfiles-rerun-code-when-a-file-changes">
   7.2.10. watchfiles: Rerun Code When a File Changes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#limit-the-execution-time-of-a-function-call-with-prefect">
   7.2.11. Limit the Execution Time of a Function Call with Prefect
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#retry-on-failure-with-prefect">
   7.2.12. Retry on Failure with Prefect
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="workflow-automation">
<h1><span class="section-number">7.2. </span>Workflow Automation<a class="headerlink" href="#workflow-automation" title="Permalink to this headline">#</a></h1>
<p>This section covers some tools to automate the workflow of your Python project such as scheduling a time to run your code, sending notifications when your program finishes, etc.</p>
<section id="schedule-schedule-your-python-functions-to-run-at-a-specific-time">
<h2><span class="section-number">7.2.1. </span>Schedule: Schedule your Python Functions to Run At a Specific Time<a class="headerlink" href="#schedule-schedule-your-python-functions-to-run-at-a-specific-time" title="Permalink to this headline">#</a></h2>
<p>If you want to schedule Python functions to run periodically at a certain day or time of the week, use schedule.</p>
<p>In the code snippet below, I use schedule to get incoming data at 10:30 every day and train the model at 8:00 every Wednesday.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">schedule</span> 
<span class="kn">import</span> <span class="nn">time</span> 

<span class="k">def</span> <span class="nf">get_incoming_data</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Get incoming data&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">train_model</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retraining model&quot;</span><span class="p">)</span>

<span class="n">schedule</span><span class="o">.</span><span class="n">every</span><span class="p">()</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="s2">&quot;10:30&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">get_incoming_data</span><span class="p">)</span>
<span class="n">schedule</span><span class="o">.</span><span class="n">every</span><span class="p">()</span><span class="o">.</span><span class="n">wednesday</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="s2">&quot;08:00&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">do</span><span class="p">(</span><span class="n">train_model</span><span class="p">)</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">schedule</span><span class="o">.</span><span class="n">run_pending</span><span class="p">()</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/dbader/schedule">Link to schedule</a></p>
</section>
<section id="notify-send-send-a-desktop-notification-after-finishing-executing-a-file">
<h2><span class="section-number">7.2.2. </span>notify-send: Send a Desktop Notification after Finishing Executing a File<a class="headerlink" href="#notify-send-send-a-desktop-notification-after-finishing-executing-a-file" title="Permalink to this headline">#</a></h2>
<p>If you want to receive a desktop notification after finishing executing a file in Linux, use notify-send.</p>
<p>In the code below, after finishing executing <code class="docutils literal notranslate"><span class="pre">file_to_run.py</span></code>, you will receive a notification on the top of your screen to inform you that the process is terminated.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python<span class="w"> </span>file_to_run.py<span class="w"> </span><span class="p">;</span><span class="w"> </span>notify-send<span class="w"> </span><span class="s2">&quot;Process terminated&quot;</span>
</pre></div>
</div>
</section>
<section id="effortlessly-create-sound-notifications-in-python">
<h2><span class="section-number">7.2.3. </span>Effortlessly Create Sound Notifications in Python<a class="headerlink" href="#effortlessly-create-sound-notifications-in-python" title="Permalink to this headline">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>chime
</pre></div>
</div>
</div>
</div>
<p>If you want to your computer to make a sound when your Python code reaches a certain state, use chime. With chime, you only need one line of code to make a sound.</p>
<p>Try to run the following code and listen to the sound.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">chime</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chime</span><span class="o">.</span><span class="n">success</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chime</span><span class="o">.</span><span class="n">warning</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chime</span><span class="o">.</span><span class="n">error</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">chime</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>One application of using chime is to make a sound when there is an error in your code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="n">a</span>  
<span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You can&#39;t divide a number by 0!&quot;</span><span class="p">)</span>
    <span class="n">chime</span><span class="o">.</span><span class="n">error</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You can&#39;t divide a number by 0!
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/MaxHalford/chime">Link to chime</a>.</p>
</section>
<section id="knockknock-receive-an-email-when-your-code-finishes-executing">
<h2><span class="section-number">7.2.4. </span>knockknock: Receive an Email When Your Code Finishes Executing<a class="headerlink" href="#knockknock-receive-an-email-when-your-code-finishes-executing" title="Permalink to this headline">#</a></h2>
<p>It can take hours or days to train a model and you can be away from the computer when your model finishes training. Wouldnâ€™t it be nice to receive an email when your code finishes executing? There is an app for that knock-knock.</p>
<p>All it takes is one line of code specifying your email address.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">knockknock</span> <span class="kn">import</span> <span class="n">email_sender</span> 

<span class="nd">@email_sender</span><span class="p">(</span><span class="n">recipient_emails</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&lt;your_email@address.com&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;your_second_email@adress.com&gt;&#39;</span><span class="p">],</span>
<span class="n">sender_email</span><span class="o">=</span><span class="s2">&quot;&lt;grandma&#39;s_email@gmail.com&gt;&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">train_your_nicest_model</span><span class="p">(</span><span class="n">your_nicest_parameters</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">time</span> 
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10_000</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">}</span>
</pre></div>
</div>
<p>You can even have it send to your slack channel so everybody in your team can see. See the docs of this library <a class="reference external" href="https://github.com/huggingface/knockknock">here</a>.</p>
</section>
<section id="makefile-organize-your-command-line">
<h2><span class="section-number">7.2.5. </span>Makefile: Organize Your Command Line<a class="headerlink" href="#makefile-organize-your-command-line" title="Permalink to this headline">#</a></h2>
<p>Do you use often use a sequence of commands to do a repetitive task? Wouldnâ€™t it be nice if you can call a sequence of commands using only one short command? That is when Makefile comes in handy.</p>
<p>In the code below, I use Makefile to automate the workflow to set up an environment.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span># Makefile

activate:
  @echo &quot;Activating virtual env&quot;
  poetry shell
  
install: 
  @echo &quot;Installing...&quot;
  poetry install

pull_data:
  @echo &quot;Pulling data...&quot;
  dvc pull
</pre></div>
</div>
<p>If you run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>make<span class="w"> </span>activate
</pre></div>
</div>
<p>you should see something like below:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Activating<span class="w"> </span>virtual<span class="w"> </span>env
poetry<span class="w"> </span>shell
</pre></div>
</div>
<p>You can run <code class="docutils literal notranslate"><span class="pre">activate</span></code>, <code class="docutils literal notranslate"><span class="pre">install</span></code>, and <code class="docutils literal notranslate"><span class="pre">pull_data</span></code> at the same time by putting all of those commands under <code class="docutils literal notranslate"><span class="pre">install_all</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span># Makefile

activate:
  @echo &quot;Activating virtual env&quot;
  poetry shell
  
install: 
  @echo &quot;Installing...&quot;
  poetry install

pull_data:
  @echo &quot;Pulling data...&quot;
  dvc pull

install_all: 
  install activate pull_data
</pre></div>
</div>
<p>Now you can run the entire setup workflow by running only one command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>make<span class="w"> </span>install_all
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Installing...
poetry<span class="w"> </span>shell
Activating<span class="w"> </span>environment
poetry<span class="w"> </span>install
Pulling<span class="w"> </span>data...
dvc<span class="w"> </span>pull
</pre></div>
</div>
<p>I used Makefile to simplify the setup of my <a class="reference external" href="https://github.com/khuyentran1401/customer_segmentation">customer_segmentation project</a>.</p>
<p>You can learn more about Makefile <a class="reference external" href="https://opensource.com/article/18/8/what-how-makefile">here</a>.</p>
</section>
<section id="notedown-create-ipython-notebooks-from-markdown-and-vice-versa">
<h2><span class="section-number">7.2.6. </span>notedown: Create IPython Notebooks from Markdown and Vice Versa<a class="headerlink" href="#notedown-create-ipython-notebooks-from-markdown-and-vice-versa" title="Permalink to this headline">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>notedown
</pre></div>
</div>
</div>
</div>
<p>Sometimes you might want to convert your markdown file to a Jupyter Notebook for execution. If so, try notedown. notedown allows you to convert your markdown file to a Jupyter Notebook and vice versa.</p>
<p>To convert markdown file to a Jupyter Notebook with notedown, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>notedown<span class="w"> </span>input.md<span class="w"> </span>&gt;&gt;<span class="w"> </span>output.ipynb<span class="w"> </span>
</pre></div>
</div>
<p>To convert a Jupyter Notebook to a markdown file, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>notedown<span class="w"> </span>input.ipynb<span class="w"> </span>--to<span class="w"> </span>markdown<span class="w"> </span>&gt;&gt;<span class="w"> </span>output.md<span class="w"> </span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/aaren/notedown">Link to notedown</a>.</p>
</section>
<section id="open-a-website-using-python">
<h2><span class="section-number">7.2.7. </span>Open a Website Using Python<a class="headerlink" href="#open-a-website-using-python" title="Permalink to this headline">#</a></h2>
<p>If you want to open a website using Python, use webbrowser.</p>
<p>For example, running the code below will open my website in your browser.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">webbrowser</span>

<span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="s2">&quot;https://mathdatasimplified.com/&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://docs.python.org/3/library/webbrowser.html">Link to webbrowser</a>.</p>
</section>
<section id="removestar-automate-replacing-start-imports-with-explicit-imports">
<h2><span class="section-number">7.2.8. </span>removestar: Automate Replacing Start Imports with Explicit Imports<a class="headerlink" href="#removestar-automate-replacing-start-imports-with-explicit-imports" title="Permalink to this headline">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>removestar
</pre></div>
</div>
</div>
</div>
<p>It is a bad practice to use <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">*</span></code> in Python because it is harder to track down the origin of variables and debug your code. However, writing numerous imports explicitly from a single module can be tedious.</p>
<p>removestar allows you to automate replacing star imports with explicit imports.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> star_script.py  

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">def</span> <span class="nf">square_root</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">deg_to_rad</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">radians</span><span class="p">(</span><span class="n">degrees</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shows diff but does not edit star_script.py</span>
$<span class="w"> </span>removestar<span class="w"> </span>star_script.py<span class="w"> </span>
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- original/star_script.py
+++ fixed/star_script.py
@@ -1,5 +1,5 @@
 
-from math import *
+from math import radians, sqrt
 
 def square_root(num):
     return sqrt(num)
</pre></div>
</div>
</div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Edits star_script.py in-place</span>
$<span class="w"> </span>removestar<span class="w"> </span>star_script.py<span class="w"> </span>-i
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %load star_script.py</span>

<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">radians</span><span class="p">,</span> <span class="n">sqrt</span>

<span class="k">def</span> <span class="nf">square_root</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">deg_to_rad</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">radians</span><span class="p">(</span><span class="n">degrees</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/asmeurer/removestar">Link to removestar</a>.</p>
</section>
<section id="whereami-use-machine-learning-to-predict-where-you-are">
<h2><span class="section-number">7.2.9. </span>whereami: Use Machine Learning to Predict Where You Are<a class="headerlink" href="#whereami-use-machine-learning-to-predict-where-you-are" title="Permalink to this headline">#</a></h2>
<p>If you want to predict where you are with machine learning and WiFi signals, use whereami. One application of whereami is to turn on Hue light bulbs in specific locations through your laptop.</p>
<p>To predict your current location, start by collecting some samples by running <code class="docutils literal notranslate"><span class="pre">whereami</span> <span class="pre">learn</span> <span class="pre">-l</span> <span class="pre">location</span></code> in different locations. Once collecting at least 10 data points, run <code class="docutils literal notranslate"><span class="pre">whereami</span> <span class="pre">predict</span></code> to predict your current location.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Take a sample in the kitchen</span>
$<span class="w"> </span>whereami<span class="w"> </span>learn<span class="w"> </span>-l<span class="w"> </span>kitchen

<span class="c1"># Take a sample in the bedroom</span>
$<span class="w"> </span>whereami<span class="w"> </span>learn<span class="w"> </span>-l<span class="w"> </span>bedroom

<span class="c1"># Get learned locations</span>
$<span class="w"> </span>whereami<span class="w"> </span>locations
bedroom:<span class="w"> </span><span class="m">2</span>
office:<span class="w"> </span><span class="m">2</span>
kitchen:<span class="w"> </span><span class="m">3</span>
bathroom:<span class="w"> </span><span class="m">1</span>
livingroom:<span class="w"> </span><span class="m">2</span>

<span class="c1"># Run prediction in the kitchen</span>
$<span class="w"> </span>whereami<span class="w"> </span>predict
kitchen
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/kootenpv/whereami">Link to whereami</a>.</p>
</section>
<section id="watchfiles-rerun-code-when-a-file-changes">
<h2><span class="section-number">7.2.10. </span>watchfiles: Rerun Code When a File Changes<a class="headerlink" href="#watchfiles-rerun-code-when-a-file-changes" title="Permalink to this headline">#</a></h2>
<p>If you want to automatically rerun a process when a file changes, use watchfiles.</p>
<p>In the code below, the function <code class="docutils literal notranslate"><span class="pre">train</span></code> will run when the file <code class="docutils literal notranslate"><span class="pre">process_data.py</span></code> changes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">watchfiles</span> <span class="kn">import</span> <span class="n">run_process</span>

<span class="k">def</span> <span class="nf">train</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Detect changes in process_data.py. &quot;</span> 
          <span class="s2">&quot;Train the model again&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run_process</span><span class="p">(</span><span class="s2">&quot;process_data.py&quot;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">train</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/samuelcolvin/watchfiles">Link to watchfiles</a>.</p>
</section>
<section id="limit-the-execution-time-of-a-function-call-with-prefect">
<h2><span class="section-number">7.2.11. </span>Limit the Execution Time of a Function Call with Prefect<a class="headerlink" href="#limit-the-execution-time-of-a-function-call-with-prefect" title="Permalink to this headline">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>prefect<span class="w"> </span>
</pre></div>
</div>
</div>
</div>
<p>Prefect is an open-source library that allows you to orchestrate and observe your data pipelines defined in Python. Check out the <a class="reference external" href="https://docs.prefect.io/tutorials/first-steps/">getting started tutorials</a> for basic concepts of Prefect.</p>
<p>Sometimes, it is useful to cancel a function call when the execution time is longer than expected.</p>
<p>In Prefect, you can limit the execution time of a Python function call with the decorators <code class="docutils literal notranslate"><span class="pre">task(timeout_seconds=n)</span></code> or <code class="docutils literal notranslate"><span class="pre">flow(timeout_seconds=n)</span></code>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">prefect</span> <span class="kn">import</span> <span class="n">flow</span><span class="p">,</span> <span class="n">task</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="nd">@task</span><span class="p">(</span><span class="n">timeout_seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_data</span><span class="p">():</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># takes 2 seconds to run</span>
    <span class="k">return</span> <span class="mi">1</span>

<span class="nd">@task</span>
<span class="k">def</span> <span class="nf">process_data</span><span class="p">(</span><span class="n">res</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">res</span> <span class="o">+</span> <span class="mi">1</span>

<span class="nd">@flow</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span> <span class="c1"># raises an error</span>
    <span class="k">return</span> <span class="n">process_data</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="c1"># never runs</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">09:33:22.687 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | prefect.engine - Created flow run<span style="color: #800080; text-decoration-color: #800080"> 'arrogant-goshawk'</span> for flow<span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> 'main'</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">09:33:23.979 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | Flow run 'arrogant-goshawk' - Created task run 'get_data-e6feb297-0' for task 'get_data'
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">09:33:23.982 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | Flow run 'arrogant-goshawk' - Executing 'get_data-e6feb297-0' immediately...
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">09:33:25.561 | <span style="color: #d70000; text-decoration-color: #d70000">ERROR</span>   | Task run 'get_data-e6feb297-0' - Task run exceeded timeout of 1.0 seconds
Traceback (most recent call last):
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 1239, in orchestrate_task_run
    result = await run_sync(task.fn, *args, **kwargs)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py", line 128, in run_sync_in_interruptible_worker_thread
    tg.start_soon(
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 658, in __aexit__
    raise <span style="color: #d7d700; text-decoration-color: #d7d700">Cancelled</span>Error
asyncio.exceptions.<span style="color: #d7d700; text-decoration-color: #d7d700">Cancelled</span>Error

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 1239, in orchestrate_task_run
    result = await run_sync(task.fn, *args, **kwargs)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_core/_tasks.py", line 118, in __exit__
    raise TimeoutError
TimeoutError
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">09:33:25.788 | <span style="color: #d70000; text-decoration-color: #d70000">ERROR</span>   | Task run 'get_data-e6feb297-0' - Finished in state TimedOut('Task run exceeded timeout of 1.0 seconds Traceback (most recent call last):\n  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 1239, in orchestrate_task_run\n    result = await run_sync(task.fn, *args, **kwargs)\n  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py", line 128, in run_sync_in_interruptible_worker_thread\n    tg.start_soon(\n  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 658, in __aexit__\n    raise <span style="color: #d7d700; text-decoration-color: #d7d700">Cancelled</span>Error\nasyncio.exceptions.<span style="color: #d7d700; text-decoration-color: #d7d700">Cancelled</span>Error\n\nDuring handling of the above exception, another exception occurred:\n\nTimeoutError\n', type=FAILED)
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">09:33:25.790 | <span style="color: #d70000; text-decoration-color: #d70000">ERROR</span>   | Flow run 'arrogant-goshawk' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 1239, in orchestrate_task_run
    result = await run_sync(task.fn, *args, **kwargs)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py", line 128, in run_sync_in_interruptible_worker_thread
    tg.start_soon(
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 658, in __aexit__
    raise <span style="color: #d7d700; text-decoration-color: #d7d700">Cancelled</span>Error
asyncio.exceptions.<span style="color: #d7d700; text-decoration-color: #d7d700">Cancelled</span>Error

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 610, in orchestrate_flow_run
    result = await run_sync(flow_call)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py", line 68, in run_sync_in_worker_thread
    return await anyio.to_thread.run_sync(call, cancellable=True)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/var/folders/3z/svlh9jv14ps3j6cc964tbjg40000gq/T/ipykernel_83306/3092424982.py", line 15, in main
    res = get_data()
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/tasks.py", line 360, in __call__
    return enter_task_run_engine(
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 733, in enter_task_run_engine
    return run_async_from_worker_thread(begin_run)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py", line 148, in run_async_from_worker_thread
    return anyio.from_thread.run(call)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/from_thread.py", line 49, in run
    return asynclib.run_async_from_thread(func, *args)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 970, in run_async_from_thread
    return f.result()
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py", line 445, in result
    return self.__get_result()
  File "/Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py", line 390, in __get_result
    raise self._exception
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 874, in get_task_call_return_value
    return await future._result()
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/futures.py", line 237, in _result
    return await final_state.result(raise_on_failure=raise_on_failure, fetch=True)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/states.py", line 74, in _get_state_result
    raise await get_state_exception(state)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 1239, in orchestrate_task_run
    result = await run_sync(task.fn, *args, **kwargs)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_core/_tasks.py", line 118, in __exit__
    raise TimeoutError
TimeoutError
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">09:33:25.949 | <span style="color: #d70000; text-decoration-color: #d70000">ERROR</span>   | Flow run 'arrogant-goshawk' - Finished in state <span style="color: #d70000; text-decoration-color: #d70000">Failed</span>('Flow run encountered an exception. Traceback (most recent call last):\n  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 1239, in orchestrate_task_run\n    result = await run_sync(task.fn, *args, **kwargs)\n  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py", line 128, in run_sync_in_interruptible_worker_thread\n    tg.start_soon(\n  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 658, in __aexit__\n    raise <span style="color: #d7d700; text-decoration-color: #d7d700">Cancelled</span>Error\nasyncio.exceptions.<span style="color: #d7d700; text-decoration-color: #d7d700">Cancelled</span>Error\n\nDuring handling of the above exception, another exception occurred:\n\nTimeoutError\n')
</pre>
</div><div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">CancelledError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/engine.py:1239,</span> in <span class="ni">orchestrate_task_run</span><span class="nt">(task, task_run, parameters, wait_for, result_factory, interruptible, client)</span>
<span class="g g-Whitespace">   </span><span class="mi">1234</span>                 <span class="n">run_sync</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1235</span>                     <span class="n">run_sync_in_interruptible_worker_thread</span>
<span class="g g-Whitespace">   </span><span class="mi">1236</span>                     <span class="k">if</span> <span class="n">interruptible</span> <span class="ow">or</span> <span class="n">timeout_scope</span>
<span class="g g-Whitespace">   </span><span class="mi">1237</span>                     <span class="k">else</span> <span class="n">run_sync_in_worker_thread</span>
<span class="g g-Whitespace">   </span><span class="mi">1238</span>                 <span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1239</span>                 <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1241</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py:128,</span> in <span class="ni">run_sync_in_interruptible_worker_thread</span><span class="nt">(__fn, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">127</span>     <span class="n">tg</span><span class="o">.</span><span class="n">start_soon</span><span class="p">(</span><span class="n">send_interrupt_to_thread</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">128</span>     <span class="n">tg</span><span class="o">.</span><span class="n">start_soon</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span>         <span class="n">partial</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>             <span class="n">anyio</span><span class="o">.</span><span class="n">to_thread</span><span class="o">.</span><span class="n">run_sync</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">131</span>             <span class="n">capture_worker_thread_and_result</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span>             <span class="n">cancellable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">136</span> <span class="k">assert</span> <span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NotSet</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py:658,</span> in <span class="ni">TaskGroup.__aexit__</span><span class="nt">(self, exc_type, exc_val, exc_tb)</span>
<span class="g g-Whitespace">    </span><span class="mi">654</span> <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">655</span>     <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">CancelledError</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">exceptions</span>
<span class="g g-Whitespace">    </span><span class="mi">656</span> <span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">657</span>     <span class="c1"># Tasks were cancelled natively, without a cancellation message</span>
<span class="ne">--&gt; </span><span class="mi">658</span>     <span class="k">raise</span> <span class="n">CancelledError</span>
<span class="g g-Whitespace">    </span><span class="mi">659</span> <span class="k">else</span><span class="p">:</span>

<span class="ne">CancelledError</span>: 

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">TimeoutError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">19</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="k">return</span> <span class="n">process_data</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">19</span>     <span class="n">main</span><span class="p">()</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/flows.py:442,</span> in <span class="ni">Flow.__call__</span><span class="nt">(self, return_state, wait_for, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">438</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">get_call_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">440</span> <span class="n">return_type</span> <span class="o">=</span> <span class="s2">&quot;state&quot;</span> <span class="k">if</span> <span class="n">return_state</span> <span class="k">else</span> <span class="s2">&quot;result&quot;</span>
<span class="ne">--&gt; </span><span class="mi">442</span> <span class="k">return</span> <span class="n">enter_flow_run_engine_from_flow_call</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span>     <span class="n">parameters</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">445</span>     <span class="n">wait_for</span><span class="o">=</span><span class="n">wait_for</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span>     <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">447</span> <span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/engine.py:154,</span> in <span class="ni">enter_flow_run_engine_from_flow_call</span><span class="nt">(flow, parameters, wait_for, return_type)</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span> <span class="k">elif</span> <span class="n">in_async_main_thread</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span>     <span class="c1"># An event loop is already running and we must create a blocking portal to</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span>     <span class="c1"># run async code from this synchronous context</span>
<span class="g g-Whitespace">    </span><span class="mi">153</span>     <span class="k">with</span> <span class="n">start_blocking_portal</span><span class="p">()</span> <span class="k">as</span> <span class="n">portal</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">154</span>         <span class="k">return</span> <span class="n">portal</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">begin_run</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span>     <span class="c1"># An event loop is not running so we will create one</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span>     <span class="k">return</span> <span class="n">anyio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">begin_run</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/anyio/from_thread.py:283,</span> in <span class="ni">BlockingPortal.call</span><span class="nt">(self, func, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">268</span> <span class="k">def</span> <span class="nf">call</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">269</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">270</span>     <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Coroutine</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T_Retval</span><span class="p">],</span> <span class="n">T_Retval</span><span class="p">]],</span>
<span class="g g-Whitespace">    </span><span class="mi">271</span>     <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">object</span>
<span class="g g-Whitespace">    </span><span class="mi">272</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_Retval</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">273</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">274</span><span class="sd">     Call the given function in the event loop thread.</span>
<span class="g g-Whitespace">    </span><span class="mi">275</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">281</span><span class="sd"> </span>
<span class="g g-Whitespace">    </span><span class="mi">282</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">283</span>     <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">T_Retval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_task_soon</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">())</span>

<span class="nn">File /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445,</span> in <span class="ni">Future.result</span><span class="nt">(self, timeout)</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span>     <span class="k">raise</span> <span class="n">CancelledError</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span> <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">FINISHED</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">445</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_result</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">447</span>     <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">()</span>

<span class="nn">File /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390,</span> in <span class="ni">Future.__get_result</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">390</span>         <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span>     <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">392</span>         <span class="c1"># Break a reference cycle with the exception in self._exception</span>
<span class="g g-Whitespace">    </span><span class="mi">393</span>         <span class="bp">self</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/anyio/from_thread.py:219,</span> in <span class="ni">BlockingPortal._call_func</span><span class="nt">(self, func, args, kwargs, future)</span>
<span class="g g-Whitespace">    </span><span class="mi">216</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">217</span>                 <span class="n">future</span><span class="o">.</span><span class="n">add_done_callback</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">219</span>             <span class="n">retval</span> <span class="o">=</span> <span class="k">await</span> <span class="n">retval</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span> <span class="k">except</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancelled_exc_class</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>     <span class="n">future</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/client/utilities.py:47,</span> in <span class="ni">inject_client.&lt;locals&gt;.with_injected_client</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">45</span> <span class="k">async</span> <span class="k">with</span> <span class="n">client_context</span> <span class="k">as</span> <span class="n">new_client</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span>     <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;client&quot;</span><span class="p">,</span> <span class="n">new_client</span> <span class="ow">or</span> <span class="n">client</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">47</span>     <span class="k">return</span> <span class="k">await</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/engine.py:237,</span> in <span class="ni">create_then_begin_flow_run</span><span class="nt">(flow, parameters, wait_for, return_type, client)</span>
<span class="g g-Whitespace">    </span><span class="mi">235</span>     <span class="k">return</span> <span class="n">state</span>
<span class="g g-Whitespace">    </span><span class="mi">236</span> <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">237</span>     <span class="k">return</span> <span class="k">await</span> <span class="n">state</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">fetch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">238</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">239</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid return type for flow engine </span><span class="si">{</span><span class="n">return_type</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/states.py:74,</span> in <span class="ni">_get_state_result</span><span class="nt">(state, raise_on_failure)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="sd"> Internal implementation for `get_state_result` without async backwards compatibility</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> <span class="k">if</span> <span class="n">raise_on_failure</span> <span class="ow">and</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">is_crashed</span><span class="p">()</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">is_failed</span><span class="p">()):</span>
<span class="ne">---&gt; </span><span class="mi">74</span>     <span class="k">raise</span> <span class="k">await</span> <span class="n">get_state_exception</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">DataDocument</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">result_from_state_with_data_document</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>         <span class="n">state</span><span class="p">,</span> <span class="n">raise_on_failure</span><span class="o">=</span><span class="n">raise_on_failure</span>
<span class="g g-Whitespace">     </span><span class="mi">79</span>     <span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/engine.py:610,</span> in <span class="ni">orchestrate_flow_run</span><span class="nt">(flow, flow_run, parameters, wait_for, interruptible, client, partial_flow_run_context)</span>
<span class="g g-Whitespace">    </span><span class="mi">604</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">605</span>                 <span class="n">run_sync</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">606</span>                     <span class="n">run_sync_in_interruptible_worker_thread</span>
<span class="g g-Whitespace">    </span><span class="mi">607</span>                     <span class="k">if</span> <span class="n">interruptible</span> <span class="ow">or</span> <span class="n">timeout_scope</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span>                     <span class="k">else</span> <span class="n">run_sync_in_worker_thread</span>
<span class="g g-Whitespace">    </span><span class="mi">609</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">610</span>                 <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync</span><span class="p">(</span><span class="n">flow_call</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">612</span>         <span class="n">waited_for_task_runs</span> <span class="o">=</span> <span class="k">await</span> <span class="n">wait_for_task_runs_and_report_crashes</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">613</span>             <span class="n">flow_run_context</span><span class="o">.</span><span class="n">task_run_futures</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span>
<span class="g g-Whitespace">    </span><span class="mi">614</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">616</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py:68,</span> in <span class="ni">run_sync_in_worker_thread</span><span class="nt">(__fn, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span><span class="sd"> Runs a sync function in a new worker thread so that the main thread&#39;s event loop</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span><span class="sd"> is not blocked</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span><span class="sd"> thread may continue running â€” the outcome will just be ignored.</span>
<span class="g g-Whitespace">     </span><span class="mi">66</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span> <span class="n">call</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">__fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">68</span> <span class="k">return</span> <span class="k">await</span> <span class="n">anyio</span><span class="o">.</span><span class="n">to_thread</span><span class="o">.</span><span class="n">run_sync</span><span class="p">(</span><span class="n">call</span><span class="p">,</span> <span class="n">cancellable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/anyio/to_thread.py:31,</span> in <span class="ni">run_sync</span><span class="nt">(func, cancellable, limiter, *args)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="k">async</span> <span class="k">def</span> <span class="nf">run_sync</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">T_Retval</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>     <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>     <span class="n">cancellable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>     <span class="n">limiter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CapacityLimiter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_Retval</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span><span class="sd">     Call the given function with the given arguments in a worker thread.</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span><span class="sd"> </span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">30</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">---&gt; </span><span class="mi">31</span>     <span class="k">return</span> <span class="k">await</span> <span class="n">get_asynclib</span><span class="p">()</span><span class="o">.</span><span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span>         <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">cancellable</span><span class="o">=</span><span class="n">cancellable</span><span class="p">,</span> <span class="n">limiter</span><span class="o">=</span><span class="n">limiter</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span>     <span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py:937,</span> in <span class="ni">run_sync_in_worker_thread</span><span class="nt">(func, cancellable, limiter, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">935</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">sniffio</span><span class="o">.</span><span class="n">current_async_library_cvar</span><span class="o">.</span><span class="n">set</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">936</span> <span class="n">worker</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put_nowait</span><span class="p">((</span><span class="n">context</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">future</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">937</span> <span class="k">return</span> <span class="k">await</span> <span class="n">future</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py:867,</span> in <span class="ni">WorkerThread.run</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">865</span> <span class="n">exception</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">866</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">867</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">868</span> <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">869</span>     <span class="n">exception</span> <span class="o">=</span> <span class="n">exc</span>

<span class="nn">Cell In [2], line 15,</span> in <span class="ni">main</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="nd">@flow</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="ne">---&gt; </span><span class="mi">15</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="k">return</span> <span class="n">process_data</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/tasks.py:360,</span> in <span class="ni">Task.__call__</span><span class="nt">(self, return_state, wait_for, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span> <span class="n">parameters</span> <span class="o">=</span> <span class="n">get_call_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span> <span class="n">return_type</span> <span class="o">=</span> <span class="s2">&quot;state&quot;</span> <span class="k">if</span> <span class="n">return_state</span> <span class="k">else</span> <span class="s2">&quot;result&quot;</span>
<span class="ne">--&gt; </span><span class="mi">360</span> <span class="k">return</span> <span class="n">enter_task_run_engine</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">361</span>     <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span>     <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">363</span>     <span class="n">wait_for</span><span class="o">=</span><span class="n">wait_for</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">364</span>     <span class="n">task_runner</span><span class="o">=</span><span class="n">SequentialTaskRunner</span><span class="p">(),</span>
<span class="g g-Whitespace">    </span><span class="mi">365</span>     <span class="n">return_type</span><span class="o">=</span><span class="n">return_type</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">366</span>     <span class="n">mapped</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">367</span> <span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/engine.py:733,</span> in <span class="ni">enter_task_run_engine</span><span class="nt">(task, parameters, wait_for, return_type, task_runner, mapped)</span>
<span class="g g-Whitespace">    </span><span class="mi">731</span> <span class="c1"># Async or sync task run in sync flow run</span>
<span class="g g-Whitespace">    </span><span class="mi">732</span> <span class="k">elif</span> <span class="ow">not</span> <span class="n">flow_run_context</span><span class="o">.</span><span class="n">flow</span><span class="o">.</span><span class="n">isasync</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">733</span>     <span class="k">return</span> <span class="n">run_async_from_worker_thread</span><span class="p">(</span><span class="n">begin_run</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">735</span> <span class="c1"># Sync task run in async flow run</span>
<span class="g g-Whitespace">    </span><span class="mi">736</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">737</span>     <span class="c1"># Call out to the sync portal since we are not in a worker thread</span>
<span class="g g-Whitespace">    </span><span class="mi">738</span>     <span class="k">return</span> <span class="n">flow_run_context</span><span class="o">.</span><span class="n">sync_portal</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">begin_run</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py:148,</span> in <span class="ni">run_async_from_worker_thread</span><span class="nt">(__fn, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span><span class="sd"> Runs an async function in the main thread&#39;s event loop, blocking the worker</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span><span class="sd"> thread until completion</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span> <span class="n">call</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">__fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">148</span> <span class="k">return</span> <span class="n">anyio</span><span class="o">.</span><span class="n">from_thread</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">call</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/anyio/from_thread.py:49,</span> in <span class="ni">run</span><span class="nt">(func, *args)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;This function can only be run from an AnyIO worker thread&quot;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">49</span> <span class="k">return</span> <span class="n">asynclib</span><span class="o">.</span><span class="n">run_async_from_thread</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py:970,</span> in <span class="ni">run_async_from_thread</span><span class="nt">(func, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">964</span> <span class="k">def</span> <span class="nf">run_async_from_thread</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">965</span>     <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Coroutine</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">T_Retval</span><span class="p">]],</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">object</span>
<span class="g g-Whitespace">    </span><span class="mi">966</span> <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">T_Retval</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">967</span>     <span class="n">f</span><span class="p">:</span> <span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">[</span><span class="n">T_Retval</span><span class="p">]</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run_coroutine_threadsafe</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">968</span>         <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">),</span> <span class="n">threadlocals</span><span class="o">.</span><span class="n">loop</span>
<span class="g g-Whitespace">    </span><span class="mi">969</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">970</span>     <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

<span class="nn">File /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:445,</span> in <span class="ni">Future.result</span><span class="nt">(self, timeout)</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span>     <span class="k">raise</span> <span class="n">CancelledError</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span> <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">==</span> <span class="n">FINISHED</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">445</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__get_result</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">447</span>     <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">()</span>

<span class="nn">File /Library/Developer/CommandLineTools/Library/Frameworks/Python3.framework/Versions/3.9/lib/python3.9/concurrent/futures/_base.py:390,</span> in <span class="ni">Future.__get_result</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">388</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">389</span>     <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">390</span>         <span class="k">raise</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exception</span>
<span class="g g-Whitespace">    </span><span class="mi">391</span>     <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">392</span>         <span class="c1"># Break a reference cycle with the exception in self._exception</span>
<span class="g g-Whitespace">    </span><span class="mi">393</span>         <span class="bp">self</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/engine.py:874,</span> in <span class="ni">get_task_call_return_value</span><span class="nt">(task, flow_run_context, parameters, wait_for, return_type, task_runner, extra_task_inputs)</span>
<span class="g g-Whitespace">    </span><span class="mi">872</span>     <span class="k">return</span> <span class="k">await</span> <span class="n">future</span><span class="o">.</span><span class="n">_wait</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">873</span> <span class="k">elif</span> <span class="n">return_type</span> <span class="o">==</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">874</span>     <span class="k">return</span> <span class="k">await</span> <span class="n">future</span><span class="o">.</span><span class="n">_result</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">875</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">876</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid return type for task engine </span><span class="si">{</span><span class="n">return_type</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/futures.py:237,</span> in <span class="ni">PrefectFuture._result</span><span class="nt">(self, timeout, raise_on_failure)</span>
<span class="g g-Whitespace">    </span><span class="mi">235</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">final_state</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">236</span>     <span class="k">raise</span> <span class="ne">TimeoutError</span><span class="p">(</span><span class="s2">&quot;Call timed out before task finished.&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">237</span> <span class="k">return</span> <span class="k">await</span> <span class="n">final_state</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">raise_on_failure</span><span class="o">=</span><span class="n">raise_on_failure</span><span class="p">,</span> <span class="n">fetch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/states.py:74,</span> in <span class="ni">_get_state_result</span><span class="nt">(state, raise_on_failure)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span><span class="sd"> Internal implementation for `get_state_result` without async backwards compatibility</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> <span class="k">if</span> <span class="n">raise_on_failure</span> <span class="ow">and</span> <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">is_crashed</span><span class="p">()</span> <span class="ow">or</span> <span class="n">state</span><span class="o">.</span><span class="n">is_failed</span><span class="p">()):</span>
<span class="ne">---&gt; </span><span class="mi">74</span>     <span class="k">raise</span> <span class="k">await</span> <span class="n">get_state_exception</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">76</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">DataDocument</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">77</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">result_from_state_with_data_document</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>         <span class="n">state</span><span class="p">,</span> <span class="n">raise_on_failure</span><span class="o">=</span><span class="n">raise_on_failure</span>
<span class="g g-Whitespace">     </span><span class="mi">79</span>     <span class="p">)</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/prefect/engine.py:1239,</span> in <span class="ni">orchestrate_task_run</span><span class="nt">(task, task_run, parameters, wait_for, result_factory, interruptible, client)</span>
<span class="g g-Whitespace">   </span><span class="mi">1233</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1234</span>                 <span class="n">run_sync</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1235</span>                     <span class="n">run_sync_in_interruptible_worker_thread</span>
<span class="g g-Whitespace">   </span><span class="mi">1236</span>                     <span class="k">if</span> <span class="n">interruptible</span> <span class="ow">or</span> <span class="n">timeout_scope</span>
<span class="g g-Whitespace">   </span><span class="mi">1237</span>                     <span class="k">else</span> <span class="n">run_sync_in_worker_thread</span>
<span class="g g-Whitespace">   </span><span class="mi">1238</span>                 <span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1239</span>                 <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">fn</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1241</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1242</span>     <span class="n">name</span> <span class="o">=</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">None</span>

<span class="nn">File ~/book/venv/lib/python3.9/site-packages/anyio/_core/_tasks.py:118,</span> in <span class="ni">FailAfterContextManager.__exit__</span><span class="nt">(self, exc_type, exc_val, exc_tb)</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span> <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scope</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">117</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_scope</span><span class="o">.</span><span class="n">cancel_called</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">118</span>     <span class="k">raise</span> <span class="ne">TimeoutError</span>
<span class="g g-Whitespace">    </span><span class="mi">120</span> <span class="k">return</span> <span class="n">retval</span>

<span class="ne">TimeoutError</span>: 
</pre></div>
</div>
</div>
</div>
</section>
<section id="retry-on-failure-with-prefect">
<h2><span class="section-number">7.2.12. </span>Retry on Failure with Prefect<a class="headerlink" href="#retry-on-failure-with-prefect" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>-U<span class="w"> </span>prefect
</pre></div>
</div>
</div>
</div>
<p>If you are running a function that occasionally fails, such as calling an API, it is useful to rerun the function when it fails.</p>
<p>Prefect allows you to automatically retry on failure up to a specified number of times.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">prefect</span> <span class="kn">import</span> <span class="n">task</span><span class="p">,</span> <span class="n">flow</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># Retry up to 3 times and wait 1 seconds between each retry</span>
<span class="nd">@task</span><span class="p">(</span><span class="n">retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">retry_delay_seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">flaky_function</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;not this time!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">42</span>

<span class="nd">@flow</span> 
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">flaky_function</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">08:34:12.022 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | prefect.engine - Created flow run<span style="color: #800080; text-decoration-color: #800080"> 'bald-caiman'</span> for flow<span style="color: #800080; text-decoration-color: #800080; font-weight: bold"> 'main'</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">08:34:12.906 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | Flow run<span style="color: #800080; text-decoration-color: #800080"> 'bald-caiman'</span> - Created task run 'flaky_function-8095224b-0' for task 'flaky_function'
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">08:34:12.908 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | Flow run<span style="color: #800080; text-decoration-color: #800080"> 'bald-caiman'</span> - Executing 'flaky_function-8095224b-0' immediately...
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">08:34:13.178 | <span style="color: #d70000; text-decoration-color: #d70000">ERROR</span>   | Task run 'flaky_function-8095224b-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 1449, in orchestrate_task_run
    result = await run_sync(task.fn, *args, **kwargs)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py", line 91, in run_sync_in_worker_thread
    return await anyio.to_thread.run_sync(
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/var/folders/3z/svlh9jv14ps3j6cc964tbjg40000gq/T/ipykernel_36167/3817304312.py", line 7, in flaky_function
    raise RuntimeError("not this time!")
RuntimeError: not this time!
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">08:34:13.277 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | Task run 'flaky_function-8095224b-0' - Received non-final state 'AwaitingRetry' when proposing final state '<span style="color: #d70000; text-decoration-color: #d70000">Failed</span>' and will attempt to run again...
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">08:34:14.569 | <span style="color: #d70000; text-decoration-color: #d70000">ERROR</span>   | Task run 'flaky_function-8095224b-0' - Encountered exception during execution:
Traceback (most recent call last):
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/engine.py", line 1449, in orchestrate_task_run
    result = await run_sync(task.fn, *args, **kwargs)
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/prefect/utilities/asyncutils.py", line 91, in run_sync_in_worker_thread
    return await anyio.to_thread.run_sync(
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/to_thread.py", line 31, in run_sync
    return await get_asynclib().run_sync_in_worker_thread(
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 937, in run_sync_in_worker_thread
    return await future
  File "/Users/khuyen/book/venv/lib/python3.9/site-packages/anyio/_backends/_asyncio.py", line 867, in run
    result = context.run(func, *args)
  File "/var/folders/3z/svlh9jv14ps3j6cc964tbjg40000gq/T/ipykernel_36167/3817304312.py", line 7, in flaky_function
    raise RuntimeError("not this time!")
RuntimeError: not this time!
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">08:34:15.013 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | Task run 'flaky_function-8095224b-0' - Received non-final state 'AwaitingRetry' when proposing final state '<span style="color: #d70000; text-decoration-color: #d70000">Failed</span>' and will attempt to run again...
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">08:34:16.390 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | Task run 'flaky_function-8095224b-0' - Finished in state <span style="color: #008000; text-decoration-color: #008000">Completed</span>()
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">08:34:16.512 | <span style="color: #008080; text-decoration-color: #008080">INFO</span>    | Flow run<span style="color: #800080; text-decoration-color: #800080"> 'bald-caiman'</span> - Finished in state <span style="color: #008000; text-decoration-color: #008000">Completed</span>('All states completed.')
</pre>
</div><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Completed(message=None, type=COMPLETED, result=PersistedResult(type=&#39;reference&#39;, serializer_type=&#39;pickle&#39;, storage_block_id=UUID(&#39;2c195477-a9d1-4b59-9a9e-80b00f96c464&#39;), storage_key=&#39;84ff6378ce894b6fb1823e60b1d201b4&#39;))]
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapter6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="alternative_approach.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">7.1. </span>Alternative Approach</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="code_review.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7.3. </span>Code Review</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Khuyen Tran<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>