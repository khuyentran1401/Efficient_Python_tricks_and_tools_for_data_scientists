

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6.2. Feature Engineer &#8212; Effective Python for Data Scientists</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "ðŸ’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter5/feature_engineer';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.3. Get Data" href="get_data.html" />
    <link rel="prev" title="6.1. Feature Extraction" href="feature_extraction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/data_simplified_icon.png" class="logo__image only-light" alt="Effective Python for Data Scientists - Home"/>
    <script>document.write(`<img src="../_static/data_simplified_icon.png" class="logo__image only-dark" alt="Effective Python for Data Scientists - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    What Should You Expect From This Book?
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../how_to_read.html">1. How to Read This Book</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter1/Chapter1.html">2. Python Built-in Methods</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/string.html">2.1. String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/number.html">2.2. Number</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Chapter1/list/list.html">2.3. List</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../Chapter1/list/get_elements.html">2.3.1. Get Elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Chapter1/list/unpack_iterables.html">2.3.2. Unpack Iterables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Chapter1/list/join_iterable.html">2.3.3. Join Iterables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Chapter1/list/apply_functions_to_elements.html">2.3.4. Apply Functions to Elements in a List</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/set.html">2.4. Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/dictionary.html">2.5. Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/function.html">2.6. Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/class.html">2.7. Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/datetime.html">2.8. Datetime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/code_speed.html">2.9. Code Speed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/good_practices.html">2.10. Good Python Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/python_new_features.html">2.11. New Features in Python</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter2/Chapter2.html">3. Python Utility Libraries</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/collections.html">3.1. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/itertools.html">3.2. Itertools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/functools.html">3.3. Functools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/pydash.html">3.4. Pydash</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/sympy.html">3.5. SymPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/operator.html">3.6. Operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/dataclasses.html">3.7. Data Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/typing.html">3.8. Typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/pathlib.html">3.9. pathlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/pydantic.html">3.10. Pydantic</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter3/Chapter3.html">4. Pandas</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/change_values.html">4.1. Change Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/get_values.html">4.2. Get Certain Values From a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/date_time.html">4.3. Work with Datetime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/transform_dataframe.html">4.4. Transform a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/create_dataframe.html">4.5. Create a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/combine_dataframes.html">4.6. Combine Multiple DataFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/filter.html">4.7. Filter Rows or Columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/data_types.html">4.8. Manipulate a DataFrame Using Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/sort_dataframe.html">4.9. Sort Rows or Columns of a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/string.html">4.10. Work with String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/style_dataframe.html">4.11. Style a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/testing.html">4.12. Test</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter4/Chapter4.html">5. NumPy</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/Numpy.html">5.1. NumPy</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="Chapter5.html">6. Data Science Tools</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="feature_extraction.html">6.1. Feature Extraction</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">6.2. Feature Engineer</a></li>
<li class="toctree-l2"><a class="reference internal" href="get_data.html">6.3. Get Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="manage_data.html">6.4. Manage Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="machine_learning.html">6.5. Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="natural_language_processing.html">6.6. Natural Language Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="time_series.html">6.7. Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharing_downloading.html">6.8. Sharing and Downloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="speed_up_code.html">6.9. Tools to Speed Up Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html">6.10. Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="best_python_practice_tools.html">6.11. Tools for Best Python Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="better_pandas.html">6.12. Better Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">6.13. Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="SQL.html">6.14. SQL Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark.html">6.15. 3 Powerful Ways to Create PySpark DataFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="llm.html">6.16. Large Language Model (LLM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter6/Chapter6.html">7. Cool Tools</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/alternative_approach.html">7.1. Alternative Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/workflow_automation.html">7.2. Workflow Automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/code_review.html">7.3. Code Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/logging_debugging.html">7.4. Logging and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/better_outputs.html">7.5. Better Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/git_github.html">7.6. Git and GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/env_management.html">7.7. Environment Management</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter7/Chapter7.html">8. Jupyter Notebook</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/jupyter_notebook.html">8.1. Jupyter Notebook</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/blob/master/./Chapter5/feature_engineer.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/issues/new?title=Issue%20on%20page%20%2FChapter5/feature_engineer.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Chapter5/feature_engineer.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Feature Engineer</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-data-in-a-stratified-fashion-in-scikit-learn">6.2.1. Split Data in a Stratified Fashion in scikit-learn</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#avoiding-data-leakage-in-time-series-data">6.2.2. Avoiding Data Leakage in Time Series Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#timeseriessplit-for-cross-validation-in-time-series">6.2.3. TimeSeriesSplit for Cross-Validation in Time Series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enhancing-data-handling-with-scikit-learn-s-dataframe-support">6.2.4. Enhancing Data Handling with scikit-learnâ€™s DataFrame Support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#efficient-feature-transformation-with-make-column-transformer-in-scikit-learn">6.2.5. Efficient Feature Transformation with make_column_transformer in scikit-learn</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functiontransformer-build-robust-preprocessing-pipelines-with-custom-transformations">6.2.6. FunctionTransformer: Build Robust Preprocessing Pipelines with Custom Transformations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drop-correlated-features">6.2.7. Drop Correlated Features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encode-rare-labels-with-feature-engine">6.2.8. Encode Rare Labels with Feature-engine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encode-categorical-data-using-frequency">6.2.9. Encode Categorical Data Using Frequency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#similarity-encoding-for-dirty-categories-using-dirty-cat">6.2.10. Similarity Encoding for Dirty Categories Using dirty_cat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-handle-misspellings-in-real-world-datasets">6.2.11. How to Handle Misspellings in Real-World Datasets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-data-mismatches-joining-tables-with-fuzzy-matching">6.2.12. Solving Data Mismatches: Joining Tables with Fuzzy Matching</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#snorkel-programmatically-build-training-data-in-python">6.2.13. Snorkel â€” Programmatically Build Training Data in Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sketch-ai-code-writing-assistant-that-understands-data-content">6.2.14. sketch: AI Code-Writing Assistant That Understands Data Content</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="feature-engineer">
<h1><span class="section-number">6.2. </span>Feature Engineer<a class="headerlink" href="#feature-engineer" title="Permalink to this heading">#</a></h1>
<p><img alt="" src="../_images/feature_engineer.png" /></p>
<p>This section covers some libraries for feature engineering.</p>
<section id="split-data-in-a-stratified-fashion-in-scikit-learn">
<h2><span class="section-number">6.2.1. </span>Split Data in a Stratified Fashion in scikit-learn<a class="headerlink" href="#split-data-in-a-stratified-fashion-in-scikit-learn" title="Permalink to this heading">#</a></h2>
<p>Normally, after using scikit-learnâ€™s <code class="docutils literal notranslate"><span class="pre">train_test_split</span></code>, the proportion of values in the sample will be different from the proportion of values in the entire dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">(</span><span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([50, 50, 50])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get count of each class in the train set</span>

<span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([37, 34, 41])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get count of each class in the test set</span>

<span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([13, 16,  9])
</pre></div>
</div>
</div>
</div>
<p>If you want to keep the proportion of classes in the sample the same as the proportion of classes in the entire dataset, add <code class="docutils literal notranslate"><span class="pre">stratify=y</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([37, 37, 38])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([13, 13, 12])
</pre></div>
</div>
</div>
</div>
</section>
<section id="avoiding-data-leakage-in-time-series-data">
<h2><span class="section-number">6.2.2. </span>Avoiding Data Leakage in Time Series Data<a class="headerlink" href="#avoiding-data-leakage-in-time-series-data" title="Permalink to this heading">#</a></h2>
<p>In time-sensitive datasets, a random split can cause data leakage by including future data in the training set, which biases the model. To prevent this, split data chronologically:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> 
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>


<span class="c1"># Sample data</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;customer_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
        <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">10.00</span><span class="p">,</span> <span class="mf">20.00</span><span class="p">,</span> <span class="mf">15.00</span><span class="p">,</span> <span class="mf">25.00</span><span class="p">,</span> <span class="mf">30.00</span><span class="p">],</span>
        <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;2021-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-01-02&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-01-03&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-01-04&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-01-05&#39;</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>

<span class="c1"># Random split</span>
<span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Random split:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>  <span class="c1"># May contain future dates</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>

<span class="c1"># Time-based split</span>
<span class="n">cutoff_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">cutoff_date</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">cutoff_date</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Time-based split:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Train data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">train_data</span><span class="p">)</span>  <span class="c1"># Data before the cutoff</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test data:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>   <span class="c1"># Data after the cutoff</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Random split:

Train data:
    customer_id  amount       date
2            3    15.0 2021-01-03
0            1    10.0 2021-01-01
3            4    25.0 2021-01-04
Test data:
    customer_id  amount       date
1            2    20.0 2021-01-02
4            5    30.0 2021-01-05


Time-based split:

Train data:
    customer_id  amount       date
0            1    10.0 2021-01-01
1            2    20.0 2021-01-02
2            3    15.0 2021-01-03
Test data:
    customer_id  amount       date
3            4    25.0 2021-01-04
4            5    30.0 2021-01-05
</pre></div>
</div>
</div>
</div>
</section>
<section id="timeseriessplit-for-cross-validation-in-time-series">
<h2><span class="section-number">6.2.3. </span>TimeSeriesSplit for Cross-Validation in Time Series<a class="headerlink" href="#timeseriessplit-for-cross-validation-in-time-series" title="Permalink to this heading">#</a></h2>
<p>For time series data, using <code class="docutils literal notranslate"><span class="pre">TimeSeriesSplit</span></code> ensures the temporal order is maintained during cross-validation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">TimeSeriesSplit</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="n">tscv</span> <span class="o">=</span> <span class="n">TimeSeriesSplit</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">train_index</span><span class="p">,</span> <span class="n">test_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tscv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fold </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Train=</span><span class="si">{</span><span class="n">train_index</span><span class="si">}</span><span class="s2">, Test=</span><span class="si">{</span><span class="n">test_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Fold 0: Train=[0 1 2], Test=[3]
Fold 1: Train=[0 1 2 3], Test=[4]
Fold 2: Train=[0 1 2 3 4], Test=[5]
</pre></div>
</div>
</div>
</div>
<p>This approach ensures:</p>
<ol class="arabic simple">
<li><p><strong>Temporal Integrity</strong>: Respects the data order.</p></li>
<li><p><strong>Growing Training Set</strong>: The training set increases with each fold.</p></li>
<li><p><strong>Forward-Moving Test Set</strong>: The test set is always a future sample.</p></li>
<li><p><strong>No Data Leakage</strong>: Future information is never used to predict past events.</p></li>
</ol>
</section>
<section id="enhancing-data-handling-with-scikit-learn-s-dataframe-support">
<h2><span class="section-number">6.2.4. </span>Enhancing Data Handling with scikit-learnâ€™s DataFrame Support<a class="headerlink" href="#enhancing-data-handling-with-scikit-learn-s-dataframe-support" title="Permalink to this heading">#</a></h2>
<p>By default, scikit-learn transformers return NumPy arrays. To return pandas DataFrames, use the <code class="docutils literal notranslate"><span class="pre">set_output</span></code> method:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">35</span><span class="p">],</span> <span class="s2">&quot;income&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">70000</span><span class="p">,</span> <span class="kc">None</span><span class="p">]}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s1">&#39;pandas&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        age    income
0 -1.224745 -1.224745
1  0.000000  0.000000
2       NaN  1.224745
3  1.224745       NaN
</pre></div>
</div>
</div>
</div>
<p>You can apply this in pipelines too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([(</span><span class="s2">&quot;imputer&quot;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">)),</span> 
                     <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())])</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        age    income
0 -1.414214 -1.414214
1  0.000000  0.000000
2  0.000000  1.414214
3  1.414214  0.000000
</pre></div>
</div>
</div>
</div>
</section>
<section id="efficient-feature-transformation-with-make-column-transformer-in-scikit-learn">
<h2><span class="section-number">6.2.5. </span>Efficient Feature Transformation with make_column_transformer in scikit-learn<a class="headerlink" href="#efficient-feature-transformation-with-make-column-transformer-in-scikit-learn" title="Permalink to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">make_column_transformer</span></code> allows you to apply different transformations to specific feature sets:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cat1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span>
    <span class="s2">&quot;cat2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;Z&quot;</span><span class="p">],</span>
    <span class="s2">&quot;num1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
    <span class="s2">&quot;num2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_transformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>


<span class="c1"># Define the numeric and categorical features</span>
<span class="n">numeric_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;num1&quot;</span><span class="p">,</span> <span class="s2">&quot;num2&quot;</span><span class="p">]</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cat1&quot;</span><span class="p">,</span> <span class="s2">&quot;cat2&quot;</span><span class="p">]</span>

<span class="c1"># Define the transformers and their corresponding columns</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">),</span> <span class="n">StandardScaler</span><span class="p">())</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span>
    <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s2">&quot;most_frequent&quot;</span><span class="p">),</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1"># Create the ColumnTransformer</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">make_column_transformer</span><span class="p">(</span>
    <span class="p">(</span><span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numeric_features</span><span class="p">),</span>
    <span class="p">(</span><span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">),</span>
    <span class="n">verbose_feature_names_out</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="n">transform</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">)</span>

<span class="c1"># Fit and transform the data</span>
<span class="n">X_transformed</span> <span class="o">=</span> <span class="n">preprocessor</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">X_transformed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>num1</th>
      <th>num2</th>
      <th>cat1_A</th>
      <th>cat1_B</th>
      <th>cat1_C</th>
      <th>cat2_X</th>
      <th>cat2_Y</th>
      <th>cat2_Z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-1.414214</td>
      <td>-1.791093</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000000</td>
      <td>0.393167</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.707107</td>
      <td>0.174741</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.707107</td>
      <td>1.266871</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.414214</td>
      <td>-0.043685</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>You can integrate this into a pipeline with a machine learning model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 1, 0, 0, 1])
</pre></div>
</div>
</div>
</div>
<p>This streamlines feature preprocessing and modeling in one unified workflow.</p>
</section>
<section id="functiontransformer-build-robust-preprocessing-pipelines-with-custom-transformations">
<h2><span class="section-number">6.2.6. </span>FunctionTransformer: Build Robust Preprocessing Pipelines with Custom Transformations<a class="headerlink" href="#functiontransformer-build-robust-preprocessing-pipelines-with-custom-transformations" title="Permalink to this heading">#</a></h2>
<p>If you need to apply custom transformations within a scikit-learn pipeline, the <code class="docutils literal notranslate"><span class="pre">FunctionTransformer</span></code> is a useful tool to wrap any function for preprocessing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>

<span class="n">transformer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]])</span>
<span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.        , 0.69314718],
       [1.09861229, 1.38629436]])
</pre></div>
</div>
</div>
</div>
<p>This allows you to seamlessly integrate custom functions into a pipeline, maintaining consistency across transformations for different datasets.</p>
<p>Hereâ€™s an example of using <code class="docutils literal notranslate"><span class="pre">FunctionTransformer</span></code> in a full pipeline:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">FunctionTransformer</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Create a simple pandas DataFrame</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;feature1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
    <span class="s2">&quot;feature2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
    <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Split the DataFrame into features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;feature1&quot;</span><span class="p">,</span> <span class="s2">&quot;feature2&quot;</span><span class="p">]]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>

<span class="c1"># Define the FunctionTransformer</span>
<span class="n">log_transformer</span> <span class="o">=</span> <span class="n">FunctionTransformer</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">)</span>


<span class="c1"># Define the pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span>
    <span class="p">[(</span><span class="s2">&quot;log_transform&quot;</span><span class="p">,</span> <span class="n">log_transformer</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">())]</span>
<span class="p">)</span>

<span class="c1"># Fit the pipeline on the data</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># Make predictions on new data</span>
<span class="n">new_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;feature1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="s2">&quot;feature2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]}</span>
<span class="n">new_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">new_df</span><span class="p">)</span>

<span class="c1"># Print the predictions</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predictions:&quot;</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predictions: [1 1]
</pre></div>
</div>
</div>
</div>
</section>
<section id="drop-correlated-features">
<h2><span class="section-number">6.2.7. </span>Drop Correlated Features<a class="headerlink" href="#drop-correlated-features" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>feature_engine<span class="w"> </span>
</pre></div>
</div>
</div>
</details>
</div>
<p>To remove highly correlated features, you can use <code class="docutils literal notranslate"><span class="pre">DropCorrelatedFeatures</span></code> from the <code class="docutils literal notranslate"><span class="pre">feature-engine</span></code> package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">feature_engine.selection</span> <span class="kn">import</span> <span class="n">DropCorrelatedFeatures</span>

<span class="c1"># Create a dataset with correlated variables</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">n_redundant</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_clusters_per_class</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">class_sep</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="c1"># Convert the dataset to a DataFrame</span>
<span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;var_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">colnames</span><span class="p">)</span>

<span class="c1"># Drop features with correlation above 0.8</span>
<span class="n">tr</span> <span class="o">=</span> <span class="n">DropCorrelatedFeatures</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">Xt</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Check correlated features</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Correlated features:&quot;</span><span class="p">,</span> <span class="n">tr</span><span class="o">.</span><span class="n">correlated_feature_sets_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Remaining features:&quot;</span><span class="p">,</span> <span class="n">Xt</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlated features: [{&#39;var_0&#39;, &#39;var_2&#39;, &#39;var_1&#39;}]
Remaining features: Index([&#39;var_0&#39;, &#39;var_3&#39;, &#39;var_4&#39;, &#39;var_5&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://feature-engine.trainindata.com">Link to feature-engine</a>.</p>
</section>
<section id="encode-rare-labels-with-feature-engine">
<h2><span class="section-number">6.2.8. </span>Encode Rare Labels with Feature-engine<a class="headerlink" href="#encode-rare-labels-with-feature-engine" title="Permalink to this heading">#</a></h2>
<p>Handling rare categories in high-cardinality categorical features can be simplified using the <code class="docutils literal notranslate"><span class="pre">RareLabelEncoder</span></code>. This encoder groups infrequent categories into a single value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_openml</span>
<span class="kn">from</span> <span class="nn">feature_engine.encoding</span> <span class="kn">import</span> <span class="n">RareLabelEncoder</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">fetch_openml</span><span class="p">(</span><span class="s1">&#39;dating_profile&#39;</span><span class="p">)[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>body_type</th>
      <th>diet</th>
      <th>drinks</th>
      <th>drugs</th>
      <th>education</th>
      <th>essay0</th>
      <th>essay1</th>
      <th>essay2</th>
      <th>essay3</th>
      <th>essay4</th>
      <th>...</th>
      <th>location</th>
      <th>offspring</th>
      <th>orientation</th>
      <th>pets</th>
      <th>religion</th>
      <th>sex</th>
      <th>sign</th>
      <th>smokes</th>
      <th>speaks</th>
      <th>status</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a little extra</td>
      <td>strictly anything</td>
      <td>socially</td>
      <td>never</td>
      <td>working on college/university</td>
      <td>about me:&lt;br /&gt;\n&lt;br /&gt;\ni would love to think...</td>
      <td>currently working as an international agent fo...</td>
      <td>making people laugh.&lt;br /&gt;\nranting about a go...</td>
      <td>the way i look. i am a six foot half asian, ha...</td>
      <td>books:&lt;br /&gt;\nabsurdistan, the republic, of mi...</td>
      <td>...</td>
      <td>south san francisco, california</td>
      <td>doesn&amp;rsquo;t have kids, but might want them</td>
      <td>straight</td>
      <td>likes dogs and likes cats</td>
      <td>agnosticism and very serious about it</td>
      <td>m</td>
      <td>gemini</td>
      <td>sometimes</td>
      <td>english</td>
      <td>single</td>
    </tr>
    <tr>
      <th>1</th>
      <td>average</td>
      <td>mostly other</td>
      <td>often</td>
      <td>sometimes</td>
      <td>working on space camp</td>
      <td>i am a chef: this is what that means.&lt;br /&gt;\n1...</td>
      <td>dedicating everyday to being an unbelievable b...</td>
      <td>being silly. having ridiculous amonts of fun w...</td>
      <td>None</td>
      <td>i am die hard christopher moore fan. i don't r...</td>
      <td>...</td>
      <td>oakland, california</td>
      <td>doesn&amp;rsquo;t have kids, but might want them</td>
      <td>straight</td>
      <td>likes dogs and likes cats</td>
      <td>agnosticism but not too serious about it</td>
      <td>m</td>
      <td>cancer</td>
      <td>no</td>
      <td>english (fluently), spanish (poorly), french (...</td>
      <td>single</td>
    </tr>
    <tr>
      <th>2</th>
      <td>thin</td>
      <td>anything</td>
      <td>socially</td>
      <td>None</td>
      <td>graduated from masters program</td>
      <td>i'm not ashamed of much, but writing public te...</td>
      <td>i make nerdy software for musicians, artists, ...</td>
      <td>improvising in different contexts. alternating...</td>
      <td>my large jaw and large glasses are the physica...</td>
      <td>okay this is where the cultural matrix gets so...</td>
      <td>...</td>
      <td>san francisco, california</td>
      <td>None</td>
      <td>straight</td>
      <td>has cats</td>
      <td>None</td>
      <td>m</td>
      <td>pisces but it doesn&amp;rsquo;t matter</td>
      <td>no</td>
      <td>english, french, c++</td>
      <td>available</td>
    </tr>
    <tr>
      <th>3</th>
      <td>thin</td>
      <td>vegetarian</td>
      <td>socially</td>
      <td>None</td>
      <td>working on college/university</td>
      <td>i work in a library and go to school. . .</td>
      <td>reading things written by old dead people</td>
      <td>playing synthesizers and organizing books acco...</td>
      <td>socially awkward but i do my best</td>
      <td>bataille, celine, beckett. . .&lt;br /&gt;\nlynch, j...</td>
      <td>...</td>
      <td>berkeley, california</td>
      <td>doesn&amp;rsquo;t want kids</td>
      <td>straight</td>
      <td>likes cats</td>
      <td>None</td>
      <td>m</td>
      <td>pisces</td>
      <td>no</td>
      <td>english, german (poorly)</td>
      <td>single</td>
    </tr>
    <tr>
      <th>4</th>
      <td>athletic</td>
      <td>None</td>
      <td>socially</td>
      <td>never</td>
      <td>graduated from college/university</td>
      <td>hey how's it going? currently vague on the pro...</td>
      <td>work work work work + play</td>
      <td>creating imagery to look at:&lt;br /&gt;\nhttp://bag...</td>
      <td>i smile a lot and my inquisitive nature</td>
      <td>music: bands, rappers, musicians&lt;br /&gt;\nat the...</td>
      <td>...</td>
      <td>san francisco, california</td>
      <td>None</td>
      <td>straight</td>
      <td>likes dogs and likes cats</td>
      <td>None</td>
      <td>m</td>
      <td>aquarius</td>
      <td>no</td>
      <td>english</td>
      <td>single</td>
    </tr>
    <tr>
      <th>5</th>
      <td>average</td>
      <td>mostly anything</td>
      <td>socially</td>
      <td>None</td>
      <td>graduated from college/university</td>
      <td>i'm an australian living in san francisco, but...</td>
      <td>building awesome stuff. figuring out what's im...</td>
      <td>imagining random shit. laughing at aforementio...</td>
      <td>i have a big smile. i also get asked if i'm we...</td>
      <td>books: to kill a mockingbird, lord of the ring...</td>
      <td>...</td>
      <td>san francisco, california</td>
      <td>doesn&amp;rsquo;t have kids, but might want them</td>
      <td>straight</td>
      <td>likes cats</td>
      <td>atheism</td>
      <td>m</td>
      <td>taurus</td>
      <td>no</td>
      <td>english (fluently), chinese (okay)</td>
      <td>single</td>
    </tr>
    <tr>
      <th>6</th>
      <td>fit</td>
      <td>strictly anything</td>
      <td>socially</td>
      <td>never</td>
      <td>graduated from college/university</td>
      <td>life is about the little things. i love to lau...</td>
      <td>digging up buried treasure</td>
      <td>frolicking&lt;br /&gt;\nwitty banter&lt;br /&gt;\nusing my...</td>
      <td>i am the last unicorn</td>
      <td>i like books. ones with pictures. reading them...</td>
      <td>...</td>
      <td>san francisco, california</td>
      <td>None</td>
      <td>straight</td>
      <td>likes dogs and likes cats</td>
      <td>None</td>
      <td>f</td>
      <td>virgo</td>
      <td>None</td>
      <td>english</td>
      <td>single</td>
    </tr>
    <tr>
      <th>7</th>
      <td>average</td>
      <td>mostly anything</td>
      <td>socially</td>
      <td>never</td>
      <td>graduated from college/university</td>
      <td>None</td>
      <td>writing. meeting new people, spending time wit...</td>
      <td>remembering people's birthdays, sending cards,...</td>
      <td>i'm rather approachable (a byproduct of being ...</td>
      <td>i like: alphabetized lists, aquariums, autobio...</td>
      <td>...</td>
      <td>san francisco, california</td>
      <td>doesn&amp;rsquo;t have kids, but wants them</td>
      <td>straight</td>
      <td>likes dogs and likes cats</td>
      <td>christianity</td>
      <td>f</td>
      <td>sagittarius</td>
      <td>no</td>
      <td>english, spanish (okay)</td>
      <td>single</td>
    </tr>
    <tr>
      <th>8</th>
      <td>None</td>
      <td>strictly anything</td>
      <td>socially</td>
      <td>None</td>
      <td>graduated from college/university</td>
      <td>None</td>
      <td>oh goodness. at the moment i have 4 jobs, so i...</td>
      <td>None</td>
      <td>i'm freakishly blonde and have the same name a...</td>
      <td>i am always willing to try new foods and am no...</td>
      <td>...</td>
      <td>belvedere tiburon, california</td>
      <td>doesn&amp;rsquo;t have kids</td>
      <td>straight</td>
      <td>likes dogs and likes cats</td>
      <td>christianity but not too serious about it</td>
      <td>f</td>
      <td>gemini but it doesn&amp;rsquo;t matter</td>
      <td>when drinking</td>
      <td>english</td>
      <td>single</td>
    </tr>
    <tr>
      <th>9</th>
      <td>athletic</td>
      <td>mostly anything</td>
      <td>not at all</td>
      <td>never</td>
      <td>working on two-year college</td>
      <td>my names jake.&lt;br /&gt;\ni'm a creative guy and i...</td>
      <td>i have an apartment. i like to explore and che...</td>
      <td>i'm good at finding creative solutions to prob...</td>
      <td>i'm short</td>
      <td>i like some tv. i love summer heights high and...</td>
      <td>...</td>
      <td>san mateo, california</td>
      <td>None</td>
      <td>straight</td>
      <td>likes dogs and likes cats</td>
      <td>atheism and laughing about it</td>
      <td>m</td>
      <td>cancer but it doesn&amp;rsquo;t matter</td>
      <td>no</td>
      <td>english (fluently)</td>
      <td>single</td>
    </tr>
  </tbody>
</table>
<p>10 rows Ã— 30 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Drop rows with missing values in &#39;education&#39; column</span>

<span class="n">processed</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;education&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>In the code below,</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tol</span></code> species the minimum frequency below which a category is considered rare.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">replace_with</span></code> species the value to be used to replace rare categories.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">variables</span></code> specify the list of categorical variables that will be encoded.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoder</span> <span class="o">=</span> <span class="n">RareLabelEncoder</span><span class="p">(</span><span class="n">tol</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;education&quot;</span><span class="p">],</span> <span class="n">replace_with</span><span class="o">=</span><span class="s2">&quot;Other&quot;</span><span class="p">)</span>
<span class="n">encoded</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">processed</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now the rare categories in the column <code class="docutils literal notranslate"><span class="pre">education</span></code> are replaced with â€œOtherâ€.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encoded</span><span class="p">[</span><span class="s1">&#39;education&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>46107                                Other
45677       graduated from masters program
57928    graduated from college/university
53127        working on college/university
33300                                Other
33648       graduated from masters program
59701                                Other
57013       graduated from masters program
46428    graduated from college/university
57123    graduated from college/university
Name: education, dtype: object
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://feature-engine.trainindata.com">Link to feature-engine</a>.</p>
</section>
<section id="encode-categorical-data-using-frequency">
<h2><span class="section-number">6.2.9. </span>Encode Categorical Data Using Frequency<a class="headerlink" href="#encode-categorical-data-using-frequency" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>feature-engine
</pre></div>
</div>
</div>
</details>
</div>
<p>Sometimes, encoding categorical variables based on frequency or count can improve model performance. <code class="docutils literal notranslate"><span class="pre">CountFrequencyEncoder</span></code> from <code class="docutils literal notranslate"><span class="pre">feature-engine</span></code> helps achieve this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">feature_engine.encoding</span> <span class="kn">import</span> <span class="n">CountFrequencyEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;diamonds&quot;</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;price&quot;</span><span class="p">],</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>441</th>
      <td>0.89</td>
      <td>Premium</td>
      <td>H</td>
      <td>SI2</td>
      <td>60.2</td>
      <td>59.0</td>
      <td>2815</td>
      <td>6.26</td>
      <td>6.23</td>
      <td>3.76</td>
    </tr>
    <tr>
      <th>50332</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>64.0</td>
      <td>53.0</td>
      <td>2242</td>
      <td>5.57</td>
      <td>5.61</td>
      <td>3.58</td>
    </tr>
    <tr>
      <th>35652</th>
      <td>0.31</td>
      <td>Ideal</td>
      <td>G</td>
      <td>VVS2</td>
      <td>62.7</td>
      <td>57.0</td>
      <td>907</td>
      <td>4.33</td>
      <td>4.31</td>
      <td>2.71</td>
    </tr>
    <tr>
      <th>9439</th>
      <td>0.90</td>
      <td>Very Good</td>
      <td>H</td>
      <td>VS1</td>
      <td>62.3</td>
      <td>59.0</td>
      <td>4592</td>
      <td>6.12</td>
      <td>6.17</td>
      <td>3.83</td>
    </tr>
    <tr>
      <th>15824</th>
      <td>1.01</td>
      <td>Good</td>
      <td>F</td>
      <td>VS2</td>
      <td>60.6</td>
      <td>62.0</td>
      <td>6332</td>
      <td>6.52</td>
      <td>6.49</td>
      <td>3.94</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>45891</th>
      <td>0.52</td>
      <td>Premium</td>
      <td>F</td>
      <td>VS2</td>
      <td>60.7</td>
      <td>59.0</td>
      <td>1720</td>
      <td>5.18</td>
      <td>5.14</td>
      <td>3.13</td>
    </tr>
    <tr>
      <th>52416</th>
      <td>0.70</td>
      <td>Good</td>
      <td>D</td>
      <td>SI1</td>
      <td>63.6</td>
      <td>60.0</td>
      <td>2512</td>
      <td>5.59</td>
      <td>5.51</td>
      <td>3.51</td>
    </tr>
    <tr>
      <th>42613</th>
      <td>0.32</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS1</td>
      <td>61.3</td>
      <td>58.0</td>
      <td>505</td>
      <td>4.35</td>
      <td>4.39</td>
      <td>2.68</td>
    </tr>
    <tr>
      <th>43567</th>
      <td>0.41</td>
      <td>Ideal</td>
      <td>G</td>
      <td>IF</td>
      <td>61.0</td>
      <td>57.0</td>
      <td>1431</td>
      <td>4.81</td>
      <td>4.79</td>
      <td>2.93</td>
    </tr>
    <tr>
      <th>2732</th>
      <td>0.91</td>
      <td>Ideal</td>
      <td>F</td>
      <td>SI2</td>
      <td>61.1</td>
      <td>55.0</td>
      <td>3246</td>
      <td>6.24</td>
      <td>6.19</td>
      <td>3.80</td>
    </tr>
  </tbody>
</table>
<p>40455 rows Ã— 10 columns</p>
</div></div><script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 35;
                var nbb_unformatted_code = "import seaborn as sns\nfrom feature_engine.encoding import CountFrequencyEncoder\nfrom sklearn.model_selection import train_test_split\n\ndata = sns.load_dataset(\"diamonds\")\n\nX_train, X_test, y_train, y_test = train_test_split(data, data[\"price\"], random_state=0)\nX_train";
                var nbb_formatted_code = "import seaborn as sns\nfrom feature_engine.encoding import CountFrequencyEncoder\nfrom sklearn.model_selection import train_test_split\n\ndata = sns.load_dataset(\"diamonds\")\n\nX_train, X_test, y_train, y_test = train_test_split(data, data[\"price\"], random_state=0)\nX_train";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>Encode <code class="docutils literal notranslate"><span class="pre">color</span></code> and <code class="docutils literal notranslate"><span class="pre">clarity</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initiate an encoder</span>
<span class="n">encoder</span> <span class="o">=</span> <span class="n">CountFrequencyEncoder</span><span class="p">(</span>
    <span class="n">encoding_method</span><span class="o">=</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;clarity&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># fit the encoder</span>
<span class="n">encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="c1"># process the data</span>
<span class="n">p_train</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">p_test</span> <span class="o">=</span> <span class="n">encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 36;
                var nbb_unformatted_code = "# initiate an encoder\nencoder = CountFrequencyEncoder(\n    encoding_method=\"frequency\", variables=[\"color\", \"clarity\"]\n)\n\n# fit the encoder\nencoder.fit(X_train)\n\n# process the data\np_train = encoder.transform(X_train)\np_test = encoder.transform(X_test)";
                var nbb_formatted_code = "# initiate an encoder\nencoder = CountFrequencyEncoder(\n    encoding_method=\"frequency\", variables=[\"color\", \"clarity\"]\n)\n\n# fit the encoder\nencoder.fit(X_train)\n\n# process the data\np_train = encoder.transform(X_train)\np_test = encoder.transform(X_test)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_test</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10176</th>
      <td>1.10</td>
      <td>Ideal</td>
      <td>0.152762</td>
      <td>0.170436</td>
      <td>62.0</td>
      <td>55.0</td>
      <td>4733</td>
      <td>6.61</td>
      <td>6.65</td>
      <td>4.11</td>
    </tr>
    <tr>
      <th>16083</th>
      <td>1.29</td>
      <td>Ideal</td>
      <td>0.152762</td>
      <td>0.242022</td>
      <td>62.6</td>
      <td>56.0</td>
      <td>6424</td>
      <td>6.96</td>
      <td>6.93</td>
      <td>4.35</td>
    </tr>
    <tr>
      <th>13420</th>
      <td>1.20</td>
      <td>Premium</td>
      <td>0.100531</td>
      <td>0.242022</td>
      <td>61.1</td>
      <td>58.0</td>
      <td>5510</td>
      <td>6.88</td>
      <td>6.80</td>
      <td>4.18</td>
    </tr>
    <tr>
      <th>20407</th>
      <td>1.50</td>
      <td>Ideal</td>
      <td>0.179409</td>
      <td>0.242022</td>
      <td>60.9</td>
      <td>56.0</td>
      <td>8770</td>
      <td>7.43</td>
      <td>7.36</td>
      <td>4.50</td>
    </tr>
    <tr>
      <th>8909</th>
      <td>0.90</td>
      <td>Very Good</td>
      <td>0.179409</td>
      <td>0.227314</td>
      <td>61.7</td>
      <td>57.0</td>
      <td>4493</td>
      <td>6.17</td>
      <td>6.21</td>
      <td>3.82</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>52283</th>
      <td>0.59</td>
      <td>Very Good</td>
      <td>0.182005</td>
      <td>0.094401</td>
      <td>61.7</td>
      <td>59.0</td>
      <td>2494</td>
      <td>5.37</td>
      <td>5.36</td>
      <td>3.31</td>
    </tr>
    <tr>
      <th>10789</th>
      <td>1.00</td>
      <td>Fair</td>
      <td>0.152762</td>
      <td>0.227314</td>
      <td>64.8</td>
      <td>62.0</td>
      <td>4861</td>
      <td>6.22</td>
      <td>6.13</td>
      <td>4.00</td>
    </tr>
    <tr>
      <th>1190</th>
      <td>0.70</td>
      <td>Very Good</td>
      <td>0.179409</td>
      <td>0.094401</td>
      <td>63.2</td>
      <td>58.0</td>
      <td>2932</td>
      <td>5.66</td>
      <td>5.60</td>
      <td>3.56</td>
    </tr>
    <tr>
      <th>3583</th>
      <td>0.59</td>
      <td>Ideal</td>
      <td>0.182005</td>
      <td>0.067384</td>
      <td>60.7</td>
      <td>57.0</td>
      <td>3422</td>
      <td>5.41</td>
      <td>5.45</td>
      <td>3.29</td>
    </tr>
    <tr>
      <th>40845</th>
      <td>0.46</td>
      <td>Premium</td>
      <td>0.182005</td>
      <td>0.227314</td>
      <td>61.5</td>
      <td>60.0</td>
      <td>1173</td>
      <td>4.95</td>
      <td>4.91</td>
      <td>3.03</td>
    </tr>
  </tbody>
</table>
<p>13485 rows Ã— 10 columns</p>
</div></div><script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 37;
                var nbb_unformatted_code = "p_test";
                var nbb_formatted_code = "p_test";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p><a class="reference external" href="https://feature-engine.trainindata.com">Link to feature-engine</a>.</p>
</section>
<section id="similarity-encoding-for-dirty-categories-using-dirty-cat">
<h2><span class="section-number">6.2.10. </span>Similarity Encoding for Dirty Categories Using dirty_cat<a class="headerlink" href="#similarity-encoding-for-dirty-categories-using-dirty-cat" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>dirty-cat
</pre></div>
</div>
</div>
</details>
</div>
<p>To handle dirty categorical variables, use dirty_catâ€™s <code class="docutils literal notranslate"><span class="pre">SimilarityEncoder</span></code>. This captures similarities between categories that may contain typos or variations.</p>
<p>Example using the employee_salaries dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dirty_cat.datasets</span> <span class="kn">import</span> <span class="n">fetch_employee_salaries</span>
<span class="kn">from</span> <span class="nn">dirty_cat</span> <span class="kn">import</span> <span class="n">SimilarityEncoder</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">fetch_employee_salaries</span><span class="p">()</span><span class="o">.</span><span class="n">X</span>
<span class="n">X</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gender</th>
      <th>department</th>
      <th>department_name</th>
      <th>division</th>
      <th>assignment_category</th>
      <th>employee_position_title</th>
      <th>underfilled_job_title</th>
      <th>date_first_hired</th>
      <th>year_first_hired</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>F</td>
      <td>POL</td>
      <td>Department of Police</td>
      <td>MSB Information Mgmt and Tech Division Records...</td>
      <td>Fulltime-Regular</td>
      <td>Office Services Coordinator</td>
      <td>NaN</td>
      <td>09/22/1986</td>
      <td>1986</td>
    </tr>
    <tr>
      <th>1</th>
      <td>M</td>
      <td>POL</td>
      <td>Department of Police</td>
      <td>ISB Major Crimes Division Fugitive Section</td>
      <td>Fulltime-Regular</td>
      <td>Master Police Officer</td>
      <td>NaN</td>
      <td>09/12/1988</td>
      <td>1988</td>
    </tr>
    <tr>
      <th>2</th>
      <td>F</td>
      <td>HHS</td>
      <td>Department of Health and Human Services</td>
      <td>Adult Protective and Case Management Services</td>
      <td>Fulltime-Regular</td>
      <td>Social Worker IV</td>
      <td>NaN</td>
      <td>11/19/1989</td>
      <td>1989</td>
    </tr>
    <tr>
      <th>3</th>
      <td>M</td>
      <td>COR</td>
      <td>Correction and Rehabilitation</td>
      <td>PRRS Facility and Security</td>
      <td>Fulltime-Regular</td>
      <td>Resident Supervisor II</td>
      <td>NaN</td>
      <td>05/05/2014</td>
      <td>2014</td>
    </tr>
    <tr>
      <th>4</th>
      <td>M</td>
      <td>HCA</td>
      <td>Department of Housing and Community Affairs</td>
      <td>Affordable Housing Programs</td>
      <td>Fulltime-Regular</td>
      <td>Planning Specialist III</td>
      <td>NaN</td>
      <td>03/05/2007</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>5</th>
      <td>M</td>
      <td>POL</td>
      <td>Department of Police</td>
      <td>PSB 6th District Special Assignment Team</td>
      <td>Fulltime-Regular</td>
      <td>Police Officer III</td>
      <td>NaN</td>
      <td>07/16/2007</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>6</th>
      <td>F</td>
      <td>FRS</td>
      <td>Fire and Rescue Services</td>
      <td>EMS Billing</td>
      <td>Fulltime-Regular</td>
      <td>Accountant/Auditor II</td>
      <td>NaN</td>
      <td>06/27/2016</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>7</th>
      <td>M</td>
      <td>HHS</td>
      <td>Department of Health and Human Services</td>
      <td>Head Start</td>
      <td>Fulltime-Regular</td>
      <td>Administrative Specialist II</td>
      <td>NaN</td>
      <td>11/17/2014</td>
      <td>2014</td>
    </tr>
    <tr>
      <th>8</th>
      <td>M</td>
      <td>FRS</td>
      <td>Fire and Rescue Services</td>
      <td>Recruit Training</td>
      <td>Fulltime-Regular</td>
      <td>Firefighter/Rescuer III</td>
      <td>Firefighter/Rescuer I (Recruit)</td>
      <td>12/12/2016</td>
      <td>2016</td>
    </tr>
    <tr>
      <th>9</th>
      <td>F</td>
      <td>POL</td>
      <td>Department of Police</td>
      <td>FSB Traffic Division Automated Traffic Enforce...</td>
      <td>Fulltime-Regular</td>
      <td>Police Aide</td>
      <td>NaN</td>
      <td>02/05/2007</td>
      <td>2007</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dirty_column</span> <span class="o">=</span> <span class="s2">&quot;employee_position_title&quot;</span>
<span class="n">X_dirty</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">dirty_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X_dirty</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;Office Services Coordinator&#39;, &#39;Master Police Officer&#39;,
       &#39;Social Worker IV&#39;, &#39;Resident Supervisor II&#39;,
       &#39;Planning Specialist III&#39;, &#39;Police Officer III&#39;,
       &#39;Accountant/Auditor II&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>We can see that titles such as â€˜Master Police Officerâ€™ and â€˜Police Officer IIIâ€™ are similar. We can use <code class="docutils literal notranslate"><span class="pre">SimilaryEncoder</span></code> to get an array that encodes the similarity between different job titles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">enc</span> <span class="o">=</span> <span class="n">SimilarityEncoder</span><span class="p">(</span><span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;ngram&quot;</span><span class="p">)</span>
<span class="n">X_enc</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_dirty</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">X_enc</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0.05882353, 0.03125   , 0.02739726, 0.19008264, 1.        ,
        0.01351351, 0.05555556, 0.20535714, 0.08088235, 0.032     ],
       [0.008     , 0.02083333, 0.056     , 1.        , 0.19008264,
        0.02325581, 0.23076923, 0.56      , 0.01574803, 0.02777778],
       [0.03738318, 0.07317073, 0.05405405, 0.02777778, 0.032     ,
        0.0733945 , 0.        , 0.0625    , 0.06542056, 1.        ],
       [0.11206897, 0.07142857, 0.09756098, 0.01574803, 0.08088235,
        0.07142857, 0.03125   , 0.08108108, 1.        , 0.06542056],
       [0.04761905, 0.3539823 , 0.06976744, 0.02325581, 0.01351351,
        1.        , 0.02      , 0.09821429, 0.07142857, 0.0733945 ],
       [0.0733945 , 0.05343511, 0.14953271, 0.56      , 0.20535714,
        0.09821429, 0.26086957, 1.        , 0.08108108, 0.0625    ],
       [1.        , 0.05      , 0.06451613, 0.008     , 0.05882353,
        0.04761905, 0.01052632, 0.0733945 , 0.11206897, 0.03738318],
       [0.05      , 1.        , 0.03378378, 0.02083333, 0.03125   ,
        0.3539823 , 0.02631579, 0.05343511, 0.07142857, 0.07317073],
       [0.06451613, 0.03378378, 1.        , 0.056     , 0.02739726,
        0.06976744, 0.        , 0.14953271, 0.09756098, 0.05405405],
       [0.01052632, 0.02631579, 0.        , 0.23076923, 0.05555556,
        0.02      , 1.        , 0.26086957, 0.03125   , 0.        ]])
</pre></div>
</div>
</div>
</div>
<p>To better visualize the similarity, create a heatmap:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">normalize</span>
<span class="kn">from</span> <span class="nn">IPython.core.pylabtools</span> <span class="kn">import</span> <span class="n">figsize</span>

<span class="k">def</span> <span class="nf">plot_similarity</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
  
    <span class="n">normalized_features</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    
    <span class="c1"># Create correction matrix</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">normalized_features</span><span class="p">,</span> <span class="n">normalized_features</span><span class="p">)</span>
    
    <span class="c1"># Plot</span>
    <span class="n">figsize</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlOrRd&quot;</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
        
    <span class="n">g</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Similarity&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">encode_and_plot</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
  
    <span class="n">enc</span> <span class="o">=</span> <span class="n">SimilarityEncoder</span><span class="p">(</span><span class="n">similarity</span><span class="o">=</span><span class="s2">&quot;ngram&quot;</span><span class="p">)</span> <span class="c1"># Encode</span>
    <span class="n">X_enc</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="n">plot_similarity</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">X_enc</span><span class="p">)</span> <span class="c1"># Plot</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">encode_and_plot</span><span class="p">(</span><span class="n">X_dirty</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/128b4d668af3f4ba5dd4214e921d6d6ee1564d41922293dc374d2c0ea9fdf6f2.png" src="../_images/128b4d668af3f4ba5dd4214e921d6d6ee1564d41922293dc374d2c0ea9fdf6f2.png" />
</div>
</div>
<p>As we can see from the matrix above,</p>
<ul class="simple">
<li><p>The similarity between the same strings such as â€˜Office Services Coordinatorâ€™ and â€˜Office Services Coordinatorâ€™ is 1</p></li>
<li><p>The similarity between somewhat similar strings such as â€˜Office Services Coordinatorâ€™ and â€˜Master Police Officerâ€™ is 0.41</p></li>
<li><p>The similarity between two very different strings such as â€˜Social Worker IVâ€™ and â€˜Polic Aideâ€™ is 0.028</p></li>
</ul>
<p><a class="reference external" href="https://dirty-cat.github.io/">Link to dirty-cat</a>.</p>
</section>
<section id="how-to-handle-misspellings-in-real-world-datasets">
<h2><span class="section-number">6.2.11. </span>How to Handle Misspellings in Real-World Datasets<a class="headerlink" href="#how-to-handle-misspellings-in-real-world-datasets" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/skrub-data/skrub.git
</pre></div>
</div>
</div>
</details>
</div>
<p>Real-world datasets often contain misspellings and variations in categorical variables, especially when data is manually entered. This can cause issues with data analysis steps that require exact matching, such as GROUP BY operations.</p>
<p>skrubâ€™s <code class="docutils literal notranslate"><span class="pre">deduplicate()</span></code> function helps solve this problem by using unsupervised learning to cluster similar strings and automatically correct misspellings.</p>
<p>To demonstrate the deduplicate function, start with generating a duplicated dataset:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrub.datasets</span> <span class="kn">import</span> <span class="n">make_deduplication_data</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">duplicated_food</span> <span class="o">=</span> <span class="n">make_deduplication_data</span><span class="p">(</span>
    <span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Chocolate&quot;</span><span class="p">,</span> <span class="s2">&quot;Broccoli&quot;</span><span class="p">,</span> <span class="s1">&#39;Jalapeno&#39;</span><span class="p">,</span> <span class="s1">&#39;Zucchini&#39;</span><span class="p">],</span>  
    <span class="n">entries_per_example</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>  <span class="c1"># their respective number of occurrences</span>
    <span class="n">prob_mistake_per_letter</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># 5% probability of typo per letter</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>  <span class="c1"># set seed for reproducibility</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Get the most common food names:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">duplicated_food</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Chocolate&#39;,
 &#39;Cgocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chqcolate&#39;,
 &#39;Chocoltte&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocdlate&#39;,
 &#39;Chocolate&#39;,
 &#39;ehocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolatw&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Chocolate&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Brocroli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Brojcoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccsli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccqli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Bxoccoli&#39;,
 &#39;sroccoli&#39;,
 &#39;Brzccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Broccoli&#39;,
 &#39;Jylapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapony&#39;,
 &#39;valapeno&#39;,
 &#39;Jalaoeno&#39;,
 &#39;Jalapxno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalakeno&#39;,
 &#39;Japapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;qalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jzlapeno&#39;,
 &#39;Jalapend&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapenh&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalqceno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeto&#39;,
 &#39;Jalaoeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;oalapeno&#39;,
 &#39;Jalxpeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Jalapeno&#39;,
 &#39;Zucchtni&#39;,
 &#39;Zucchini&#39;,
 &#39;Zycchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchzni&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zuckhini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchifi&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;,
 &#39;Zucchini&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">duplicated_food</span><span class="p">)</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()[:</span><span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jalapeno     284
Zucchini     195
Broccoli     193
Chocolate     94
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>The most common words in the dataset are â€˜Jalapenoâ€™, â€˜Zucchiniâ€™, and â€˜Broccoliâ€™. Therefore, skubâ€™s deduplicate function replaces misspelled words with the closest matching word from this set.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrub</span> <span class="kn">import</span> <span class="n">deduplicate</span>

<span class="c1"># create a table that maps original to corrected categories</span>
<span class="n">translation_table</span> <span class="o">=</span> <span class="n">deduplicate</span><span class="p">(</span><span class="n">duplicated_food</span><span class="p">)</span>

<span class="c1"># remove duplicated rows</span>
<span class="n">translation_table</span> <span class="o">=</span> <span class="n">translation_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="s1">&#39;mispelled_food&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;corrected_food&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

<span class="c1"># view 10 sample rows</span>
<span class="nb">print</span><span class="p">(</span><span class="n">translation_table</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    mispelled_food corrected_food
122       sroccoli       Broccoli
123       Brzccoli       Broccoli
336       oalapeno       Jalapeno
600       Zucchtni       Zucchini
301       Jalapeno       Jalapeno
105       Brojcoli       Broccoli
602       Zycchini       Zucchini
0        Chocolate      Chocolate
617       Zucchzni       Zucchini
319       Jalapend       Jalapeno
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/skrub-data/skrub/">Link to skub</a>.</p>
</section>
<section id="solving-data-mismatches-joining-tables-with-fuzzy-matching">
<h2><span class="section-number">6.2.12. </span>Solving Data Mismatches: Joining Tables with Fuzzy Matching<a class="headerlink" href="#solving-data-mismatches-joining-tables-with-fuzzy-matching" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/skrub-data/skrub.git
</pre></div>
</div>
</div>
</details>
</div>
<p>When joining two tables with non-exact matching entries, such as â€œYemen*â€ in one table and â€œYemen, Rep.â€ in another, use skrubâ€™s <code class="docutils literal notranslate"><span class="pre">fuzzy_join()</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://raw.githubusercontent.com/skrub-data/datasets/master/data/Happiness_report_2022.csv&quot;</span><span class="p">,</span>
    <span class="n">thousands</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="s2">&quot;Happiness score&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrub.datasets</span> <span class="kn">import</span> <span class="n">fetch_world_bank_indicator</span>
<span class="n">gdppc</span> <span class="o">=</span> <span class="n">fetch_world_bank_indicator</span><span class="p">(</span><span class="n">indicator_id</span><span class="o">=</span><span class="s2">&quot;NY.GDP.PCAP.CD&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">X</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       Country  Happiness score
107  Venezuela           4925.0
76     Vietnam           5485.0
131     Yemen*           4197.0
136     Zambia           3760.0
143   Zimbabwe           2995.0
146         xx              NaN
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">gdppc</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;Country Name&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>           Country Name  GDP per capita (current US$)
193  West Bank and Gaza                   3789.327966
255               World                  12647.480789
258         Yemen, Rep.                    701.714878
260              Zambia                   1487.907764
261            Zimbabwe                   1266.996031
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skrub</span> <span class="kn">import</span> <span class="n">fuzzy_join</span>

<span class="n">df1</span> <span class="o">=</span> <span class="n">fuzzy_join</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>  <span class="c1"># our table to join</span>
    <span class="n">gdppc</span><span class="p">,</span>  <span class="c1"># the table to join with</span>
    <span class="n">left_on</span><span class="o">=</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span>  <span class="c1"># the first join key column</span>
    <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;Country Name&quot;</span><span class="p">,</span>  <span class="c1"># the second join key column</span>
    <span class="n">return_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">df1</span><span class="p">[[</span><span class="s1">&#39;Country&#39;</span><span class="p">,</span> <span class="s1">&#39;Country Name&#39;</span><span class="p">,</span> <span class="s2">&quot;matching_score&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
<span class="c1"># We merged the first WB table to our initial one.</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>          Country                                 Country Name  matching_score
127   Madagascar*                                   Madagascar        0.795045
128         Egypt                             Egypt, Arab Rep.        0.654033
129         Chad*                                         Chad        0.683373
130      Ethiopia                                     Ethiopia        1.000000
131        Yemen*                                  Yemen, Rep.        0.653668
132   Mauritania*                                   Mauritania        0.810736
133        Jordan                                       Jordan        1.000000
134          Togo                                         Togo        1.000000
135         India                                        India        1.000000
136        Zambia                                       Zambia        1.000000
137        Malawi                                       Malawi        1.000000
138      Tanzania                                     Tanzania        1.000000
139  Sierra Leone                                 Sierra Leone        1.000000
140      Lesotho*                                      Lesotho        0.755238
141     Botswana*                                     Botswana        0.795825
142       Rwanda*                                       Rwanda        0.754604
143      Zimbabwe                                     Zimbabwe        1.000000
144       Lebanon                                      Lebanon        1.000000
145   Afghanistan                                  Afghanistan        1.000000
146            xx  East Asia &amp; Pacific (excluding high income)        0.500000
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/skrub-data/skrub/">Link to skrub</a>.</p>
</section>
<section id="snorkel-programmatically-build-training-data-in-python">
<h2><span class="section-number">6.2.13. </span>Snorkel â€” Programmatically Build Training Data in Python<a class="headerlink" href="#snorkel-programmatically-build-training-data-in-python" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>snorkel
</pre></div>
</div>
</div>
</details>
</div>
<p>Letâ€™s say you want to detect fake job postings based on a few assumptions:</p>
<ul class="simple">
<li><p>Few or no requirements make a job likely fake.</p></li>
<li><p>No company profile or logo is a red flag.</p></li>
<li><p>Real jobs usually require education or experience.</p></li>
</ul>
<p>You can load a sample dataset like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>


<span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/khuyentran1401/Data-science/blob/master/feature_engineering/snorkel_example/train_fake_jobs.pkl?raw=true&quot;</span>
<span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>job_id</th>
      <th>title</th>
      <th>location</th>
      <th>department</th>
      <th>salary_range</th>
      <th>company_profile</th>
      <th>description</th>
      <th>requirements</th>
      <th>benefits</th>
      <th>telecommuting</th>
      <th>has_company_logo</th>
      <th>has_questions</th>
      <th>employment_type</th>
      <th>required_experience</th>
      <th>required_education</th>
      <th>industry</th>
      <th>function</th>
      <th>fraudulent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12276</th>
      <td>12277</td>
      <td>Big Data Analyst</td>
      <td>GB, WSM, London</td>
      <td>Product Ops</td>
      <td>NaN</td>
      <td>Founded in 2010 by a team from Googleâ€™s London...</td>
      <td>Qubit: Cutting Edge Big Data EngineeringQubit ...</td>
      <td>What you'll need: A background in consulting, ...</td>
      <td>Plenty of perks:As well as the opportunity to ...</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>Full-time</td>
      <td>Associate</td>
      <td>Bachelor's Degree</td>
      <td>Internet</td>
      <td>Product Management</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14680</th>
      <td>14681</td>
      <td>Instructional Advocate</td>
      <td>US, GA, Savannah</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>We are an after-school program committed to as...</td>
      <td>21st Century Community Learning Centers is an ...</td>
      <td>Bachelor's Degree or an Associate's Degree; or...</td>
      <td>NaN</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Part-time</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>Education</td>
      <td>0</td>
    </tr>
    <tr>
      <th>16518</th>
      <td>16519</td>
      <td>Software Developer</td>
      <td>US, FL, Gainesville</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>352 Inc. is a full-service digital agency crea...</td>
      <td>We partner with great clients to build smart s...</td>
      <td>3-5 years of great c# work Experience in mvc o...</td>
      <td>What Youâ€™ll GetFreedom: We trust you to do you...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Full-time</td>
      <td>Mid-Senior level</td>
      <td>NaN</td>
      <td>Computer Software</td>
      <td>Information Technology</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15478</th>
      <td>15479</td>
      <td>Internship in India</td>
      <td>IN, , Bangalore</td>
      <td>NaN</td>
      <td>NaN</td>
      <td></td>
      <td>London is a fast paced city of culture, divers...</td>
      <td></td>
      <td>As specialists in delivering high quality and ...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0</td>
    </tr>
    <tr>
      <th>16348</th>
      <td>16349</td>
      <td>Web Developer Backend Microservices (m/f)</td>
      <td>DE, BE, 10969</td>
      <td>Engineering</td>
      <td>NaN</td>
      <td>airfy prÃ¤gt sicheres und einfach zu bedienende...</td>
      <td>Design and develop a microservice platform for...</td>
      <td>Senior level experience with web backends, esp...</td>
      <td>Flat hierarchies and a productive work environ...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>Full-time</td>
      <td>Associate</td>
      <td>Bachelor's Degree</td>
      <td>Internet</td>
      <td>Engineering</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div><script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 22;
                var nbb_unformatted_code = "import pandas as pd \nimport warnings\nwarnings.simplefilter(action='ignore', category=FutureWarning)\n\n\ntrain_df = pd.read_pickle(\n    \"https://github.com/khuyentran1401/Data-science/blob/master/feature_engineering/snorkel_example/train_fake_jobs.pkl?raw=true\"\n)\ntrain_df.head(5)";
                var nbb_formatted_code = "import pandas as pd\nimport warnings\n\nwarnings.simplefilter(action=\"ignore\", category=FutureWarning)\n\n\ntrain_df = pd.read_pickle(\n    \"https://github.com/khuyentran1401/Data-science/blob/master/feature_engineering/snorkel_example/train_fake_jobs.pkl?raw=true\"\n)\ntrain_df.head(5)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>Snorkel helps programmatically label data. Start by defining labels:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">snorkel.labeling</span> <span class="kn">import</span> <span class="n">labeling_function</span><span class="p">,</span> <span class="n">PandasLFApplier</span><span class="p">,</span> <span class="n">LFAnalysis</span>

<span class="n">FAKE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">REAL</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ABSTAIN</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 15;
                var nbb_unformatted_code = "from snorkel.labeling import labeling_function, PandasLFApplier, LFAnalysis\n\nFAKE = 1\nREAL = 0\nABSTAIN = -1";
                var nbb_formatted_code = "from snorkel.labeling import labeling_function, PandasLFApplier, LFAnalysis\n\nFAKE = 1\nREAL = 0\nABSTAIN = -1";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>You can create labeling functions to reflect your assumptions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@labeling_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">no_company_profile</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">FAKE</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">company_profile</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="n">ABSTAIN</span>


<span class="nd">@labeling_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">no_company_logo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">FAKE</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">has_company_logo</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">ABSTAIN</span>


<span class="nd">@labeling_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">required_experience</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">REAL</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">required_experience</span> <span class="k">else</span> <span class="n">ABSTAIN</span>


<span class="nd">@labeling_function</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">required_education</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">REAL</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">required_education</span> <span class="k">else</span> <span class="n">ABSTAIN</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 29;
                var nbb_unformatted_code = "@labeling_function()\ndef no_company_profile(x: pd.Series):\n    return FAKE if x.company_profile == \"\" else ABSTAIN\n\n\n@labeling_function()\ndef no_company_logo(x: pd.Series):\n    return FAKE if x.has_company_logo == 0 else ABSTAIN\n\n@labeling_function()\ndef required_experience(x: pd.Series):\n    return REAL if x.required_experience else ABSTAIN\n\n\n@labeling_function()\ndef required_education(x: pd.Series):\n    return REAL if x.required_education else ABSTAIN";
                var nbb_formatted_code = "@labeling_function()\ndef no_company_profile(x: pd.Series):\n    return FAKE if x.company_profile == \"\" else ABSTAIN\n\n\n@labeling_function()\ndef no_company_logo(x: pd.Series):\n    return FAKE if x.has_company_logo == 0 else ABSTAIN\n\n\n@labeling_function()\ndef required_experience(x: pd.Series):\n    return REAL if x.required_experience else ABSTAIN\n\n\n@labeling_function()\ndef required_education(x: pd.Series):\n    return REAL if x.required_education else ABSTAIN";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>Use these functions to label your data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lfs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">no_company_profile</span><span class="p">,</span>
    <span class="n">no_company_logo</span><span class="p">,</span>
    <span class="n">required_experience</span><span class="p">,</span>
    <span class="n">required_education</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">applier</span> <span class="o">=</span> <span class="n">PandasLFApplier</span><span class="p">(</span><span class="n">lfs</span><span class="o">=</span><span class="n">lfs</span><span class="p">)</span>
<span class="n">L_train</span> <span class="o">=</span> <span class="n">applier</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">train_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 13410/13410 [00:02&lt;00:00, 5849.25it/s]
</pre></div>
</div>
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 30;
                var nbb_unformatted_code = "lfs = [\n    no_company_profile,\n    no_company_logo,\n    required_experience,\n    required_education,\n]\n\napplier = PandasLFApplier(lfs=lfs)\nL_train = applier.apply(df=train_df)";
                var nbb_formatted_code = "lfs = [\n    no_company_profile,\n    no_company_logo,\n    required_experience,\n    required_education,\n]\n\napplier = PandasLFApplier(lfs=lfs)\nL_train = applier.apply(df=train_df)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>Finally, evaluate the accuracy of your labeling functions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LFAnalysis</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L_train</span><span class="p">,</span> <span class="n">lfs</span><span class="o">=</span><span class="n">lfs</span><span class="p">)</span><span class="o">.</span><span class="n">lf_summary</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">train_df</span><span class="o">.</span><span class="n">fraudulent</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>j</th>
      <th>Polarity</th>
      <th>Coverage</th>
      <th>Overlaps</th>
      <th>Conflicts</th>
      <th>Correct</th>
      <th>Incorrect</th>
      <th>Emp. Acc.</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>no_company_profile</th>
      <td>0</td>
      <td>[1]</td>
      <td>0.186204</td>
      <td>0.186204</td>
      <td>0.186204</td>
      <td>459</td>
      <td>2038</td>
      <td>0.183821</td>
    </tr>
    <tr>
      <th>no_company_logo</th>
      <td>1</td>
      <td>[1]</td>
      <td>0.205742</td>
      <td>0.205742</td>
      <td>0.205742</td>
      <td>459</td>
      <td>2300</td>
      <td>0.166365</td>
    </tr>
    <tr>
      <th>required_experience</th>
      <td>2</td>
      <td>[0]</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.244295</td>
      <td>12741</td>
      <td>669</td>
      <td>0.950112</td>
    </tr>
    <tr>
      <th>required_education</th>
      <td>3</td>
      <td>[0]</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>0.244295</td>
      <td>12741</td>
      <td>669</td>
      <td>0.950112</td>
    </tr>
  </tbody>
</table>
</div></div><script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 31;
                var nbb_unformatted_code = "LFAnalysis(L=L_train, lfs=lfs).lf_summary(Y=train_df.fraudulent.values)";
                var nbb_formatted_code = "LFAnalysis(L=L_train, lfs=lfs).lf_summary(Y=train_df.fraudulent.values)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>This analysis provides insights on coverage, accuracy, and overlaps between labeling functions.</p>
<p><a class="reference external" href="https://www.snorkel.org/">Link to Snorkel</a>.</p>
</section>
<section id="sketch-ai-code-writing-assistant-that-understands-data-content">
<h2><span class="section-number">6.2.14. </span>sketch: AI Code-Writing Assistant That Understands Data Content<a class="headerlink" href="#sketch-ai-code-writing-assistant-that-understands-data-content" title="Permalink to this heading">#</a></h2>
<p>Wouldnâ€™t it be nice if you could get insights into your data by simply asking a question? Sketch allows you to do exactly that.</p>
<p>Sketch is an AI code-writing assistant for pandas users that understands the context of your data.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>sketch
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>  
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span> 
<span class="kn">import</span> <span class="nn">sketch</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;taxis&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pickup</th>
      <th>dropoff</th>
      <th>passengers</th>
      <th>distance</th>
      <th>fare</th>
      <th>tip</th>
      <th>tolls</th>
      <th>total</th>
      <th>color</th>
      <th>payment</th>
      <th>pickup_zone</th>
      <th>dropoff_zone</th>
      <th>pickup_borough</th>
      <th>dropoff_borough</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-03-23 20:21:09</td>
      <td>2019-03-23 20:27:24</td>
      <td>1</td>
      <td>1.60</td>
      <td>7.0</td>
      <td>2.15</td>
      <td>0.0</td>
      <td>12.95</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Lenox Hill West</td>
      <td>UN/Turtle Bay South</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-03-04 16:11:55</td>
      <td>2019-03-04 16:19:00</td>
      <td>1</td>
      <td>0.79</td>
      <td>5.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>9.30</td>
      <td>yellow</td>
      <td>cash</td>
      <td>Upper West Side South</td>
      <td>Upper West Side South</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-03-27 17:53:01</td>
      <td>2019-03-27 18:00:25</td>
      <td>1</td>
      <td>1.37</td>
      <td>7.5</td>
      <td>2.36</td>
      <td>0.0</td>
      <td>14.16</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Alphabet City</td>
      <td>West Village</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-03-10 01:23:59</td>
      <td>2019-03-10 01:49:51</td>
      <td>1</td>
      <td>7.70</td>
      <td>27.0</td>
      <td>6.15</td>
      <td>0.0</td>
      <td>36.95</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Hudson Sq</td>
      <td>Yorkville West</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-03-30 13:27:42</td>
      <td>2019-03-30 13:37:14</td>
      <td>3</td>
      <td>2.16</td>
      <td>9.0</td>
      <td>1.10</td>
      <td>0.0</td>
      <td>13.40</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Midtown East</td>
      <td>Yorkville West</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2019-03-11 10:37:23</td>
      <td>2019-03-11 10:47:31</td>
      <td>1</td>
      <td>0.49</td>
      <td>7.5</td>
      <td>2.16</td>
      <td>0.0</td>
      <td>12.96</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Times Sq/Theatre District</td>
      <td>Midtown East</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2019-03-26 21:07:31</td>
      <td>2019-03-26 21:17:29</td>
      <td>1</td>
      <td>3.65</td>
      <td>13.0</td>
      <td>2.00</td>
      <td>0.0</td>
      <td>18.80</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Battery Park City</td>
      <td>Two Bridges/Seward Park</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2019-03-22 12:47:13</td>
      <td>2019-03-22 12:58:17</td>
      <td>0</td>
      <td>1.40</td>
      <td>8.5</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>11.80</td>
      <td>yellow</td>
      <td>NaN</td>
      <td>Murray Hill</td>
      <td>Flatiron</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2019-03-23 11:48:50</td>
      <td>2019-03-23 12:06:14</td>
      <td>1</td>
      <td>3.63</td>
      <td>15.0</td>
      <td>1.00</td>
      <td>0.0</td>
      <td>19.30</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>East Harlem South</td>
      <td>Midtown Center</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2019-03-08 16:18:37</td>
      <td>2019-03-08 16:26:57</td>
      <td>1</td>
      <td>1.52</td>
      <td>8.0</td>
      <td>1.00</td>
      <td>0.0</td>
      <td>13.30</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Lincoln Square East</td>
      <td>Central Park</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sketch</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span>
    <span class="s2">&quot;Can you give me friendly names for each column?&quot;</span> 
    <span class="s2">&quot;(Output as an HTML list)&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<ul>
  <li>Index: Row Number</li>
  <li>Pickup: Pickup Time</li>
  <li>Dropoff: Dropoff Time</li>
  <li>Passengers: Number of Passengers</li>
  <li>Distance: Distance Travelled</li>
  <li>Fare: Fare Amount</li>
  <li>Tip: Tip Amount</li>
  <li>Tolls: Tolls Amount</li>
  <li>Total: Total Amount</li>
  <li>Color: Vehicle Color</li>
  <li>Payment: Payment Method</li>
  <li>Pickup Zone: Pickup Zone Name</li>
  <li>Dropoff Zone: Dropoff Zone Name</li>
  <li>Pickup Borough: Pickup Borough Name</li>
  <li>Dropoff Borough: Dropoff Borough Name</li>
</ul>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sketch</span><span class="o">.</span><span class="n">ask</span><span class="p">(</span>
    <span class="s2">&quot;Which payment is the most popular payment?&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
The most popular payment is credit card.
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sketch</span><span class="o">.</span><span class="n">howto</span><span class="p">(</span><span class="s2">&quot;Create some features from the pickup column&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="display:flex;flex-direction:row;justify-content:space-between;">
                <pre style="width: 100%; white-space: pre-wrap;" id="f5a08689-3fd6-4318-9962-135fc2011ca6">
# Create a new column for the hour of the pickup
data['pickup_hour'] = data['pickup'].dt.hour

# Create a new column for the day of the week of the pickup
data['pickup_day'] = data['pickup'].dt.weekday_name

# Create a new column for the month of the pickup
data['pickup_month'] = data['pickup'].dt.month_name()
</pre>
                <button style="height: fit-content;" onclick="navigator.clipboard.writeText(JSON.parse(atob(`IlxuIyBDcmVhdGUgYSBuZXcgY29sdW1uIGZvciB0aGUgaG91ciBvZiB0aGUgcGlja3VwXG5kYXRhWydwaWNrdXBfaG91ciddID0gZGF0YVsncGlja3VwJ10uZHQuaG91clxuXG4jIENyZWF0ZSBhIG5ldyBjb2x1bW4gZm9yIHRoZSBkYXkgb2YgdGhlIHdlZWsgb2YgdGhlIHBpY2t1cFxuZGF0YVsncGlja3VwX2RheSddID0gZGF0YVsncGlja3VwJ10uZHQud2Vla2RheV9uYW1lXG5cbiMgQ3JlYXRlIGEgbmV3IGNvbHVtbiBmb3IgdGhlIG1vbnRoIG9mIHRoZSBwaWNrdXBcbmRhdGFbJ3BpY2t1cF9tb250aCddID0gZGF0YVsncGlja3VwJ10uZHQubW9udGhfbmFtZSgpXG4i`)))">Copy</button>
                </div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new column for the hour of the pickup</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;pickup_hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pickup&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>

<span class="c1"># Create a new column for the day of the week of the pickup</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;pickup_day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pickup&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span>

<span class="c1"># Create a new column for the month of the pickup</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;pickup_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;pickup&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month_name</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sketch</span><span class="o">.</span><span class="n">howto</span><span class="p">(</span>
    <span class="s2">&quot;Create some features from the pickup_zone column&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div style="display:flex;flex-direction:row;justify-content:space-between;">
                <pre style="width: 100%; white-space: pre-wrap;" id="9374da28-314b-4ca8-be63-01f2f5779c91">
# Create a new column called 'pickup_zone_count'
data['pickup_zone_count'] = data.groupby('pickup_zone')['pickup_zone'].transform('count')

# Create a new column called 'pickup_zone_fare'
data['pickup_zone_fare'] = data.groupby('pickup_zone')['fare'].transform('mean')

# Create a new column called 'pickup_zone_distance'
data['pickup_zone_distance'] = data.groupby('pickup_zone')['distance'].transform('mean')
</pre>
                <button style="height: fit-content;" onclick="navigator.clipboard.writeText(JSON.parse(atob(`IlxuIyBDcmVhdGUgYSBuZXcgY29sdW1uIGNhbGxlZCAncGlja3VwX3pvbmVfY291bnQnXG5kYXRhWydwaWNrdXBfem9uZV9jb3VudCddID0gZGF0YS5ncm91cGJ5KCdwaWNrdXBfem9uZScpWydwaWNrdXBfem9uZSddLnRyYW5zZm9ybSgnY291bnQnKVxuXG4jIENyZWF0ZSBhIG5ldyBjb2x1bW4gY2FsbGVkICdwaWNrdXBfem9uZV9mYXJlJ1xuZGF0YVsncGlja3VwX3pvbmVfZmFyZSddID0gZGF0YS5ncm91cGJ5KCdwaWNrdXBfem9uZScpWydmYXJlJ10udHJhbnNmb3JtKCdtZWFuJylcblxuIyBDcmVhdGUgYSBuZXcgY29sdW1uIGNhbGxlZCAncGlja3VwX3pvbmVfZGlzdGFuY2UnXG5kYXRhWydwaWNrdXBfem9uZV9kaXN0YW5jZSddID0gZGF0YS5ncm91cGJ5KCdwaWNrdXBfem9uZScpWydkaXN0YW5jZSddLnRyYW5zZm9ybSgnbWVhbicpXG4i`)))">Copy</button>
                </div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a new column called &#39;pickup_zone_count&#39;</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;pickup_zone_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pickup_zone&#39;</span><span class="p">)[</span><span class="s1">&#39;pickup_zone&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>

<span class="c1"># Create a new column called &#39;pickup_zone_fare&#39;</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;pickup_zone_fare&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pickup_zone&#39;</span><span class="p">)[</span><span class="s1">&#39;fare&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>

<span class="c1"># Create a new column called &#39;pickup_zone_distance&#39;</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;pickup_zone_distance&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;pickup_zone&#39;</span><span class="p">)[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pickup</th>
      <th>dropoff</th>
      <th>passengers</th>
      <th>distance</th>
      <th>fare</th>
      <th>tip</th>
      <th>tolls</th>
      <th>total</th>
      <th>color</th>
      <th>payment</th>
      <th>pickup_zone</th>
      <th>dropoff_zone</th>
      <th>pickup_borough</th>
      <th>dropoff_borough</th>
      <th>pickup_hour</th>
      <th>pickup_day</th>
      <th>pickup_month</th>
      <th>pickup_zone_count</th>
      <th>pickup_zone_fare</th>
      <th>pickup_zone_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-03-23 20:21:09</td>
      <td>2019-03-23 20:27:24</td>
      <td>1</td>
      <td>1.60</td>
      <td>7.0</td>
      <td>2.15</td>
      <td>0.0</td>
      <td>12.95</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Lenox Hill West</td>
      <td>UN/Turtle Bay South</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
      <td>20</td>
      <td>5</td>
      <td>March</td>
      <td>120.0</td>
      <td>9.016667</td>
      <td>1.857083</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-03-04 16:11:55</td>
      <td>2019-03-04 16:19:00</td>
      <td>1</td>
      <td>0.79</td>
      <td>5.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>9.30</td>
      <td>yellow</td>
      <td>cash</td>
      <td>Upper West Side South</td>
      <td>Upper West Side South</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
      <td>16</td>
      <td>0</td>
      <td>March</td>
      <td>144.0</td>
      <td>9.987778</td>
      <td>2.031597</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-03-27 17:53:01</td>
      <td>2019-03-27 18:00:25</td>
      <td>1</td>
      <td>1.37</td>
      <td>7.5</td>
      <td>2.36</td>
      <td>0.0</td>
      <td>14.16</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Alphabet City</td>
      <td>West Village</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
      <td>17</td>
      <td>2</td>
      <td>March</td>
      <td>9.0</td>
      <td>11.944444</td>
      <td>2.796667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-03-10 01:23:59</td>
      <td>2019-03-10 01:49:51</td>
      <td>1</td>
      <td>7.70</td>
      <td>27.0</td>
      <td>6.15</td>
      <td>0.0</td>
      <td>36.95</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Hudson Sq</td>
      <td>Yorkville West</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
      <td>1</td>
      <td>6</td>
      <td>March</td>
      <td>47.0</td>
      <td>11.000000</td>
      <td>2.243830</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-03-30 13:27:42</td>
      <td>2019-03-30 13:37:14</td>
      <td>3</td>
      <td>2.16</td>
      <td>9.0</td>
      <td>1.10</td>
      <td>0.0</td>
      <td>13.40</td>
      <td>yellow</td>
      <td>credit card</td>
      <td>Midtown East</td>
      <td>Yorkville West</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
      <td>13</td>
      <td>5</td>
      <td>March</td>
      <td>198.0</td>
      <td>10.994949</td>
      <td>2.239798</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>6428</th>
      <td>2019-03-31 09:51:53</td>
      <td>2019-03-31 09:55:27</td>
      <td>1</td>
      <td>0.75</td>
      <td>4.5</td>
      <td>1.06</td>
      <td>0.0</td>
      <td>6.36</td>
      <td>green</td>
      <td>credit card</td>
      <td>East Harlem North</td>
      <td>Central Harlem North</td>
      <td>Manhattan</td>
      <td>Manhattan</td>
      <td>9</td>
      <td>6</td>
      <td>March</td>
      <td>72.0</td>
      <td>12.550000</td>
      <td>2.854306</td>
    </tr>
    <tr>
      <th>6429</th>
      <td>2019-03-31 17:38:00</td>
      <td>2019-03-31 18:34:23</td>
      <td>1</td>
      <td>18.74</td>
      <td>58.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>58.80</td>
      <td>green</td>
      <td>credit card</td>
      <td>Jamaica</td>
      <td>East Concourse/Concourse Village</td>
      <td>Queens</td>
      <td>Bronx</td>
      <td>17</td>
      <td>6</td>
      <td>March</td>
      <td>12.0</td>
      <td>25.597500</td>
      <td>7.261667</td>
    </tr>
    <tr>
      <th>6430</th>
      <td>2019-03-23 22:55:18</td>
      <td>2019-03-23 23:14:25</td>
      <td>1</td>
      <td>4.14</td>
      <td>16.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>17.30</td>
      <td>green</td>
      <td>cash</td>
      <td>Crown Heights North</td>
      <td>Bushwick North</td>
      <td>Brooklyn</td>
      <td>Brooklyn</td>
      <td>22</td>
      <td>5</td>
      <td>March</td>
      <td>12.0</td>
      <td>14.549167</td>
      <td>3.665000</td>
    </tr>
    <tr>
      <th>6431</th>
      <td>2019-03-04 10:09:25</td>
      <td>2019-03-04 10:14:29</td>
      <td>1</td>
      <td>1.12</td>
      <td>6.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>6.80</td>
      <td>green</td>
      <td>credit card</td>
      <td>East New York</td>
      <td>East Flatbush/Remsen Village</td>
      <td>Brooklyn</td>
      <td>Brooklyn</td>
      <td>10</td>
      <td>0</td>
      <td>March</td>
      <td>10.0</td>
      <td>32.409000</td>
      <td>7.086000</td>
    </tr>
    <tr>
      <th>6432</th>
      <td>2019-03-13 19:31:22</td>
      <td>2019-03-13 19:48:02</td>
      <td>1</td>
      <td>3.85</td>
      <td>15.0</td>
      <td>3.36</td>
      <td>0.0</td>
      <td>20.16</td>
      <td>green</td>
      <td>credit card</td>
      <td>Boerum Hill</td>
      <td>Windsor Terrace</td>
      <td>Brooklyn</td>
      <td>Brooklyn</td>
      <td>19</td>
      <td>2</td>
      <td>March</td>
      <td>21.0</td>
      <td>11.761905</td>
      <td>2.812857</td>
    </tr>
  </tbody>
</table>
<p>6433 rows Ã— 20 columns</p>
</div></div></div>
</div>
<p><a class="reference external" href="https://github.com/approximatelabs/sketch">Link to Sketch</a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapter5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="feature_extraction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">6.1. </span>Feature Extraction</p>
      </div>
    </a>
    <a class="right-next"
       href="get_data.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6.3. </span>Get Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#split-data-in-a-stratified-fashion-in-scikit-learn">6.2.1. Split Data in a Stratified Fashion in scikit-learn</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#avoiding-data-leakage-in-time-series-data">6.2.2. Avoiding Data Leakage in Time Series Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#timeseriessplit-for-cross-validation-in-time-series">6.2.3. TimeSeriesSplit for Cross-Validation in Time Series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enhancing-data-handling-with-scikit-learn-s-dataframe-support">6.2.4. Enhancing Data Handling with scikit-learnâ€™s DataFrame Support</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#efficient-feature-transformation-with-make-column-transformer-in-scikit-learn">6.2.5. Efficient Feature Transformation with make_column_transformer in scikit-learn</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#functiontransformer-build-robust-preprocessing-pipelines-with-custom-transformations">6.2.6. FunctionTransformer: Build Robust Preprocessing Pipelines with Custom Transformations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#drop-correlated-features">6.2.7. Drop Correlated Features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encode-rare-labels-with-feature-engine">6.2.8. Encode Rare Labels with Feature-engine</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#encode-categorical-data-using-frequency">6.2.9. Encode Categorical Data Using Frequency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#similarity-encoding-for-dirty-categories-using-dirty-cat">6.2.10. Similarity Encoding for Dirty Categories Using dirty_cat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-handle-misspellings-in-real-world-datasets">6.2.11. How to Handle Misspellings in Real-World Datasets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-data-mismatches-joining-tables-with-fuzzy-matching">6.2.12. Solving Data Mismatches: Joining Tables with Fuzzy Matching</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#snorkel-programmatically-build-training-data-in-python">6.2.13. Snorkel â€” Programmatically Build Training Data in Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sketch-ai-code-writing-assistant-that-understands-data-content">6.2.14. sketch: AI Code-Writing Assistant That Understands Data Content</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Khuyen Tran
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>