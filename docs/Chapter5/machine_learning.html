

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>6.5. Machine Learning &#8212; Effective Python for Data Scientists</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=c5ced968eda925caa686" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=c5ced968eda925caa686" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=c5ced968eda925caa686" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686" />
  <script src="../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=c5ced968eda925caa686"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "ðŸ’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter5/machine_learning';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6.6. Natural Language Processing" href="natural_language_processing.html" />
    <link rel="prev" title="6.4. Manage Data" href="manage_data.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/data_simplified_icon.png" class="logo__image only-light" alt="Effective Python for Data Scientists - Home"/>
    <script>document.write(`<img src="../_static/data_simplified_icon.png" class="logo__image only-dark" alt="Effective Python for Data Scientists - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    What Should You Expect From This Book?
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../how_to_read.html">1. How to Read This Book</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter1/Chapter1.html">2. Python Built-in Methods</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/string.html">2.1. String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/number.html">2.2. Number</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Chapter1/list/list.html">2.3. List</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../Chapter1/list/get_elements.html">2.3.1. Get Elements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Chapter1/list/unpack_iterables.html">2.3.2. Unpack Iterables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Chapter1/list/join_iterable.html">2.3.3. Join Iterables</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Chapter1/list/apply_functions_to_elements.html">2.3.4. Apply Functions to Elements in a List</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/set.html">2.4. Set</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/dictionary.html">2.5. Dictionary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/function.html">2.6. Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/class.html">2.7. Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/datetime.html">2.8. Datetime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/code_speed.html">2.9. Code Speed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/good_practices.html">2.10. Good Python Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/python_new_features.html">2.11. New Features in Python</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter2/Chapter2.html">3. Python Utility Libraries</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/collections.html">3.1. Collections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/itertools.html">3.2. Itertools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/functools.html">3.3. Functools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/pydash.html">3.4. Pydash</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/sympy.html">3.5. SymPy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/operator.html">3.6. Operator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/dataclasses.html">3.7. Data Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/typing.html">3.8. Typing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/pathlib.html">3.9. pathlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/pydantic.html">3.10. Pydantic</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter3/Chapter3.html">4. Pandas</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/change_values.html">4.1. Change Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/get_values.html">4.2. Get Certain Values From a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/date_time.html">4.3. Work with Datetime</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/transform_dataframe.html">4.4. Transform a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/create_dataframe.html">4.5. Create a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/combine_dataframes.html">4.6. Combine Multiple DataFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/filter.html">4.7. Filter Rows or Columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/data_types.html">4.8. Manipulate a DataFrame Using Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/sort_dataframe.html">4.9. Sort Rows or Columns of a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/string.html">4.10. Work with String</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/style_dataframe.html">4.11. Style a DataFrame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/testing.html">4.12. Test</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter4/Chapter4.html">5. NumPy</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/Numpy.html">5.1. NumPy</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="Chapter5.html">6. Data Science Tools</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="feature_extraction.html">6.1. Feature Extraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="feature_engineer.html">6.2. Feature Engineer</a></li>
<li class="toctree-l2"><a class="reference internal" href="get_data.html">6.3. Get Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="manage_data.html">6.4. Manage Data</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">6.5. Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="natural_language_processing.html">6.6. Natural Language Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="time_series.html">6.7. Time Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="sharing_downloading.html">6.8. Sharing and Downloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="speed_up_code.html">6.9. Tools to Speed Up Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="visualization.html">6.10. Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="better_pandas.html">6.11. Better Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">6.12. Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="SQL.html">6.13. SQL Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="polars.html">6.14. Polars</a></li>
<li class="toctree-l2"><a class="reference internal" href="spark.html">6.15. PySpark</a></li>
<li class="toctree-l2"><a class="reference internal" href="deltalake.html">6.16. Delta Lake</a></li>
<li class="toctree-l2"><a class="reference internal" href="llm.html">6.17. Large Language Model (LLM)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter6/Chapter6.html">7. Cool Tools</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/best_python_practice_tools.html">7.1. Tools for Best Python Practices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/alternative_approach.html">7.2. Alternative Approach</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/workflow_automation.html">7.3. Workflow Automation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/code_review.html">7.4. Code Review</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/logging_debugging.html">7.5. Logging and Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/better_outputs.html">7.6. Better Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/git_github.html">7.7. Git and GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/env_management.html">7.8. Environment Management</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter7/Chapter7.html">8. Jupyter Notebook</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/jupyter_notebook.html">8.1. Jupyter Notebook</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/blob/master/./Chapter5/machine_learning.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/issues/new?title=Issue%20on%20page%20%2FChapter5/machine_learning.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Chapter5/machine_learning.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Machine Learning</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scikit-llm-supercharge-text-analysis-with-chatgpt-and-scikit-learn-integration">6.5.1. Scikit-LLM: Supercharge Text Analysis with ChatGPT and scikit-learn Integration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-readable-machine-learning-pipeline-in-one-line-of-code">6.5.2. Create a Readable Machine Learning Pipeline in One Line of Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline-gridsearchcv-prevent-data-leakage-when-scaling-the-data">6.5.3. Pipeline + GridSearchCV: Prevent Data Leakage when Scaling the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#squared-false-get-rmse-from-sklearns-mean-squared-error-method">6.5.4. squared=False: Get RMSE from Sklearnâ€™s mean_squared_error method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelkit-build-production-ml-systems-in-python">6.5.5. modelkit: Build Production ML Systems in Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposing-high-dimensional-data-into-two-or-three-dimensions">6.5.6. Decomposing High-Dimensional Data into Two or Three Dimensions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-feature-importances-with-yellowbrick">6.5.7. Visualize Feature Importances with Yellowbrick</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validation-curve-determine-if-an-estimator-is-underfitting-over-overfitting">6.5.8. Validation Curve: Determine if an Estimator Is Underfitting Over Overfitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlxtend-plot-decision-regions-of-your-ml-classifiers">6.5.9. Mlxtend: Plot Decision Regions of Your ML Classifiers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imbalanced-learn-deal-with-an-imbalanced-dataset">6.5.10. imbalanced-learn: Deal with an Imbalanced Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimate-prediction-intervals-in-scikit-learn-models-with-mapie">6.5.11. Estimate Prediction Intervals in Scikit-Learn Models with MAPIE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlforecast-scalable-machine-learning-for-time-series">6.5.12. mlforecast: Scalable Machine Learning for Time Series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlem-capture-your-machine-learning-model-s-metadata">6.5.13. MLEM: Capture Your Machine Learning Modelâ€™s Metadata</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distributed-machine-learning-with-mllib">6.5.14. Distributed Machine Learning with MLlib</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rapid-prototyping-and-comparison-of-basic-models-with-lazy-predict">6.5.15. Rapid Prototyping and Comparison of Basic Models with Lazy Predict</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autogluon-fast-and-accurate-ml-in-3-lines-of-code">6.5.16. AutoGluon: Fast and Accurate ML in 3 Lines of Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-logging-made-easy-mlflow-vs-pickle">6.5.17. Model Logging Made Easy: MLflow vs. Pickle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifying-ml-model-integration-with-fastapi">6.5.18. Simplifying ML Model Integration with FastAPI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imodels-simplifying-machine-learning-with-interpretable-models">6.5.19. imodels: Simplifying Machine Learning with Interpretable Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-build-a-recommendation-engine-using-surprise-in-python">6.5.20. How to Build a Recommendation Engine Using Surprise in Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pyod-simplifying-outlier-detection-in-python">6.5.21. PyOD: Simplifying Outlier Detection in Python</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="machine-learning">
<h1><span class="section-number">6.5. </span>Machine Learning<a class="headerlink" href="#machine-learning" title="Permalink to this heading">#</a></h1>
<p><img alt="" src="../_images/machine_learning.png" /></p>
<section id="scikit-llm-supercharge-text-analysis-with-chatgpt-and-scikit-learn-integration">
<h2><span class="section-number">6.5.1. </span>Scikit-LLM: Supercharge Text Analysis with ChatGPT and scikit-learn Integration<a class="headerlink" href="#scikit-llm-supercharge-text-analysis-with-chatgpt-and-scikit-learn-integration" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>scikit-llm
</pre></div>
</div>
</div>
</details>
</div>
<p>To integrate advanced language models with scikit-learn for enhanced text analysis tasks, use Scikit-LLM.</p>
<p>Scikit-LLMâ€™s <code class="docutils literal notranslate"><span class="pre">ZeroShotGPTClassifier</span></code> enables text classification on unseen classes without requiring re-training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skllm.config</span> <span class="kn">import</span> <span class="n">SKLLMConfig</span>

<span class="n">SKLLMConfig</span><span class="o">.</span><span class="n">set_openai_key</span><span class="p">(</span><span class="s2">&quot;&lt;YOUR_KEY&gt;&quot;</span><span class="p">)</span>
<span class="n">SKLLMConfig</span><span class="o">.</span><span class="n">set_openai_org</span><span class="p">(</span><span class="s2">&quot;&lt;YOUR_ORGANISATION&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">skllm.datasets</span> <span class="kn">import</span> <span class="n">get_classification_dataset</span>
<span class="kn">from</span> <span class="nn">skllm</span> <span class="kn">import</span> <span class="n">ZeroShotGPTClassifier</span>

<span class="c1"># demo sentiment analysis dataset</span>
<span class="c1"># labels: positive, negative, neutral</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">get_classification_dataset</span><span class="p">()</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">ZeroShotGPTClassifier</span><span class="p">(</span><span class="n">openai_model</span><span class="o">=</span><span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">)</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 30/30 [00:36&lt;00:00,  1.22s/it]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy: 0.93
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/iryna-kondr/scikit-llm">Link to Scikit-LLM</a>.</p>
</section>
<section id="create-a-readable-machine-learning-pipeline-in-one-line-of-code">
<h2><span class="section-number">6.5.2. </span>Create a Readable Machine Learning Pipeline in One Line of Code<a class="headerlink" href="#create-a-readable-machine-learning-pipeline-in-one-line-of-code" title="Permalink to this heading">#</a></h2>
<p>If you want to create a readable machine learning pipeline in a single line of code, try the <code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code> function in scikit-learn.
<code class="docutils literal notranslate"><span class="pre">make_pipeline</span></code> is especially useful when working with complex pipelines that involve many different transformers and estimators.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Create a pipeline that scales the data and fits a logistic regression model</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">LogisticRegression</span><span class="p">())</span>

<span class="c1"># Fit the pipeline to the training data</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Evaluate the pipeline on the test data</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.96
</pre></div>
</div>
</div>
</div>
</section>
<section id="pipeline-gridsearchcv-prevent-data-leakage-when-scaling-the-data">
<h2><span class="section-number">6.5.3. </span>Pipeline + GridSearchCV: Prevent Data Leakage when Scaling the Data<a class="headerlink" href="#pipeline-gridsearchcv-prevent-data-leakage-when-scaling-the-data" title="Permalink to this heading">#</a></h2>
<p>Scaling the data before using GridSearchCV can lead to data leakage since the scaling tells some information about the entire data. To prevent this, assemble both the scaler and machine learning models in a pipeline then use it as the estimator for GridSearchCV.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>

<span class="c1"># load data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">data</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">target</span>

<span class="c1"># split data into train and test</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Create a pipeline variable</span>
<span class="n">make_pipe</span> <span class="o">=</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">StandardScaler</span><span class="p">(),</span> <span class="n">SVC</span><span class="p">())</span>

<span class="c1"># Defining parameters grid</span>
<span class="n">grid_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;svc__C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span> <span class="s2">&quot;svc__gamma&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">]}</span>

<span class="c1"># hypertuning</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">make_pipe</span><span class="p">,</span> <span class="n">grid_params</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># predict</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 16;
                var nbb_unformatted_code = "from sklearn.model_selection import train_test_split, GridSearchCV\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.pipeline import make_pipeline\nfrom sklearn.svm import SVC \nfrom sklearn.datasets import load_iris \n\n# load data\ndf = load_iris()\nX = df.data\ny = df.target \n\n# split data into train and test\nX_train, X_test, y_train, y_test = train_test_split(X, y, random_state=0)\n\n# Create a pipeline variable\nmake_pipe = make_pipeline(StandardScaler(), SVC())\n\n# Defining parameters grid\ngrid_params = {'svc__C': [0.1, 1, 10, 100, 1000], 'svc__gamma': [0.1, 1, 10, 100]}\n\n# hypertuning\ngrid = GridSearchCV(make_pipe, grid_params, cv = 5)\ngrid.fit(X_train, y_train)\n\n# predict\ny_pred = grid.predict(X_test)";
                var nbb_formatted_code = "from sklearn.model_selection import train_test_split, GridSearchCV\nfrom sklearn.preprocessing import StandardScaler\nfrom sklearn.pipeline import make_pipeline\nfrom sklearn.svm import SVC\nfrom sklearn.datasets import load_iris\n\n# load data\ndf = load_iris()\nX = df.data\ny = df.target\n\n# split data into train and test\nX_train, X_test, y_train, y_test = train_test_split(X, y, random_state=0)\n\n# Create a pipeline variable\nmake_pipe = make_pipeline(StandardScaler(), SVC())\n\n# Defining parameters grid\ngrid_params = {\"svc__C\": [0.1, 1, 10, 100, 1000], \"svc__gamma\": [0.1, 1, 10, 100]}\n\n# hypertuning\ngrid = GridSearchCV(make_pipe, grid_params, cv=5)\ngrid.fit(X_train, y_train)\n\n# predict\ny_pred = grid.predict(X_test)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>The estimator is now the entire pipeline instead of just the machine learning model.</p>
</section>
<section id="squared-false-get-rmse-from-sklearns-mean-squared-error-method">
<h2><span class="section-number">6.5.4. </span>squared=False: Get RMSE from Sklearnâ€™s mean_squared_error method<a class="headerlink" href="#squared-false-get-rmse-from-sklearns-mean-squared-error-method" title="Permalink to this heading">#</a></h2>
<p>To obtain the root mean squared error (RMSE) using scikit-learn, use the <code class="docutils literal notranslate"><span class="pre">squared=False</span></code> parameter in the <code class="docutils literal notranslate"><span class="pre">mean_squared_error</span></code> method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="n">y_actual</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">y_predicted</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">]</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_actual</span><span class="p">,</span> <span class="n">y_predicted</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">rmse</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5
</pre></div>
</div>
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 42;
                var nbb_unformatted_code = "from sklearn.metrics import mean_squared_error\n\ny_actual = [1, 2, 3]\ny_predicted = [1.5, 2.5, 3.5]\nrmse = mean_squared_error(y_actual, y_predicted, squared=False)\nrmse ";
                var nbb_formatted_code = "from sklearn.metrics import mean_squared_error\n\ny_actual = [1, 2, 3]\ny_predicted = [1.5, 2.5, 3.5]\nrmse = mean_squared_error(y_actual, y_predicted, squared=False)\nrmse";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
</section>
<section id="modelkit-build-production-ml-systems-in-python">
<h2><span class="section-number">6.5.5. </span>modelkit: Build Production ML Systems in Python<a class="headerlink" href="#modelkit-build-production-ml-systems-in-python" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>modelkit<span class="w"> </span>textblob<span class="w"> </span>
</pre></div>
</div>
</div>
</details>
</div>
<p>If you want your ML models to be fast, type-safe, testable, and fast to deploy to production, try modelkit. modelkit allows you to incorporate all of these features into your model in several lines of code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">modelkit</span> <span class="kn">import</span> <span class="n">ModelLibrary</span><span class="p">,</span> <span class="n">Model</span> 
<span class="kn">from</span> <span class="nn">textblob</span> <span class="kn">import</span> <span class="n">TextBlob</span><span class="p">,</span> <span class="n">WordList</span>
<span class="c1"># import nltk</span>
<span class="c1"># nltk.download(&#39;brown&#39;)</span>
<span class="c1"># nltk.download(&#39;punkt&#39;)</span>
</pre></div>
</div>
</div>
</div>
<p>To define a modelkit Model, you need to:</p>
<ul class="simple">
<li><p>create class inheriting from <code class="docutils literal notranslate"><span class="pre">modelkit.Model</span></code></p></li>
<li><p>implement a <code class="docutils literal notranslate"><span class="pre">_predict</span></code> method</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NounPhraseExtractor</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="c1"># Give model a name</span>
    <span class="n">CONFIGURATIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;noun_phrase_extractor&quot;</span><span class="p">:</span> <span class="p">{}}</span>

    <span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">blob</span><span class="o">.</span><span class="n">noun_phrases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 24;
                var nbb_unformatted_code = "class NounPhraseExtractor(Model):\n    \n    # Give model a name\n    CONFIGURATIONS = {\"noun_phrase_extractor\": {}}\n\n    def _predict(self, text):\n        blob = TextBlob(text)\n        return blob.noun_phrases";
                var nbb_formatted_code = "class NounPhraseExtractor(Model):\n\n    # Give model a name\n    CONFIGURATIONS = {\"noun_phrase_extractor\": {}}\n\n    def _predict(self, text):\n        blob = TextBlob(text)\n        return blob.noun_phrases";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>You can now instantiate and use the model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noun_extractor</span> <span class="o">=</span> <span class="n">NounPhraseExtractor</span><span class="p">()</span>
<span class="n">noun_extractor</span><span class="p">(</span><span class="s2">&quot;What are your learning strategies?&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-11-05 09:55.55 [debug    ] Model loaded                   memory=0 Bytes memory_bytes=0 model_name=None time=0 microseconds time_s=4.232699939166196e-05
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WordList([&#39;learning strategies&#39;])
</pre></div>
</div>
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 25;
                var nbb_unformatted_code = "noun_extractor = NounPhraseExtractor()\nnoun_extractor(\"What are your learning strategies?\")";
                var nbb_formatted_code = "noun_extractor = NounPhraseExtractor()\nnoun_extractor(\"What are your learning strategies?\")";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>You can also create test cases for your model and make sure all test cases are passed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NounPhraseExtractor</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="c1"># Give model a name</span>
    <span class="n">CONFIGURATIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;noun_phrase_extractor&quot;</span><span class="p">:</span> <span class="p">{}}</span>

    <span class="n">TEST_CASES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s2">&quot;item&quot;</span><span class="p">:</span> <span class="s2">&quot;There is a red apple on the tree&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">WordList</span><span class="p">([</span><span class="s2">&quot;red apple&quot;</span><span class="p">])}</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">blob</span><span class="o">.</span><span class="n">noun_phrases</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 26;
                var nbb_unformatted_code = "class NounPhraseExtractor(Model):\n\n    # Give model a name\n    CONFIGURATIONS = {\"noun_phrase_extractor\": {}}\n\n    TEST_CASES = [\n        {\"item\": \"There is a red apple on the tree\", \"result\": WordList([\"red apple\"])}\n    ]\n\n    def _predict(self, text):\n        blob = TextBlob(text)\n        return blob.noun_phrases";
                var nbb_formatted_code = "class NounPhraseExtractor(Model):\n\n    # Give model a name\n    CONFIGURATIONS = {\"noun_phrase_extractor\": {}}\n\n    TEST_CASES = [\n        {\"item\": \"There is a red apple on the tree\", \"result\": WordList([\"red apple\"])}\n    ]\n\n    def _predict(self, text):\n        blob = TextBlob(text)\n        return blob.noun_phrases";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noun_extractor</span> <span class="o">=</span> <span class="n">NounPhraseExtractor</span><span class="p">()</span>
<span class="n">noun_extractor</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-11-05 09:55.58 [debug    ] Model loaded                   memory=0 Bytes memory_bytes=0 model_name=None time=0 microseconds time_s=4.3191997974645346e-05
</pre></div>
</div>
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #008000; text-decoration-color: #008000">TEST </span><span style="color: #008000; text-decoration-color: #008000; font-weight: bold">1</span><span style="color: #008000; text-decoration-color: #008000">: SUCCESS</span>
</pre>
</div><script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 27;
                var nbb_unformatted_code = "noun_extractor = NounPhraseExtractor()\nnoun_extractor.test()";
                var nbb_formatted_code = "noun_extractor = NounPhraseExtractor()\nnoun_extractor.test()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>modelkit also allows you to organize a group of models using <code class="docutils literal notranslate"><span class="pre">ModelLibrary</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SentimentAnalyzer</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    
    <span class="c1"># Give model a name</span>
    <span class="n">CONFIGURATIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sentiment_analyzer&quot;</span><span class="p">:</span> <span class="p">{}}</span>

    <span class="k">def</span> <span class="nf">_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="n">blob</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">blob</span><span class="o">.</span><span class="n">sentiment</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nlp_models</span> <span class="o">=</span> <span class="n">ModelLibrary</span><span class="p">(</span><span class="n">models</span><span class="o">=</span><span class="p">[</span><span class="n">NounPhraseExtractor</span><span class="p">,</span> <span class="n">SentimentAnalyzer</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2021-11-05 09:50.13 [info     ] Instantiating AssetsManager    lazy_loading=False
2021-11-05 09:50.13 [info     ] No remote storage provider configured
2021-11-05 09:50.13 [debug    ] Resolving asset for Model      model_name=sentiment_analyzer
2021-11-05 09:50.13 [debug    ] Loading model                  model_name=sentiment_analyzer
2021-11-05 09:50.13 [debug    ] Instantiating Model object     model_name=sentiment_analyzer
2021-11-05 09:50.13 [debug    ] Model loaded                   memory=0 Bytes memory_bytes=0 model_name=sentiment_analyzer time=0 microseconds time_s=3.988200114690699e-05
2021-11-05 09:50.13 [debug    ] Done loading Model             model_name=sentiment_analyzer
2021-11-05 09:50.13 [info     ] Model and dependencies loaded  memory=0 Bytes memory_bytes=0 name=sentiment_analyzer time=0 microseconds time_s=0.00894871700074873
2021-11-05 09:50.13 [debug    ] Resolving asset for Model      model_name=noun_phrase_extractor
2021-11-05 09:50.13 [debug    ] Loading model                  model_name=noun_phrase_extractor
2021-11-05 09:50.13 [debug    ] Instantiating Model object     model_name=noun_phrase_extractor
2021-11-05 09:50.13 [debug    ] Model loaded                   memory=0 Bytes memory_bytes=0 model_name=noun_phrase_extractor time=0 microseconds time_s=2.751099964370951e-05
2021-11-05 09:50.13 [debug    ] Done loading Model             model_name=noun_phrase_extractor
2021-11-05 09:50.13 [info     ] Model and dependencies loaded  memory=0 Bytes memory_bytes=0 name=noun_phrase_extractor time=0 microseconds time_s=0.006440052002290031
</pre></div>
</div>
</div>
</div>
<p>Get and use the models from <code class="docutils literal notranslate"><span class="pre">nlp_models</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noun_extractor</span> <span class="o">=</span> <span class="n">model_collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;noun_phrase_extractor&quot;</span><span class="p">)</span>
<span class="n">noun_extractor</span><span class="p">(</span><span class="s2">&quot;What are your learning strategies?&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WordList([&#39;learning strategies&#39;])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sentiment_analyzer</span> <span class="o">=</span> <span class="n">model_collections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sentiment_analyzer&quot;</span><span class="p">)</span>
<span class="n">sentiment_analyzer</span><span class="p">(</span><span class="s2">&quot;Today is a beautiful day!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sentiment(polarity=1.0, subjectivity=1.0)
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/Cornerstone-OnDemand/modelkit/">Link to modelkit</a>.</p>
</section>
<section id="decomposing-high-dimensional-data-into-two-or-three-dimensions">
<h2><span class="section-number">6.5.6. </span>Decomposing High-Dimensional Data into Two or Three Dimensions<a class="headerlink" href="#decomposing-high-dimensional-data-into-two-or-three-dimensions" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>yellowbrick
</pre></div>
</div>
</div>
</details>
</div>
<p>If you want to decompose high dimensional data into two or three dimensions to visualize it, what should you do? A common technique is PCA. Even though PCA is useful, it can be complicated to create a PCA plot.</p>
<p>Lucikily, Yellowbrick allows you visualize PCA in a few lines of code</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yellowbrick.datasets</span> <span class="kn">import</span> <span class="n">load_credit</span>
<span class="kn">from</span> <span class="nn">yellowbrick.features</span> <span class="kn">import</span> <span class="n">PCA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 17;
                var nbb_unformatted_code = "from yellowbrick.datasets import load_credit\nfrom yellowbrick.features import PCA";
                var nbb_formatted_code = "from yellowbrick.datasets import load_credit\nfrom yellowbrick.features import PCA";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_credit</span><span class="p">()</span>
<span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;account in defaut&quot;</span><span class="p">,</span> <span class="s2">&quot;current with bills&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 18;
                var nbb_unformatted_code = "X, y = load_credit()\nclasses = ['account in defaut', 'current with bills']";
                var nbb_formatted_code = "X, y = load_credit()\nclasses = [\"account in defaut\", \"current with bills\"]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualizer</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">classes</span><span class="o">=</span><span class="n">classes</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">visualizer</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/57b23ac70acbf76da5b49aee76ea2c973dac0f00a088e63ec2cfe5830462b73f.png" src="../_images/57b23ac70acbf76da5b49aee76ea2c973dac0f00a088e63ec2cfe5830462b73f.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:title={&#39;center&#39;:&#39;Principal Component Plot&#39;}, xlabel=&#39;$PC_1$&#39;, ylabel=&#39;$PC_2$&#39;&gt;
</pre></div>
</div>
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 19;
                var nbb_unformatted_code = "visualizer = PCA(scale=True, classes=classes)\nvisualizer.fit_transform(X, y)\nvisualizer.show()";
                var nbb_formatted_code = "visualizer = PCA(scale=True, classes=classes)\nvisualizer.fit_transform(X, y)\nvisualizer.show()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p><a class="reference external" href="https://www.scikit-yb.org/en/latest/">Link to Yellowbrick</a></p>
</section>
<section id="visualize-feature-importances-with-yellowbrick">
<h2><span class="section-number">6.5.7. </span>Visualize Feature Importances with Yellowbrick<a class="headerlink" href="#visualize-feature-importances-with-yellowbrick" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>yellowbrick
</pre></div>
</div>
</div>
</details>
</div>
<p>More features donâ€™t always mean a better model. Too many features can lead to overfitting. To improve your model, you might need to identify and eliminate less important features. Yellowbrickâ€™s <code class="docutils literal notranslate"><span class="pre">FeatureImportances</span></code> can help with this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>
<span class="kn">from</span> <span class="nn">yellowbrick.datasets</span> <span class="kn">import</span> <span class="n">load_occupancy</span>
<span class="kn">from</span> <span class="nn">yellowbrick.model_selection</span> <span class="kn">import</span> <span class="n">FeatureImportances</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_occupancy</span><span class="p">()</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">()</span>

<span class="n">viz</span> <span class="o">=</span> <span class="n">FeatureImportances</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="n">viz</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">viz</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/59121ccac1ee91397b8262f673833867e170d63330e0ad5bf8d23c3589eebb7c.png" src="../_images/59121ccac1ee91397b8262f673833867e170d63330e0ad5bf8d23c3589eebb7c.png" />
</div>
</div>
<p>From the plot above, it seems like the light is the most important feature to DecisionTreeClassifier, followed by CO2, temperature.</p>
<p><a class="reference external" href="https://www.scikit-yb.org/en/latest/">Link to Yellowbrick</a></p>
</section>
<section id="validation-curve-determine-if-an-estimator-is-underfitting-over-overfitting">
<h2><span class="section-number">6.5.8. </span>Validation Curve: Determine if an Estimator Is Underfitting Over Overfitting<a class="headerlink" href="#validation-curve-determine-if-an-estimator-is-underfitting-over-overfitting" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>yellowbrick
</pre></div>
</div>
</div>
</details>
</div>
<p>To determine if your model is overfitting or underfitting, use Yellowbrickâ€™s validation curve. This technique helps find the optimal hyperparameter value where the model performs well on both training and validation sets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">yellowbrick.datasets.loaders</span> <span class="kn">import</span> <span class="n">load_occupancy</span>
<span class="kn">from</span> <span class="nn">yellowbrick.model_selection</span> <span class="kn">import</span> <span class="n">validation_curve</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load data</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">load_occupancy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>In the code below, we choose the range of <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> to be from 1 to 11.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">viz</span> <span class="o">=</span> <span class="n">validation_curve</span><span class="p">(</span>
    <span class="n">DecisionTreeClassifier</span><span class="p">(),</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">param_name</span><span class="o">=</span><span class="s2">&quot;max_depth&quot;</span><span class="p">,</span>
    <span class="n">param_range</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/fae982ffa915e0ef0ca80434024a5eb543e9e44d4a37c38ac6c29a8ab029c334.png" src="../_images/fae982ffa915e0ef0ca80434024a5eb543e9e44d4a37c38ac6c29a8ab029c334.png" />
</div>
</div>
<p>As we can see from the plot above, although <code class="docutils literal notranslate"><span class="pre">max_depth</span></code> &gt; 2 has a higher training score but a lower cross-validation score. This indicates that the model is overfitting.</p>
<p>Thus, the sweet spot will be where the cross-validation score neither increases nor decreases, which is 2.</p>
<p><a class="reference external" href="https://www.scikit-yb.org/en/latest/index.html">Link to Yellowbrick</a>.</p>
</section>
<section id="mlxtend-plot-decision-regions-of-your-ml-classifiers">
<h2><span class="section-number">6.5.9. </span>Mlxtend: Plot Decision Regions of Your ML Classifiers<a class="headerlink" href="#mlxtend-plot-decision-regions-of-your-ml-classifiers" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>mlxtend<span class="w">  </span>
</pre></div>
</div>
</div>
</details>
</div>
<p>To understand how your classifier makes decisions, plotting decision regions can be insightful. Mlxtendâ€™s <code class="docutils literal notranslate"><span class="pre">plot_decision_regions</span></code> function makes this easy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gridspec</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">mlxtend.classifier</span> <span class="kn">import</span> <span class="n">EnsembleVoteClassifier</span>
<span class="kn">from</span> <span class="nn">mlxtend.data</span> <span class="kn">import</span> <span class="n">iris_data</span>
<span class="kn">from</span> <span class="nn">mlxtend.plotting</span> <span class="kn">import</span> <span class="n">plot_decision_regions</span>

<span class="c1"># Initializing Classifiers</span>
<span class="n">clf1</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">clf2</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">clf3</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">eclf</span> <span class="o">=</span> <span class="n">EnsembleVoteClassifier</span><span class="p">(</span><span class="n">clfs</span><span class="o">=</span><span class="p">[</span><span class="n">clf1</span><span class="p">,</span> <span class="n">clf2</span><span class="p">,</span> <span class="n">clf3</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">voting</span><span class="o">=</span><span class="s1">&#39;soft&#39;</span><span class="p">)</span>

<span class="c1"># Loading some example data</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">iris_data</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:,[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>

<span class="c1"># Plotting Decision Regions</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="k">for</span> <span class="n">clf</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">grd</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">clf1</span><span class="p">,</span> <span class="n">clf2</span><span class="p">,</span> <span class="n">clf3</span><span class="p">,</span> <span class="n">eclf</span><span class="p">],</span>
                         <span class="p">[</span><span class="s1">&#39;Logistic Regression&#39;</span><span class="p">,</span> <span class="s1">&#39;Random Forest&#39;</span><span class="p">,</span> <span class="s1">&#39;RBF kernel SVM&#39;</span><span class="p">,</span> <span class="s1">&#39;Ensemble&#39;</span><span class="p">],</span>
                         <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">2</span><span class="p">)):</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="n">grd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">grd</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_decision_regions</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">clf</span><span class="o">=</span><span class="n">clf</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">lab</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6f2c41a01d88a7f8a79a4d88b2c11452a341031dc980a7c9e19c904e0dd80062.png" src="../_images/6f2c41a01d88a7f8a79a4d88b2c11452a341031dc980a7c9e19c904e0dd80062.png" />
</div>
</div>
<p>Mlxtend (machine learning extensions) is a Python library of useful tools for the day-to-day data science tasks.</p>
<p>Find other useful functionalities of Mlxtend <a class="reference external" href="https://github.com/rasbt/mlxtend">here</a>.</p>
</section>
<section id="imbalanced-learn-deal-with-an-imbalanced-dataset">
<h2><span class="section-number">6.5.10. </span>imbalanced-learn: Deal with an Imbalanced Dataset<a class="headerlink" href="#imbalanced-learn-deal-with-an-imbalanced-dataset" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>imbalanced-learn<span class="o">==</span><span class="m">0</span>.10.0<span class="w"> </span><span class="nv">mlxtend</span><span class="o">==</span><span class="m">0</span>.21.0<span class="w"> </span>scikit-learn<span class="o">==</span><span class="m">1</span>.2.2
</pre></div>
</div>
</div>
</details>
</div>
<p>In machine learning, imbalanced datasets can lead to biased models that perform poorly on minority classes. This is particularly problematic in critical applications like fraud detection or disease diagnosis.</p>
<p>With imbalanced-learn, you can rebalance your dataset using various sampling techniques that work seamlessly with scikit-learn.</p>
<p>To demonstrate this, letâ€™s generate a sample dataset with 5000 samples, 2 features, and 4 classes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Libraries for plotting</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mlxtend.plotting</span> <span class="kn">import</span> <span class="n">plot_decision_regions</span>

<span class="c1"># Libraries for machine learning</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">LinearSVC</span>
<span class="kn">from</span> <span class="nn">imblearn.over_sampling</span> <span class="kn">import</span> <span class="n">RandomOverSampler</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
    <span class="n">n_features</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">n_informative</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">n_redundant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">n_repeated</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">n_classes</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">n_clusters_per_class</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.90</span><span class="p">],</span>
    <span class="n">class_sep</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Resample the dataset using the <code class="docutils literal notranslate"><span class="pre">RandomOverSampler</span></code> class from imbalanced-learn to balance the class distribution. This technique works by duplicating minority samples until they match the majority class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ros</span> <span class="o">=</span> <span class="n">RandomOverSampler</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X_resampled</span><span class="p">,</span> <span class="n">y_resampled</span> <span class="o">=</span> <span class="n">ros</span><span class="o">.</span><span class="n">fit_resample</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Plot the decision regions of the dataset before and after resampling using a LinearSVC classifier:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting Decision Regions</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">Xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
    <span class="p">[</span><span class="n">X</span><span class="p">,</span> <span class="n">X_resampled</span><span class="p">],</span>
    <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y_resampled</span><span class="p">],</span>
    <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;Without resampling&quot;</span><span class="p">,</span> <span class="s2">&quot;Using RandomOverSampler&quot;</span><span class="p">],</span>
<span class="p">):</span>
    <span class="n">clf</span> <span class="o">=</span> <span class="n">LinearSVC</span><span class="p">()</span>
    <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">Xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_decision_regions</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">Xi</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yi</span><span class="p">,</span> <span class="n">clf</span><span class="o">=</span><span class="n">clf</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;#E583B6,#72FCDB,#72BEFA,#FFFF99&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#000000&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/khuyentran/book/venv/lib/python3.11/site-packages/mlxtend/plotting/decision_regions.py:300: UserWarning: You passed a edgecolor/edgecolors (&#39;black&#39;) for an unfilled marker (&#39;x&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax.scatter(
/Users/khuyentran/book/venv/lib/python3.11/site-packages/mlxtend/plotting/decision_regions.py:300: UserWarning: You passed a edgecolor/edgecolors (&#39;black&#39;) for an unfilled marker (&#39;x&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax.scatter(
</pre></div>
</div>
<img alt="../_images/e43620bfb9013971379f44ef7fd72ada3ee7a94c58e698b515b15ee4101cfa2c.png" src="../_images/e43620bfb9013971379f44ef7fd72ada3ee7a94c58e698b515b15ee4101cfa2c.png" />
</div>
</div>
<p>The plot reveals that the resampling process has added more data points to the minority class (green), effectively balancing the class distribution.</p>
<p><a class="reference external" href="https://github.com/scikit-learn-contrib/imbalanced-learn">Link to imbalanced-learn</a>.</p>
</section>
<section id="estimate-prediction-intervals-in-scikit-learn-models-with-mapie">
<h2><span class="section-number">6.5.11. </span>Estimate Prediction Intervals in Scikit-Learn Models with MAPIE<a class="headerlink" href="#estimate-prediction-intervals-in-scikit-learn-models-with-mapie" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>mapie
</pre></div>
</div>
</div>
</details>
</div>
<p>To estimate prediction intervals for scikit-learn models, use the MAPIE library:</p>
<p>In the code below, we use <code class="docutils literal notranslate"><span class="pre">MapieRegressor</span></code> to estimate prediction intervals for a scikit-learn regressor.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mapie.regression</span> <span class="kn">import</span> <span class="n">MapieRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_regression</span>

<span class="c1"># Create data</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_regression</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Train and predict</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">]</span>
<span class="n">mapie</span> <span class="o">=</span> <span class="n">MapieRegressor</span><span class="p">(</span><span class="n">LinearRegression</span><span class="p">())</span>
<span class="n">mapie</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">y_pred</span><span class="p">,</span> <span class="n">y_pis</span> <span class="o">=</span> <span class="n">mapie</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute the coverage of the prediction intervals</span>
<span class="kn">from</span> <span class="nn">mapie.metrics</span> <span class="kn">import</span> <span class="n">regression_coverage_score</span>

<span class="n">coverage_scores</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">regression_coverage_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y_pis</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">],</span> <span class="n">y_pis</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the estimated prediction intervals</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;#06B1CF&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#E48789&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">order</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">y_pis</span><span class="p">[</span><span class="n">order</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#E48789&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">order</span><span class="p">],</span> <span class="n">y_pis</span><span class="p">[</span><span class="n">order</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#E48789&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">X</span><span class="p">[</span><span class="n">order</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
    <span class="n">y_pis</span><span class="p">[</span><span class="n">order</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
    <span class="n">y_pis</span><span class="p">[</span><span class="n">order</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#E48789&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Target coverages for &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">: (</span><span class="si">{</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">coverage_scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Target coverages for &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;alpha=</span><span class="si">{</span><span class="n">alpha</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">: (</span><span class="si">{</span><span class="mi">1</span><span class="o">-</span><span class="n">alpha</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">coverage_scores</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0940cc07c36b515dbe21d89e2a8b60923da5c9c4d509cd5213205811d8986437.png" src="../_images/0940cc07c36b515dbe21d89e2a8b60923da5c9c4d509cd5213205811d8986437.png" />
</div>
</div>
<p><a class="reference external" href="https://github.com/scikit-learn-contrib/MAPIE">Link to MAPIE</a>.</p>
</section>
<section id="mlforecast-scalable-machine-learning-for-time-series">
<h2><span class="section-number">6.5.12. </span>mlforecast: Scalable Machine Learning for Time Series<a class="headerlink" href="#mlforecast-scalable-machine-learning-for-time-series" title="Permalink to this heading">#</a></h2>
<p>If you want to perform time series forecasting using machine learning models and scale to massive amounts of data with distributed training, try mlforecast.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlforecast.distributed</span> <span class="kn">import</span> <span class="n">DistributedMLForecast</span>
<span class="kn">from</span> <span class="nn">mlforecast.distributed.models.dask.lgb</span> <span class="kn">import</span> <span class="n">DaskLGBMForecast</span>
<span class="kn">from</span> <span class="nn">mlforecast.target_transforms</span> <span class="kn">import</span> <span class="n">Differences</span>

<span class="c1"># Create Dask Dataframe</span>
<span class="n">series_ddf</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Perform distributed training</span>
<span class="n">fcst</span> <span class="o">=</span> <span class="n">DistributedMLForecast</span><span class="p">(</span>
    <span class="n">models</span><span class="o">=</span><span class="n">DaskLGBMForecast</span><span class="p">(),</span>
    <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="c1"># daily frequency</span>
    <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> 
    <span class="n">target_transforms</span><span class="o">=</span><span class="p">[</span><span class="n">Differences</span><span class="p">([</span><span class="mi">1</span><span class="p">])],</span>
<span class="p">)</span>
<span class="n">fcst</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">series_ddf</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://nixtla.github.io/mlforecast/docs/quick_start_distributed.html">Full code of the example above</a>.</p>
<p><a class="reference external" href="https://github.com/Nixtla/mlforecast">Link to mlforecast</a>.</p>
</section>
<section id="mlem-capture-your-machine-learning-model-s-metadata">
<h2><span class="section-number">6.5.13. </span>MLEM: Capture Your Machine Learning Modelâ€™s Metadata<a class="headerlink" href="#mlem-capture-your-machine-learning-model-s-metadata" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>mlem<span class="w"> </span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The metadata of a machine learning model provides important information about the model such as:</p>
<ul class="simple">
<li><p>Hash value</p></li>
<li><p>Model methods</p></li>
<li><p>Input data schema</p></li>
<li><p>Python requirements used to train the model.</p></li>
</ul>
<p>This information enables others to reproduce the model and its results.</p>
<p>With MLEM, you can save both the model and its metadata in a single line of code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="c1"># Load the diabetes dataset</span>
<span class="n">diabetes</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">load_diabetes</span><span class="p">()</span>

<span class="c1"># Split the dataset into training and testing sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">diabetes</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">diabetes</span><span class="o">.</span><span class="n">target</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Create a linear regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

<span class="c1"># Train the model on the training set</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "â–¸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "â–¾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mlem.api</span> <span class="kn">import</span> <span class="n">save</span> 

<span class="c1"># Instead of joblib.dump(model, &#39;model/diabetes_model&#39;)</span>
<span class="n">save</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;model/diabetes_model&#39;</span><span class="p">,</span> <span class="n">sample_data</span><span class="o">=</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MlemModel(location=Location(path=&#39;/Users/khuyentran/book/Efficient_Python_tricks_and_tools_for_data_scientists/Chapter5/model/diabetes_model.mlem&#39;, project=None, rev=None, uri=&#39;file:///Users/khuyentran/book/Efficient_Python_tricks_and_tools_for_data_scientists/Chapter5/model/diabetes_model.mlem&#39;, project_uri=None, fs=&lt;fsspec.implementations.local.LocalFileSystem object at 0x16b631430&gt;), params={}, artifacts={&#39;data&#39;: LocalArtifact(uri=&#39;diabetes_model&#39;, size=563, hash=&#39;c57e456e8a0768326655a8b52cde4f47&#39;)}, requirements=Requirements(__root__=[InstallableRequirement(module=&#39;sklearn&#39;, version=&#39;1.2.1&#39;, package_name=&#39;scikit-learn&#39;, extra_index=None, source_url=None, vcs=None, vcs_commit=None), InstallableRequirement(module=&#39;numpy&#39;, version=&#39;1.24.2&#39;, package_name=None, extra_index=None, source_url=None, vcs=None, vcs_commit=None)]), processors_cache={&#39;model&#39;: SklearnModel(model=LinearRegression(), io=SimplePickleIO(), methods={&#39;predict&#39;: Signature(name=&#39;predict&#39;, args=[Argument(name=&#39;X&#39;, type_=NumpyNdarrayType(value=None, shape=(None, 10), dtype=&#39;float64&#39;), required=True, default=None, kw_only=False)], returns=NumpyNdarrayType(value=None, shape=(None,), dtype=&#39;float64&#39;), varargs=None, varargs_type=None, varkw=None, varkw_type=None)})}, call_orders={&#39;predict&#39;: [(&#39;model&#39;, &#39;predict&#39;)]})
</pre></div>
</div>
</div>
</div>
<p>Running the code above will create two files: a model file and a metadata file.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>model
<span class="w"> </span>â”œâ”€â”€<span class="w">  </span>diabetes_model<span class="w">  </span>
<span class="w"> </span>â””â”€â”€<span class="w">  </span>diabetes_model.mlem<span class="w">  </span>
</pre></div>
</div>
<p>Here is what the metadata file looks like:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># model/diabetes_model.mlem</span>

<span class="nt">artifacts</span><span class="p">:</span>
<span class="w">  </span><span class="nt">data</span><span class="p">:</span>
<span class="w">    </span><span class="nt">hash</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c57e456e8a0768326655a8b52cde4f47</span>
<span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">563</span>
<span class="w">    </span><span class="nt">uri</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">diabetes_model</span>
<span class="nt">call_orders</span><span class="p">:</span>
<span class="w">  </span><span class="nt">predict</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">model</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">predict</span>
<span class="nt">object_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">model</span>
<span class="nt">processors</span><span class="p">:</span>
<span class="w">  </span><span class="nt">model</span><span class="p">:</span>
<span class="w">    </span><span class="nt">methods</span><span class="p">:</span>
<span class="w">      </span><span class="nt">predict</span><span class="p">:</span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">X</span>
<span class="w">          </span><span class="nt">type_</span><span class="p">:</span>
<span class="w">            </span><span class="nt">dtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">float64</span>
<span class="w">            </span><span class="nt">shape</span><span class="p">:</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ndarray</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">predict</span>
<span class="w">        </span><span class="nt">returns</span><span class="p">:</span>
<span class="w">          </span><span class="nt">dtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">float64</span>
<span class="w">          </span><span class="nt">shape</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">null</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ndarray</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sklearn</span>
<span class="nt">requirements</span><span class="p">:</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sklearn</span>
<span class="w">  </span><span class="nt">package_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">scikit-learn</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.2.1</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">module</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">numpy</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.24.2</span>
</pre></div>
</div>
<p><a class="reference external" href="https://mlem.ai/">Link to MLEM</a>.</p>
<p><a class="reference external" href="https://towardsdatascience.com/automate-machine-learning-deployment-with-github-actions-f752766981b1?sk=6e234bb505e6bc426bb4760e4b20da1b">How to deploy your model with MLEM</a>.</p>
</section>
<section id="distributed-machine-learning-with-mllib">
<h2><span class="section-number">6.5.14. </span>Distributed Machine Learning with MLlib<a class="headerlink" href="#distributed-machine-learning-with-mllib" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pyspark
</pre></div>
</div>
</div>
</details>
</div>
<p>If you want to perform distributed machine learning tasks and handle large-scale datasets, use MLlib. Itâ€™s designed to work seamlessly with Apache Spark, making it a powerful tool for scalable machine learning.</p>
<p>Similar to scikit-learn, MLlib provides the following tools:</p>
<ul class="simple">
<li><p>ML Algorithms: Classification, regression, clustering, and collaborative filtering</p></li>
<li><p>Featurization: Feature extraction, transformation, dimensionality reduction, and selection</p></li>
<li><p>Pipelines: Construction, evaluation, and tuning of ML Pipelines</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyspark.ml.linalg</span> <span class="kn">import</span> <span class="n">Vectors</span>
<span class="kn">from</span> <span class="nn">pyspark.ml.classification</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="o">.</span><span class="n">builder</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>

<span class="c1"># Prepare training data from a list of (label, features) tuples.</span>
<span class="n">training</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])),</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])),</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])),</span>
        <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">])),</span>
    <span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Prepare test data</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.3</span><span class="p">])),</span>
        <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">])),</span>
        <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">Vectors</span><span class="o">.</span><span class="n">dense</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">])),</span>
    <span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;features&quot;</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Create a LogisticRegression instance. This instance is an Estimator.</span>
<span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">maxIter</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">regParam</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Learn a LogisticRegression model. This uses the parameters stored in lr.</span>
<span class="n">model1</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">training</span><span class="p">)</span>

<span class="c1"># Make predictions on test data using the Transformer.transform() method.</span>
<span class="c1"># LogisticRegression.transform will only use the &#39;features&#39; column.</span>
<span class="n">prediction</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">prediction</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;probability&quot;</span><span class="p">,</span> <span class="s2">&quot;prediction&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;features=</span><span class="si">%s</span><span class="s2">, label=</span><span class="si">%s</span><span class="s2"> -&gt; prob=</span><span class="si">%s</span><span class="s2">, prediction=</span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="o">%</span> <span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">features</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">probability</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">prediction</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>LogisticRegression parameters:
aggregationDepth: suggested depth for treeAggregate (&gt;= 2). (default: 2)
elasticNetParam: the ElasticNet mixing parameter, in range [0, 1]. For alpha = 0, the penalty is an L2 penalty. For alpha = 1, it is an L1 penalty. (default: 0.0)
family: The name of family which is a description of the label distribution to be used in the model. Supported options: auto, binomial, multinomial (default: auto)
featuresCol: features column name. (default: features)
fitIntercept: whether to fit an intercept term. (default: True)
labelCol: label column name. (default: label)
lowerBoundsOnCoefficients: The lower bounds on coefficients if fitting under bound constrained optimization. The bound matrix must be compatible with the shape (1, number of features) for binomial regression, or (number of classes, number of features) for multinomial regression. (undefined)
lowerBoundsOnIntercepts: The lower bounds on intercepts if fitting under bound constrained optimization. The bounds vector size must beequal with 1 for binomial regression, or the number oflasses for multinomial regression. (undefined)
maxBlockSizeInMB: maximum memory in MB for stacking input data into blocks. Data is stacked within partitions. If more than remaining data size in a partition then it is adjusted to the data size. Default 0.0 represents choosing optimal value, depends on specific algorithm. Must be &gt;= 0. (default: 0.0)
maxIter: max number of iterations (&gt;= 0). (default: 100, current: 10)
predictionCol: prediction column name. (default: prediction)
probabilityCol: Column name for predicted class conditional probabilities. Note: Not all models output well-calibrated probability estimates! These probabilities should be treated as confidences, not precise probabilities. (default: probability)
rawPredictionCol: raw prediction (a.k.a. confidence) column name. (default: rawPrediction)
regParam: regularization parameter (&gt;= 0). (default: 0.0, current: 0.01)
standardization: whether to standardize the training features before fitting the model. (default: True)
threshold: Threshold in binary classification prediction, in range [0, 1]. If threshold and thresholds are both set, they must match.e.g. if threshold is p, then thresholds must be equal to [1-p, p]. (default: 0.5)
thresholds: Thresholds in multi-class classification to adjust the probability of predicting each class. Array must have length equal to the number of classes, with values &gt; 0, excepting that at most one value may be 0. The class with largest value p/t is predicted, where p is the original probability of that class and t is the class&#39;s threshold. (undefined)
tol: the convergence tolerance for iterative algorithms (&gt;= 0). (default: 1e-06)
upperBoundsOnCoefficients: The upper bounds on coefficients if fitting under bound constrained optimization. The bound matrix must be compatible with the shape (1, number of features) for binomial regression, or (number of classes, number of features) for multinomial regression. (undefined)
upperBoundsOnIntercepts: The upper bounds on intercepts if fitting under bound constrained optimization. The bound vector size must be equal with 1 for binomial regression, or the number of classes for multinomial regression. (undefined)
weightCol: weight column name. If this is not set or empty, we treat all instance weights as 1.0. (undefined)

features=[-1.0,1.5,1.3], label=1.0 -&gt; prob=[0.0019392203169556147,0.9980607796830444], prediction=1.0
features=[3.0,2.0,-0.1], label=0.0 -&gt; prob=[0.995731919571047,0.004268080428952992], prediction=0.0
features=[0.0,2.2,-1.5], label=1.0 -&gt; prob=[0.01200463023637096,0.987995369763629], prediction=1.0
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://spark.apache.org/docs/latest/ml-guide.html">Link to MLlib</a>.</p>
</section>
<section id="rapid-prototyping-and-comparison-of-basic-models-with-lazy-predict">
<h2><span class="section-number">6.5.15. </span>Rapid Prototyping and Comparison of Basic Models with Lazy Predict<a class="headerlink" href="#rapid-prototyping-and-comparison-of-basic-models-with-lazy-predict" title="Permalink to this heading">#</a></h2>
<p>Lazy Predict enables rapid prototyping and comparison of multiple basic models without extensive manual coding or parameter tuning.</p>
<p>This helps data scientists identify promising approaches and iterate on them more quickly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lazypredict.Supervised</span> <span class="kn">import</span> <span class="n">LazyClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_breast_cancer</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">load_breast_cancer</span><span class="p">()</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">data</span>
<span class="n">y</span><span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">target</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span><span class="n">test_size</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span><span class="n">random_state</span> <span class="o">=</span><span class="mi">123</span><span class="p">)</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">LazyClassifier</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_warnings</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">custom_metric</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">models</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="p">|</span><span class="w"> </span>Model<span class="w">                          </span><span class="p">|</span><span class="w">   </span>Accuracy<span class="w"> </span><span class="p">|</span><span class="w">   </span>Balanced<span class="w"> </span>Accuracy<span class="w"> </span><span class="p">|</span><span class="w">   </span>ROC<span class="w"> </span>AUC<span class="w"> </span><span class="p">|</span><span class="w">   </span>F1<span class="w"> </span>Score<span class="w"> </span><span class="p">|</span><span class="w">   </span>Time<span class="w"> </span>Taken<span class="w"> </span><span class="p">|</span>
<span class="p">|</span>:-------------------------------<span class="p">|</span>-----------:<span class="p">|</span>--------------------:<span class="p">|</span>----------:<span class="p">|</span>-----------:<span class="p">|</span>-------------:<span class="p">|</span>
<span class="p">|</span><span class="w"> </span>LinearSVC<span class="w">                      </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.989474<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.987544<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.987544<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.989462<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0150008<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>SGDClassifier<span class="w">                  </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.989474<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.987544<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.987544<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.989462<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0109992<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>MLPClassifier<span class="w">                  </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.985965<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.986904<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.986904<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.985994<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.426<span class="w">     </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>Perceptron<span class="w">                     </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.985965<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.984797<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.984797<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.985965<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0120046<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>LogisticRegression<span class="w">             </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.985965<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.98269<span class="w">  </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.98269<span class="w">  </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.985934<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0200036<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>LogisticRegressionCV<span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.985965<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.98269<span class="w">  </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.98269<span class="w">  </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.985934<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.262997<span class="w">  </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>SVC<span class="w">                            </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.982456<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.979942<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.979942<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.982437<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0140011<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>CalibratedClassifierCV<span class="w">         </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.982456<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.975728<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.975728<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.982357<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0350015<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>PassiveAggressiveClassifier<span class="w">    </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.975439<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.974448<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.974448<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.975464<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0130005<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>LabelPropagation<span class="w">               </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.975439<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.974448<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.974448<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.975464<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0429988<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>LabelSpreading<span class="w">                 </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.975439<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.974448<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.974448<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.975464<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0310006<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>RandomForestClassifier<span class="w">         </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.97193<span class="w">  </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.969594<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.969594<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.97193<span class="w">  </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.033<span class="w">     </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>GradientBoostingClassifier<span class="w">     </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.97193<span class="w">  </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.967486<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.967486<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.971869<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.166998<span class="w">  </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>QuadraticDiscriminantAnalysis<span class="w">  </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.964912<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.966206<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.966206<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.965052<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0119994<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>HistGradientBoostingClassifier<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.968421<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.964739<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.964739<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.968387<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.682003<span class="w">  </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>RidgeClassifierCV<span class="w">              </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.97193<span class="w">  </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.963272<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.963272<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.971736<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0130029<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>RidgeClassifier<span class="w">                </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.968421<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.960525<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.960525<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.968242<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0119977<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>AdaBoostClassifier<span class="w">             </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.961404<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.959245<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.959245<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.961444<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.204998<span class="w">  </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>ExtraTreesClassifier<span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.961404<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.957138<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.957138<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.961362<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0270066<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>KNeighborsClassifier<span class="w">           </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.961404<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.95503<span class="w">  </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.95503<span class="w">  </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.961276<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0560005<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>BaggingClassifier<span class="w">              </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.947368<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.954577<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.954577<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.947882<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0559971<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>BernoulliNB<span class="w">                    </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.950877<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.951003<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.951003<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.951072<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0169988<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>LinearDiscriminantAnalysis<span class="w">     </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.961404<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.950816<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.950816<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.961089<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0199995<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>GaussianNB<span class="w">                     </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.954386<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.949536<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.949536<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.954337<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0139935<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>NuSVC<span class="w">                          </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.954386<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.943215<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.943215<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.954014<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.019989<span class="w">  </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>DecisionTreeClassifier<span class="w">         </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.936842<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.933693<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.933693<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.936971<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0170023<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>NearestCentroid<span class="w">                </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.947368<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.933506<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.933506<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.946801<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0160074<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>ExtraTreeClassifier<span class="w">            </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.922807<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.912168<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.912168<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.922462<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0109999<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>CheckingClassifier<span class="w">             </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.361404<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.5<span class="w">      </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5<span class="w">      </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.191879<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0170043<span class="w"> </span><span class="p">|</span>
<span class="p">|</span><span class="w"> </span>DummyClassifier<span class="w">                </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.512281<span class="w"> </span><span class="p">|</span><span class="w">            </span><span class="m">0</span>.489598<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.489598<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.518924<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.0119965<span class="w"> </span><span class="p">|</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/shankarpandala/lazypredict">Link to Lazy Predict</a>.</p>
</section>
<section id="autogluon-fast-and-accurate-ml-in-3-lines-of-code">
<h2><span class="section-number">6.5.16. </span>AutoGluon: Fast and Accurate ML in 3 Lines of Code<a class="headerlink" href="#autogluon-fast-and-accurate-ml-in-3-lines-of-code" title="Permalink to this heading">#</a></h2>
<p>The traditional scikit-learn approach requires extensive manual work, including data preprocessing, model selection, and hyperparameter tuning.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span><span class="p">,</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="c1"># Preprocessing Pipeline</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">numerical_columns</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_columns</span><span class="p">)</span>
    <span class="p">])</span>

<span class="c1"># Machine Learning Pipeline</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>

<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Hyperparameter Tuning</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;model__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">],</span>
    <span class="s1">&#39;model__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
    <span class="s1">&#39;model__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<span class="p">}</span>

<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;accuracy&#39;</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
<p>In contrast, AutoGluon automates these tasks, allowing you to train and deploy accurate models in 3 lines of code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">autogluon.tabular</span> <span class="kn">import</span> <span class="n">TabularPredictor</span>

<span class="n">predictor</span> <span class="o">=</span> <span class="n">TabularPredictor</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;class&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">predictor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference external" href="https://github.com/autogluon/autogluon">Link to AutoGluon</a>.</p>
</section>
<section id="model-logging-made-easy-mlflow-vs-pickle">
<h2><span class="section-number">6.5.17. </span>Model Logging Made Easy: MLflow vs. Pickle<a class="headerlink" href="#model-logging-made-easy-mlflow-vs-pickle" title="Permalink to this heading">#</a></h2>
<p>Here is why using MLflow to log model is superior to using pickle to save model:</p>
<ol class="arabic simple">
<li><p>Managing Library Versions:</p></li>
</ol>
<ul class="simple">
<li><p>Problem: Different models may require different versions of the same library, which can lead to conflicts. Manually tracking and setting up the correct environment for each model is time-consuming and error-prone.</p></li>
<li><p>Solution: By automatically logging dependencies, MLflow ensures that anyone can recreate the exact environment needed to run the model.</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>Documenting Inputs and Outputs:</p></li>
</ol>
<ul class="simple">
<li><p>Problem: Often, the expected inputs and outputs of a model are not well-documented, making it difficult for others to use the model correctly.</p></li>
<li><p>Solution: By defining a clear schema for inputs and outputs, MLflow ensures that anyone using the model knows exactly what data to provide and what to expect in return.</p></li>
</ul>
<p>To demonstrate the advantages of MLflow, letâ€™s implement a simple logistic regression model and log it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">from</span> <span class="nn">mlflow.models</span> <span class="kn">import</span> <span class="n">infer_signature</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>

<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
    <span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">signature</span> <span class="o">=</span> <span class="n">infer_signature</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>

    <span class="n">model_info</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span>
        <span class="n">sk_model</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">artifact_path</span><span class="o">=</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">signature</span><span class="o">=</span><span class="n">signature</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving data to </span><span class="si">{</span><span class="n">model_info</span><span class="o">.</span><span class="n">model_uri</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Saving data to runs:/f8b0fc900aa14cf0ade8d0165c5a9f11/model
</pre></div>
</div>
</div>
</div>
<p>The output indicates where the model has been saved. To use the logged model later, you can load it with the <code class="docutils literal notranslate"><span class="pre">model_uri</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">model_uri</span> <span class="o">=</span> <span class="s2">&quot;runs:/1e20d72afccf450faa3b8a9806a97e83/model&quot;</span>
<span class="n">sklearn_pyfunc</span> <span class="o">=</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">pyfunc</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span><span class="n">model_uri</span><span class="o">=</span><span class="n">model_uri</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">predictions</span> <span class="o">=</span> <span class="n">sklearn_pyfunc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Letâ€™s inspect the artifacts saved with the model:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">cd</span> mlruns/0/1e20d72afccf450faa3b8a9806a97e83/artifacts/model
<span class="o">%</span><span class="k">ls</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/khuyentran/book/Efficient_Python_tricks_and_tools_for_data_scientists/Chapter5/mlruns/0/1e20d72afccf450faa3b8a9806a97e83/artifacts/model
MLmodel           model.pkl         requirements.txt
conda.yaml        python_env.yaml
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">MLmodel</span></code> file provides essential information about the model, including dependencies and input/output specifications:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">cat</span> MLmodel
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>artifact_path: model
flavors:
  python_function:
    env:
      conda: conda.yaml
      virtualenv: python_env.yaml
    loader_module: mlflow.sklearn
    model_path: model.pkl
    predict_fn: predict
    python_version: 3.11.6
  sklearn:
    code: null
    pickled_model: model.pkl
    serialization_format: cloudpickle
    sklearn_version: 1.4.1.post1
mlflow_version: 2.15.0
model_size_bytes: 722
model_uuid: e7487bc3c4ab417c965144efcecaca2f
run_id: 1e20d72afccf450faa3b8a9806a97e83
signature:
  inputs: &#39;[{&quot;type&quot;: &quot;tensor&quot;, &quot;tensor-spec&quot;: {&quot;dtype&quot;: &quot;int64&quot;, &quot;shape&quot;: [-1, 1]}}]&#39;
  outputs: &#39;[{&quot;type&quot;: &quot;tensor&quot;, &quot;tensor-spec&quot;: {&quot;dtype&quot;: &quot;int64&quot;, &quot;shape&quot;: [-1]}}]&#39;
  params: null
utc_time_created: &#39;2024-08-02 20:58:16.516963&#39;
</pre></div>
</div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">conda.yaml</span></code> and <code class="docutils literal notranslate"><span class="pre">python_env.yaml</span></code> files outline the environment dependencies, ensuring that the model runs in a consistent setup:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">cat</span> conda.yaml
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>channels:
- conda-forge
dependencies:
- python=3.11.6
- pip&lt;=24.2
- pip:
  - mlflow==2.15.0
  - cloudpickle==2.2.1
  - numpy==1.23.5
  - psutil==5.9.6
  - scikit-learn==1.4.1.post1
  - scipy==1.11.3
name: mlflow-env
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">cat</span> python_env.yaml
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>python: 3.11.6
build_dependencies:
- pip==24.2
- setuptools
- wheel==0.40.0
dependencies:
- -r requirements.txt
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">cat</span> requirements.txt
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mlflow==2.15.0
cloudpickle==2.2.1
numpy==1.23.5
psutil==5.9.6
scikit-learn==1.4.1.post1
scipy==1.11.3
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://mlflow.org/docs/latest/models.html#python-function-python-function">Learn more about MLFlow Models</a>.</p>
</section>
<section id="simplifying-ml-model-integration-with-fastapi">
<h2><span class="section-number">6.5.18. </span>Simplifying ML Model Integration with FastAPI<a class="headerlink" href="#simplifying-ml-model-integration-with-fastapi" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip3<span class="w"> </span>install<span class="w"> </span>joblib<span class="w"> </span><span class="s2">&quot;fastapi[standard]&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Imagine this scenario: You have just built a machine learning (ML) model with great performance, and you want to share this model with your team members so that they can develop a web application on top of your model.</p>
<p>One way to share the model with your team members is to save the model to a file (e.g., using pickle, joblib, or framework-specific methods) and share the file directly</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>

<span class="n">model</span> <span class="o">=</span> <span class="o">...</span>

<span class="c1"># Save model</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;model.joblib&quot;</span><span class="p">)</span>

<span class="c1"># Load model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
<p>However, this approach requires the same environment and dependencies, and it can pose potential security risks.</p>
<p>An alternative is creating an API for your ML model. APIs define how software components interact, allowing:</p>
<ol class="arabic simple">
<li><p>Access from various programming languages and platforms</p></li>
<li><p>Easier integration for developers unfamiliar with ML or Python</p></li>
<li><p>Versatile use across different applications (web, mobile, etc.)</p></li>
</ol>
<p>This approach simplifies model sharing and usage, making it more accessible for diverse development needs.</p>
<p>Letâ€™s learn how to create an ML API with FastAPI, a modern and fast web framework for building APIs with Python.</p>
<p>Before we begin constructing an API for a machine learning model, letâ€™s first develop a basic model that our API will use. In this example, weâ€™ll create a model that predicts the median house price in California.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">fetch_california_housing</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Load dataset</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">fetch_california_housing</span><span class="p">(</span><span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_X_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Split dataset into training and test sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="c1"># Initialize and train the logistic regression model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Predict and evaluate the model</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean squared error: </span><span class="si">{</span><span class="n">mse</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Save model</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;lr.joblib&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mean squared error: 0.56
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;lr.joblib&#39;]
</pre></div>
</div>
</div>
</div>
<p>Once we have our model, we can create an API for it using FastAPI. Weâ€™ll define a POST endpoint for making predictions and use the model to make predictions.</p>
<p>Hereâ€™s an example of how to create an API for a machine learning model using FastAPI:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%writefile</span> ml_app.py
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 

<span class="c1"># Create a FastAPI application instance</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="c1"># Load the pre-trained machine learning model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;lr.joblib&quot;</span><span class="p">)</span>

<span class="c1"># Define a POST endpoint for making predictions</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/predict/&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]):</span>
    <span class="c1"># Define the column names for the input features</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;MedInc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HouseAge&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AveRooms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AveBedrms&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Population&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AveOccup&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Latitude&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Longitude&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    
    <span class="c1"># Create a pandas DataFrame from the input data</span>
    <span class="n">features</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">data</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
    
    <span class="c1"># Use the model to make a prediction</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Return the prediction as a JSON object, rounding to 2 decimal places</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">prediction</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overwriting ml_app.py
</pre></div>
</div>
</div>
</div>
<p>To run your FastAPI app for development, use the <code class="docutils literal notranslate"><span class="pre">fastapi</span> <span class="pre">dev</span></code> command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>fastapi<span class="w"> </span>dev<span class="w"> </span>ml_app.py
</pre></div>
</div>
<p>This will start the development server and open the API documentation in your default browser.</p>
<p>You can now use the API to make predictions by sending a POST request to the <code class="docutils literal notranslate"><span class="pre">/predict/</span></code> endpoint with the input data. For example:</p>
<p>Running this cURL command on your terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/predict/&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;[</span>
<span class="s1">  1.68, 25, 4, 2, 1400, 3, 36.06, -119.01</span>
<span class="s1">]&#39;</span>
</pre></div>
</div>
<p>This will return the predicted price as a JSON object, rounded to 2 decimal places:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s2">&quot;price&quot;</span><span class="p">:</span><span class="mf">1.51</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="imodels-simplifying-machine-learning-with-interpretable-models">
<h2><span class="section-number">6.5.19. </span>imodels: Simplifying Machine Learning with Interpretable Models<a class="headerlink" href="#imodels-simplifying-machine-learning-with-interpretable-models" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>imodels
</pre></div>
</div>
</div>
</details>
</div>
<p>Interpreting decisions made by complex modern machine learning models can be challenging.</p>
<p>imodels, a Python package, replaces black-box models (e.g. random forests) with simpler and interpretable alternatives (e.g. rule lists) without losing accuracy.</p>
<p>imodels works like scikit-learn models, making it easy to integrate into existing workflows.</p>
<p>Hereâ€™s an example of fitting an interpretable decision tree to predict juvenile delinquency:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">imodels</span> <span class="kn">import</span> <span class="n">get_clean_dataset</span><span class="p">,</span> <span class="n">HSTreeClassifierCV</span> 

<span class="c1"># Prepare data</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">feature_names</span> <span class="o">=</span> <span class="n">get_clean_dataset</span><span class="p">(</span><span class="s1">&#39;juvenile&#39;</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Initialize a tree model and specify only 4 leaf nodes</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">HSTreeClassifierCV</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_names</span><span class="p">)</span>  

<span class="c1"># Make predictions</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span> 

<span class="c1"># Print the model</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fetching juvenile_clean from imodels
&gt; ------------------------------
&gt; Decision Tree with Hierarchical Shrinkage
&gt; 	Prediction is made by looking at the value in the appropriate leaf of the tree
&gt; ------------------------------
|--- friends_broken_in_steal:1 &lt;= 0.50
|   |--- physically_ass:0 &lt;= 0.50
|   |   |--- weights: [0.71, 0.29] class: 0.0
|   |--- physically_ass:0 &gt;  0.50
|   |   |--- weights: [0.95, 0.05] class: 0.0
|--- friends_broken_in_steal:1 &gt;  0.50
|   |--- non-exp_past_year_marijuana:0 &lt;= 0.50
|   |   |--- weights: [0.33, 0.67] class: 1.0
|   |--- non-exp_past_year_marijuana:0 &gt;  0.50
|   |   |--- weights: [0.60, 0.40] class: 0.0
</pre></div>
</div>
</div>
</div>
<p>This tree structure clearly shows how predictions are made based on feature values, providing transparency into the modelâ€™s decision-making process. The hierarchical shrinkage technique also improves predictive performance compared to standard decision trees.</p>
<p><a class="reference external" href="https://github.com/csinva/imodels">Link to imodels</a>.</p>
</section>
<section id="how-to-build-a-recommendation-engine-using-surprise-in-python">
<h2><span class="section-number">6.5.20. </span>How to Build a Recommendation Engine Using Surprise in Python<a class="headerlink" href="#how-to-build-a-recommendation-engine-using-surprise-in-python" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>scikit-surprise
</pre></div>
</div>
</div>
</details>
</div>
<p>Building reliable recommendation systems from scratch requires complex algorithms and data handling, which results in spending significant time implementing common algorithms like SVD or handling cross-validation procedures.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Without a dedicated library, you&#39;d need to implement basic collaborative filtering:</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">calculate_similarity</span><span class="p">(</span><span class="n">ratings_matrix</span><span class="p">):</span>
    <span class="c1"># Complex similarity calculations</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">predict_rating</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">ratings</span><span class="p">,</span> <span class="n">similarities</span><span class="p">):</span>
    <span class="c1"># Complex prediction logic</span>
    <span class="k">pass</span>

<span class="c1"># Handle cross-validation manually</span>
<span class="k">def</span> <span class="nf">cross_validate</span><span class="p">(</span><span class="n">ratings_data</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">):</span>
    <span class="c1"># Manual implementation of CV</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>Surprise helps you build and evaluate recommendation systems with just a few lines of code. You can use built-in algorithms, handle datasets easily, and evaluate models using cross-validation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">surprise</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">SVD</span><span class="p">,</span> <span class="n">Reader</span>
<span class="kn">from</span> <span class="nn">surprise.model_selection</span> <span class="kn">import</span> <span class="n">cross_validate</span>


<span class="c1"># Creation of the dataframe. Column names are irrelevant.</span>
<span class="n">ratings_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;itemID&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="s2">&quot;userID&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="s2">&quot;rating&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">ratings_dict</span><span class="p">)</span>
 
<span class="c1"># A reader is still needed but only the rating_scale param is required.</span>
<span class="n">reader</span> <span class="o">=</span> <span class="n">Reader</span><span class="p">(</span><span class="n">rating_scale</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># The columns must correspond to user id, item id and ratings (in that order).</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">Dataset</span><span class="o">.</span><span class="n">load_from_df</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s2">&quot;userID&quot;</span><span class="p">,</span> <span class="s2">&quot;itemID&quot;</span><span class="p">,</span> <span class="s2">&quot;rating&quot;</span><span class="p">]],</span> <span class="n">reader</span><span class="p">)</span>

<span class="n">algo</span> <span class="o">=</span> <span class="n">SVD</span><span class="p">()</span>

<span class="c1"># Run 2-fold cross-validation and print results.</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">cross_validate</span><span class="p">(</span><span class="n">algo</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">measures</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">,</span> <span class="s1">&#39;MAE&#39;</span><span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Evaluating RMSE, MAE of algorithm SVD on 2 split(s).

                  Fold 1  Fold 2  Mean    Std     
RMSE (testset)    1.2706  1.4050  1.3378  0.0672  
MAE (testset)     1.0295  0.9963  1.0129  0.0166  
Fit time          0.00    0.00    0.00    0.00    
Test time         0.00    0.00    0.00    0.00    
</pre></div>
</div>
</div>
</div>
<p>Compute the rating prediction for given user and item.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">item_id</span> <span class="o">=</span> <span class="mi">302</span>
<span class="n">user_id</span> <span class="o">=</span> <span class="mi">196</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">algo</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>user: 196        item: 302        r_ui = None   est = 3.00   {&#39;was_impossible&#39;: False}
</pre></div>
</div>
</div>
</div>
<p>Surprise also provides a variety of basic algorithms, k-NN inspired algorithms, and matrix factorization-based algorithms. View all available algorithms <a class="reference external" href="https://surprise.readthedocs.io/en/stable/prediction_algorithms_package.html">here</a>.</p>
<p><a class="reference external" href="https://github.com/NicolasHug/Surprise">Link to Surprise</a>.</p>
</section>
<section id="pyod-simplifying-outlier-detection-in-python">
<h2><span class="section-number">6.5.21. </span>PyOD: Simplifying Outlier Detection in Python<a class="headerlink" href="#pyod-simplifying-outlier-detection-in-python" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pyod
</pre></div>
</div>
</div>
</details>
</div>
<p>Detecting anomalies or outliers in datasets is often challenging and time-consuming, requiring complex statistical calculations and multiple algorithm implementations. This results in data scientists writing redundant code or potentially missing important anomalies by using overly simplistic approaches.</p>
<p>Without specialized tools, detecting outliers often looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">def</span> <span class="nf">detect_outliers</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="c1"># Using simple statistical method (z-score)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mean</span><span class="si">=:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">std</span><span class="si">=:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">z_scores</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    
    <span class="c1"># Consider points beyond 3 standard deviations as outliers</span>
    <span class="n">outliers</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">z_scores</span><span class="p">)</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">outliers</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">detect_outliers</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">outliers</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mean=113.333
std=313.485
outliers=[]
</pre></div>
</div>
</div>
</div>
<p>In this example, even though 1000 is apear to be an outlier in the <code class="docutils literal notranslate"><span class="pre">data</span></code> list, it is not in the <code class="docutils literal notranslate"><span class="pre">outliers</span></code> list. This is because the standard deviation is heavily influenced by the extreme value (1000).</p>
<p>With PyOD, you can easily implement various state-of-the-art outlier detection algorithms, combine multiple methods, and handle multivariate data. The library provides a consistent API across different algorithms and includes both traditional statistical methods and modern deep learning approaches.</p>
<p>Import models:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyod.models.knn</span> <span class="kn">import</span> <span class="n">KNN</span>
<span class="kn">from</span> <span class="nn">pyod.utils.data</span> <span class="kn">import</span> <span class="n">generate_data</span>
<span class="kn">from</span> <span class="nn">pyod.utils.data</span> <span class="kn">import</span> <span class="n">evaluate_print</span>
<span class="kn">from</span> <span class="nn">pyod.utils.example</span> <span class="kn">import</span> <span class="n">visualize</span>
</pre></div>
</div>
</div>
</div>
<p>Generate sample data:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">contamination</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># percentage of outliers</span>
<span class="n">n_train</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># number of training points</span>
<span class="n">n_test</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># number of testing points</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">generate_data</span><span class="p">(</span>
    <span class="n">n_train</span><span class="o">=</span><span class="n">n_train</span><span class="p">,</span> <span class="n">n_test</span><span class="o">=</span><span class="n">n_test</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="n">contamination</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Initialize a <code class="docutils literal notranslate"><span class="pre">pyod.models.knn.KNN</span></code> detector, fit the model, and make the prediction:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># train kNN detector</span>
<span class="n">clf</span> <span class="o">=</span> <span class="n">KNN</span><span class="p">()</span>
<span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="c1"># get the prediction labels and outlier scores of the training data</span>
<span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">labels_</span>  <span class="c1"># binary labels (0: inliers, 1: outliers)</span>
<span class="n">y_train_scores</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">decision_scores_</span>  <span class="c1"># raw outlier scores</span>

<span class="c1"># get the prediction on the test data</span>
<span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>  <span class="c1"># outlier labels (0 or 1)</span>
<span class="n">y_test_scores</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>  <span class="c1"># outlier scores</span>
</pre></div>
</div>
</div>
</div>
<p>Evaluate the prediction using ROC and Precision &#64; Rank n:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clf_name</span> <span class="o">=</span> <span class="s1">&#39;KNN&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">On Training Data:&quot;</span><span class="p">)</span>
<span class="n">evaluate_print</span><span class="p">(</span><span class="n">clf_name</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_train_scores</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">On Test Data:&quot;</span><span class="p">)</span>
<span class="n">evaluate_print</span><span class="p">(</span><span class="n">clf_name</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_scores</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>On Training Data:
KNN ROC:1.0, precision @ rank n:1.0

On Test Data:
KNN ROC:1.0, precision @ rank n:1.0
</pre></div>
</div>
</div>
</div>
<p>Generate the visualizations by visualize function included in all examples:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualize</span><span class="p">(</span><span class="n">clf_name</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span>
          <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">visualize</span><span class="p">(</span><span class="n">clf_name</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span>
          <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">show_figure</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save_figure</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f7a67f619b859e2ab823d812b385d7835edd56b61e2a9092454ea1601de7d518.png" src="../_images/f7a67f619b859e2ab823d812b385d7835edd56b61e2a9092454ea1601de7d518.png" />
</div>
</div>
<p><a class="reference external" href="https://github.com/yzhao062/pyod">Link to pyod</a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapter5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="manage_data.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">6.4. </span>Manage Data</p>
      </div>
    </a>
    <a class="right-next"
       href="natural_language_processing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">6.6. </span>Natural Language Processing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#scikit-llm-supercharge-text-analysis-with-chatgpt-and-scikit-learn-integration">6.5.1. Scikit-LLM: Supercharge Text Analysis with ChatGPT and scikit-learn Integration</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-a-readable-machine-learning-pipeline-in-one-line-of-code">6.5.2. Create a Readable Machine Learning Pipeline in One Line of Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline-gridsearchcv-prevent-data-leakage-when-scaling-the-data">6.5.3. Pipeline + GridSearchCV: Prevent Data Leakage when Scaling the Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#squared-false-get-rmse-from-sklearns-mean-squared-error-method">6.5.4. squared=False: Get RMSE from Sklearnâ€™s mean_squared_error method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelkit-build-production-ml-systems-in-python">6.5.5. modelkit: Build Production ML Systems in Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#decomposing-high-dimensional-data-into-two-or-three-dimensions">6.5.6. Decomposing High-Dimensional Data into Two or Three Dimensions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-feature-importances-with-yellowbrick">6.5.7. Visualize Feature Importances with Yellowbrick</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#validation-curve-determine-if-an-estimator-is-underfitting-over-overfitting">6.5.8. Validation Curve: Determine if an Estimator Is Underfitting Over Overfitting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlxtend-plot-decision-regions-of-your-ml-classifiers">6.5.9. Mlxtend: Plot Decision Regions of Your ML Classifiers</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imbalanced-learn-deal-with-an-imbalanced-dataset">6.5.10. imbalanced-learn: Deal with an Imbalanced Dataset</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimate-prediction-intervals-in-scikit-learn-models-with-mapie">6.5.11. Estimate Prediction Intervals in Scikit-Learn Models with MAPIE</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlforecast-scalable-machine-learning-for-time-series">6.5.12. mlforecast: Scalable Machine Learning for Time Series</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mlem-capture-your-machine-learning-model-s-metadata">6.5.13. MLEM: Capture Your Machine Learning Modelâ€™s Metadata</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distributed-machine-learning-with-mllib">6.5.14. Distributed Machine Learning with MLlib</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#rapid-prototyping-and-comparison-of-basic-models-with-lazy-predict">6.5.15. Rapid Prototyping and Comparison of Basic Models with Lazy Predict</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#autogluon-fast-and-accurate-ml-in-3-lines-of-code">6.5.16. AutoGluon: Fast and Accurate ML in 3 Lines of Code</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-logging-made-easy-mlflow-vs-pickle">6.5.17. Model Logging Made Easy: MLflow vs. Pickle</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simplifying-ml-model-integration-with-fastapi">6.5.18. Simplifying ML Model Integration with FastAPI</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imodels-simplifying-machine-learning-with-interpretable-models">6.5.19. imodels: Simplifying Machine Learning with Interpretable Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-build-a-recommendation-engine-using-surprise-in-python">6.5.20. How to Build a Recommendation Engine Using Surprise in Python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pyod-simplifying-outlier-detection-in-python">6.5.21. PyOD: Simplifying Outlier Detection in Python</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Khuyen Tran
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=c5ced968eda925caa686"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=c5ced968eda925caa686"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>