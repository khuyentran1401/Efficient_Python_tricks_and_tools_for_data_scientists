
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>6.13. Testing &#8212; Effective Python for Data Scientists</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "üí¨ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Cool Tools" href="../Chapter6/Chapter6.html" />
    <link rel="prev" title="6.12. Better Pandas" href="better_pandas.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/data_simplified_icon.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Effective Python for Data Scientists</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   Efficient Python Tricks and Tools for Data Scientists
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../how_to_read.html">
   1. How to Read This Book
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter1/Chapter1.html">
   2. Python Built-in Methods
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/string.html">
     2.1. String
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/number.html">
     2.2. Number
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../Chapter1/list/list.html">
     2.3. List
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/get_elements.html">
       2.3.1. Get Elements
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/unpack_iterables.html">
       2.3.2. Unpack Iterables
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/join_iterable.html">
       2.3.3. Join Iterables
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/interaction_between_2_lists.html">
       2.3.4. Interaction Between 2 Lists
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../Chapter1/list/apply_functions_to_elements.html">
       2.3.5. Apply Functions to Elements in a List
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/tuple.html">
     2.4. Tuple
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/dictionary.html">
     2.5. Dictionary
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/function.html">
     2.6. Function
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/class.html">
     2.7. Classes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/datetime.html">
     2.8. Datetime
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/code_speed.html">
     2.9. Code Speed
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter1/good_practices.html">
     2.10. Good Python Practices
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter2/Chapter2.html">
   3. Python Utility Libraries
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/collections.html">
     3.1. Collections
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/itertools.html">
     3.2. Itertools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/functools.html">
     3.3. Functools
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/pydash.html">
     3.4. Pydash
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/operator.html">
     3.5. Operator
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/dataclasses.html">
     3.6. Data Classes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/typing.html">
     3.7. Typing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter2/pathlib.html">
     3.8. pathlib
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter3/Chapter3.html">
   4. Pandas
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/change_values.html">
     4.1. Change Values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/get_values.html">
     4.2. Get Certain Values From a DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/date_time.html">
     4.3. Work with Datetime
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/create_dataframe.html">
     4.4. Create a New DataFrame Using Existing DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/combine_dataframes.html">
     4.5. Combine Multiple DataFrames
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/filter.html">
     4.6. Filter Rows or Columns
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/data_types.html">
     4.7. Manipulate a DataFrame Using Data Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/sort_dataframe.html">
     4.8. Sort Rows or Columns of a DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/string.html">
     4.9. Work with String
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/style_dataframe.html">
     4.10. Style a DataFrame
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter3/testing.html">
     4.11. Test
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter4/Chapter4.html">
   5. NumPy
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter4/Numpy.html">
     5.1. NumPy
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Chapter5.html">
   6. Data Science Tools
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="feature_extraction.html">
     6.1. Feature Extraction
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="feature_engineer.html">
     6.2. Feature Engineer
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="get_data.html">
     6.3. Get Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="manage_data.html">
     6.4. Manage Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="machine_learning.html">
     6.5. Machine Learning
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="natural_language_processing.html">
     6.6. Natural Language Processing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="time_series.html">
     6.7. Time Series
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="sharing_downloading.html">
     6.8. Sharing and Downloading
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="speed_up_code.html">
     6.9. Tools to Speed Up Code
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="visualization.html">
     6.10. Visualization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="best_python_practice_tools.html">
     6.11. Tools for Best Python Practices
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="better_pandas.html">
     6.12. Better Pandas
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     6.13. Testing
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter6/Chapter6.html">
   7. Cool Tools
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter6/alternative_approach.html">
     7.1. Alternative Approach
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter6/workflow_automation.html">
     7.2. Workflow Automation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter6/code_review.html">
     7.3. Code Review
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter6/logging_debugging.html">
     7.4. Logging and Debugging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter6/better_outputs.html">
     7.5. Better Outputs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter6/git_github.html">
     7.6. Git and GitHub
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter6/env_management.html">
     7.7. Environment Management
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter7/Chapter7.html">
   8. Jupyter Notebook
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter7/jupyter_notebook.html">
     8.1. Jupyter Notebook
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Chapter8/Chapter8.html">
   9. Insights From Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter8/data_science_market.html">
     9.1. Analyze Data Science Market
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Chapter8/programming.html">
     9.2. Programming Languages by Age
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Chapter5/testing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/issues/new?title=Issue%20on%20page%20%2FChapter5/testing.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/master?urlpath=tree/./Chapter5/testing.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/khuyentran1401/Efficient_Python_tricks_and_tools_for_data_scientists/blob/master/./Chapter5/testing.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-benchmark-a-pytest-fixture-to-benchmark-your-code">
   6.13.1. pytest benchmark: A Pytest Fixture to Benchmark Your Code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-mark-parametrize-test-your-functions-with-multiple-inputs">
   6.13.2. pytest.mark.parametrize: Test Your Functions with Multiple Inputs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-parametrize-twice-test-all-possible-combinations-of-two-sets-of-parameters">
   6.13.3. pytest parametrize twice: Test All Possible Combinations of Two Sets of Parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assign-ids-to-test-cases">
   6.13.4. Assign IDs to Test Cases
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-fixtures-use-the-same-data-for-different-tests">
   6.13.5. Pytest Fixtures: Use The Same Data for Different Tests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-repeat">
   6.13.6. Pytest repeat
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-sugar-show-the-failures-and-errors-instantly-with-a-progress-bar">
   6.13.7. pytest-sugar: Show the Failures and Errors Instantly With a Progress Bar
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-steps-share-data-between-tests">
   6.13.8. pytest-steps: Share Data Between Tests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pandera-a-python-library-to-validate-your-pandas-dataframe">
   6.13.9. Pandera: a Python Library to Validate Your Pandas DataFrame
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deepdiff-find-deep-differences-of-python-objects">
   6.13.10. DeepDiff Find Deep Differences of Python Objects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hypothesis-property-based-testing-in-python">
   6.13.11. hypothesis: Property-based Testing in Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deepchecks-check-category-mismatch-between-train-and-test-set">
   6.13.12. Deepchecks: Check Category Mismatch Between Train and Test Set
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Testing</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-benchmark-a-pytest-fixture-to-benchmark-your-code">
   6.13.1. pytest benchmark: A Pytest Fixture to Benchmark Your Code
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-mark-parametrize-test-your-functions-with-multiple-inputs">
   6.13.2. pytest.mark.parametrize: Test Your Functions with Multiple Inputs
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-parametrize-twice-test-all-possible-combinations-of-two-sets-of-parameters">
   6.13.3. pytest parametrize twice: Test All Possible Combinations of Two Sets of Parameters
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assign-ids-to-test-cases">
   6.13.4. Assign IDs to Test Cases
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-fixtures-use-the-same-data-for-different-tests">
   6.13.5. Pytest Fixtures: Use The Same Data for Different Tests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-repeat">
   6.13.6. Pytest repeat
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-sugar-show-the-failures-and-errors-instantly-with-a-progress-bar">
   6.13.7. pytest-sugar: Show the Failures and Errors Instantly With a Progress Bar
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pytest-steps-share-data-between-tests">
   6.13.8. pytest-steps: Share Data Between Tests
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pandera-a-python-library-to-validate-your-pandas-dataframe">
   6.13.9. Pandera: a Python Library to Validate Your Pandas DataFrame
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deepdiff-find-deep-differences-of-python-objects">
   6.13.10. DeepDiff Find Deep Differences of Python Objects
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hypothesis-property-based-testing-in-python">
   6.13.11. hypothesis: Property-based Testing in Python
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deepchecks-check-category-mismatch-between-train-and-test-set">
   6.13.12. Deepchecks: Check Category Mismatch Between Train and Test Set
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="testing">
<h1><span class="section-number">6.13. </span>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¬∂</a></h1>
<div class="section" id="pytest-benchmark-a-pytest-fixture-to-benchmark-your-code">
<h2><span class="section-number">6.13.1. </span>pytest benchmark: A Pytest Fixture to Benchmark Your Code<a class="headerlink" href="#pytest-benchmark-a-pytest-fixture-to-benchmark-your-code" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest-benchmark
</pre></div>
</div>
</div>
</div>
<p>If you want to benchmark your code while testing with pytest, try pytest-benchmark.</p>
<p>To use pytest-benchmark works, add <code class="docutils literal notranslate"><span class="pre">benchmark</span></code> to the test function that you want to benchmark.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_benchmark_example.py</span>
<span class="k">def</span> <span class="nf">list_comprehension</span><span class="p">(</span><span class="n">len_list</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_list</span><span class="p">)]</span>


<span class="k">def</span> <span class="nf">test_concat</span><span class="p">(</span><span class="n">benchmark</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">benchmark</span><span class="p">(</span><span class="n">list_comprehension</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span> <span class="o">==</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
</pre></div>
</div>
<p>On your terminal, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest pytest_benchmark_example.py
</pre></div>
</div>
<p>Now you should see the statistics of the time it takes to execute the test functions on your terminal:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-0.13.1
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter4
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0
collected 1 item                                                               

pytest_benchmark_example.py <span class=" -Color -Color-Green">.                                            [100%]</span>


<span class=" -Color -Color-Yellow">----------------------------------------------------- benchmark: 1 tests ----------------------------------------------------</span>
Name (time in ns)          Min         Max      Mean    StdDev    Median     IQR   Outliers  OPS (Mops/s)  Rounds  Iterations
<span class=" -Color -Color-Yellow">-----------------------------------------------------------------------------------------------------------------------------</span>
test_concat         <span class=" -Color -Color-Bold">  286.4501  4,745.5498  309.3872  106.6583  297.5001  5.3500</span>  2686;5843<span class=" -Color -Color-Bold">        3.2322</span>  162101          20
<span class=" -Color -Color-Yellow">-----------------------------------------------------------------------------------------------------------------------------</span>

Legend:
  Outliers: 1 Standard Deviation from Mean; 1.5 IQR (InterQuartile Range) from 1st Quartile and 3rd Quartile.
  OPS: Operations Per Second, computed as 1 / Mean
<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span><span class=" -Color -Color-Green"> in 2.47s ===============================</span>
</pre></div>
</div>
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 42;
                var nbb_unformatted_code = "!pytest pytest_benchmark_example.py ";
                var nbb_formatted_code = "!pytest pytest_benchmark_example.py";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p><a class="reference external" href="https://github.com/ionelmc/pytest-benchmark">Link to pytest-benchmark</a>.</p>
</div>
<div class="section" id="pytest-mark-parametrize-test-your-functions-with-multiple-inputs">
<h2><span class="section-number">6.13.2. </span>pytest.mark.parametrize: Test Your Functions with Multiple Inputs<a class="headerlink" href="#pytest-mark-parametrize-test-your-functions-with-multiple-inputs" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest 
</pre></div>
</div>
</div>
</div>
<p>If you want to test your function with different examples, use <code class="docutils literal notranslate"><span class="pre">pytest.mark.parametrize</span></code> decorator.</p>
<p>To use <code class="docutils literal notranslate"><span class="pre">pytest.mark.parametrize</span></code>, add <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.parametrize</span></code> to the test function that you want to experiment with.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_parametrize.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="k">def</span> <span class="nf">text_contain_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Find whether the text contains a particular word&#39;&#39;&#39;</span>
    
    <span class="k">return</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">text</span>

<span class="n">test</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;There is a duck in this text&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;There is nothing here&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="p">]</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s1">&#39;sample, expected&#39;</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_text_contain_word</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>

    <span class="n">word</span> <span class="o">=</span> <span class="s1">&#39;duck&#39;</span>

    <span class="k">assert</span> <span class="n">text_contain_word</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">sample</span><span class="p">)</span> <span class="o">==</span> <span class="n">expected</span>
</pre></div>
</div>
<p>In the code above, I expect the first sentence to contain the word ‚Äúduck‚Äù and expect the second sentence not to contain that word. Let‚Äôs see if my expectations are correct by running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest pytest_parametrize.py
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter4
plugins: benchmark-3.4.1, anyio-3.3.0
<span class=" -Color -Color-Bold">collecting ... </span>
<span class=" -Color -Color-Bold">collected 2 items                                                              </span>

pytest_parametrize.py <span class=" -Color -Color-Green">..                                                 [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">2 passed</span><span class=" -Color -Color-Green"> in 0.01s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>Sweet! 2 tests passed when running pytest.</p>
<p><a class="reference external" href="https://towardsdatascience.com/pytest-for-data-scientists-2990319e55e6?sk=2d3a81903b154db0c7ca832b9f29fee8">Link to my article about pytest</a>.</p>
</div>
<div class="section" id="pytest-parametrize-twice-test-all-possible-combinations-of-two-sets-of-parameters">
<h2><span class="section-number">6.13.3. </span>pytest parametrize twice: Test All Possible Combinations of Two Sets of Parameters<a class="headerlink" href="#pytest-parametrize-twice-test-all-possible-combinations-of-two-sets-of-parameters" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest 
</pre></div>
</div>
</div>
</div>
<p>If you want to test the combinations of two sets of parameters, writing all possible combinations can be time-consuming and is difficult to read.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pytest</span>

<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">perc_difference</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n2</span> <span class="o">-</span> <span class="n">n1</span><span class="p">)</span><span class="o">/</span><span class="n">n1</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Test the combinations of operations and inputs</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;operation, n1, n2&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="n">average</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">average</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="n">perc_difference</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">perc_difference</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">test_is_float</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
<p>You can save your time by using <code class="docutils literal notranslate"><span class="pre">pytest.mark.parametrize</span></code> twice instead.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_combination.py</span>
<span class="kn">import</span> <span class="nn">pytest</span>

<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="k">def</span> <span class="nf">perc_difference</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n2</span> <span class="o">-</span> <span class="n">n1</span><span class="p">)</span><span class="o">/</span><span class="n">n1</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Test the combinations of operations and inputs</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;operation&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">average</span><span class="p">,</span> <span class="n">perc_difference</span><span class="p">])</span>
<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span><span class="s2">&quot;n1, n2&quot;</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
<span class="k">def</span> <span class="nf">test_is_float</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operation</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
<p>On your terminal, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest -v pytest_combination.py
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-0.13.1 -- /home/khuyen/book/venv/bin/python3
cachedir: .pytest_cache
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
hypothesis profile &#39;default&#39; -&gt; database=DirectoryBasedExampleDatabase(&#39;/home/khuyen/book/book/Chapter5/.hypothesis/examples&#39;)
rootdir: /home/khuyen/book/book/Chapter5
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0, hypothesis-6.31.6, typeguard-2.13.3
collected 4 items                                                              

pytest_combination.py::test_is_float[1-2-average] <span class=" -Color -Color-Green">PASSED                 [ 25%]</span>
pytest_combination.py::test_is_float[1-2-perc_difference] <span class=" -Color -Color-Green">PASSED         [ 50%]</span>
pytest_combination.py::test_is_float[2-3-average] <span class=" -Color -Color-Green">PASSED                 [ 75%]</span>
pytest_combination.py::test_is_float[2-3-perc_difference] <span class=" -Color -Color-Green">PASSED         [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">4 passed</span><span class=" -Color -Color-Green"> in 0.27s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>From the output above, we can see that all possible combinations of the given operations and inputs are tested.</p>
</div>
<div class="section" id="assign-ids-to-test-cases">
<h2><span class="section-number">6.13.4. </span>Assign IDs to Test Cases<a class="headerlink" href="#assign-ids-to-test-cases" title="Permalink to this headline">¬∂</a></h2>
<p>When using pytest parametrize, it can be difficult to understand the role of each test case.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_without_ids.py</span>

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">mark</span>


<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="nd">@mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;n1, n2&quot;</span><span class="p">,</span>
    <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_is_float</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">average</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest -v pytest_without_ids.py 
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-0.13.1 -- /home/khuyen/book/venv/bin/python3
cachedir: .pytest_cache
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
hypothesis profile &#39;default&#39; -&gt; database=DirectoryBasedExampleDatabase(&#39;/home/khuyen/book/book/Chapter5/.hypothesis/examples&#39;)
rootdir: /home/khuyen/book/book/Chapter5
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0, hypothesis-6.31.6, cases-3.6.10, typeguard-2.13.3
collected 3 items                                                              

pytest_without_ids.py::test_is_float[-1--2] <span class=" -Color -Color-Green">PASSED                       [ 33%]</span>
pytest_without_ids.py::test_is_float[2-3] <span class=" -Color -Color-Green">PASSED                         [ 66%]</span>
pytest_without_ids.py::test_is_float[0-0] <span class=" -Color -Color-Green">PASSED                         [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">3 passed</span><span class=" -Color -Color-Green"> in 0.26s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>You can add <code class="docutils literal notranslate"><span class="pre">ids</span></code> to pytest parametrize to assign a name to each test case.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_ids.py</span>

<span class="kn">from</span> <span class="nn">pytest</span> <span class="kn">import</span> <span class="n">mark</span>

<span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="nd">@mark</span><span class="o">.</span><span class="n">parametrize</span><span class="p">(</span>
    <span class="s2">&quot;n1, n2&quot;</span><span class="p">,</span>
    <span class="p">[(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
    <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;neg and neg&quot;</span><span class="p">,</span> <span class="s2">&quot;pos and pos&quot;</span><span class="p">,</span> <span class="s2">&quot;zero and zero&quot;</span><span class="p">],</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">test_is_float</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">average</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest -v pytest_ids.py 
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-0.13.1 -- /home/khuyen/book/venv/bin/python3
cachedir: .pytest_cache
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
hypothesis profile &#39;default&#39; -&gt; database=DirectoryBasedExampleDatabase(&#39;/home/khuyen/book/book/Chapter5/.hypothesis/examples&#39;)
rootdir: /home/khuyen/book/book/Chapter5
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0, hypothesis-6.31.6, cases-3.6.10, typeguard-2.13.3
collected 3 items                                                              

pytest_ids.py::test_is_float[neg and neg] <span class=" -Color -Color-Green">PASSED                         [ 33%]</span>
pytest_ids.py::test_is_float[pos and pos] <span class=" -Color -Color-Green">PASSED                         [ 66%]</span>
pytest_ids.py::test_is_float[zero and zero] <span class=" -Color -Color-Green">PASSED                       [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">3 passed</span><span class=" -Color -Color-Green"> in 0.27s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p>We can see that instead of <code class="docutils literal notranslate"><span class="pre">[-1--2]</span></code>, the first test case is shown as <code class="docutils literal notranslate"><span class="pre">neg</span> <span class="pre">and</span> <span class="pre">neg</span></code>. This makes it easier for others to understand the roles of your test cases.</p>
</div>
<div class="section" id="pytest-fixtures-use-the-same-data-for-different-tests">
<h2><span class="section-number">6.13.5. </span>Pytest Fixtures: Use The Same Data for Different Tests<a class="headerlink" href="#pytest-fixtures-use-the-same-data-for-different-tests" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest 
</pre></div>
</div>
</div>
</div>
<p>If you want to use the same data to test different functions, use pytest fixtures.</p>
<p>To use pytest fixtures,  add the decorator <code class="docutils literal notranslate"><span class="pre">&#64;pytest.fixture</span></code> to the function that creates the data you want to reuse.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_fixture.py</span>
<span class="kn">import</span> <span class="nn">pytest</span> 
<span class="kn">from</span> <span class="nn">textblob</span> <span class="kn">import</span> <span class="n">TextBlob</span>

<span class="k">def</span> <span class="nf">extract_sentiment</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract sentimetn using textblob. Polarity is within range [-1, 1]&quot;&quot;&quot;</span>
    
    <span class="n">text</span> <span class="o">=</span> <span class="n">TextBlob</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">sentiment</span><span class="o">.</span><span class="n">polarity</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span> 
<span class="k">def</span> <span class="nf">example_data</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Today I found a duck and I am happy&#39;</span>

<span class="k">def</span> <span class="nf">test_extract_sentiment</span><span class="p">(</span><span class="n">example_data</span><span class="p">):</span>
    <span class="n">sentiment</span> <span class="o">=</span> <span class="n">extract_sentiment</span><span class="p">(</span><span class="n">example_data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">sentiment</span> <span class="o">&gt;</span> <span class="mi">0</span>
</pre></div>
</div>
<p>On your terminal, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest pytest_fixture.py
</pre></div>
</div>
<p>Output:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter4
plugins: benchmark-3.4.1, anyio-3.3.0
collected 1 item                                                               

pytest_fixture.py <span class=" -Color -Color-Green">.                                                      [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">1 passed</span><span class=" -Color -Color-Green"> in 0.53s ===============================</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="pytest-repeat">
<h2><span class="section-number">6.13.6. </span>Pytest repeat<a class="headerlink" href="#pytest-repeat" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest-repeat
</pre></div>
</div>
</div>
</div>
<p>It is a good practice to test your functions to make sure they work as expected, but sometimes you need to test 100 times until you found the rare cases when the test fails. That is when pytest-repeat comes in handy.</p>
<p>To use pytest-repeat, add the decorator <code class="docutils literal notranslate"><span class="pre">&#64;pytest.mark.repeat(N)</span></code> to the test function you want to repeat <code class="docutils literal notranslate"><span class="pre">N</span></code> times</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_repeat_example.py</span>
<span class="kn">import</span> <span class="nn">pytest</span> 
<span class="kn">import</span> <span class="nn">random</span> 

<span class="k">def</span> <span class="nf">generate_numbers</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_generate_numbers</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">generate_numbers</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">generate_numbers</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">100</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># pytest_repeat_example.py</span>
<span class="kn">import</span> <span class="nn">pytest</span> 
<span class="kn">import</span> <span class="nn">random</span> 

<span class="k">def</span> <span class="nf">generate_numbers</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_generate_numbers</span><span class="p">():</span>
    <span class="k">assert</span> <span class="n">generate_numbers</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">generate_numbers</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">100</span>
</pre></div>
</div>
<p>On your terminal, type:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pytest pytest_repeat_example.py
</pre></div>
</div>
<p>We can see that 100 experiments are executed and passed:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform linux -- Python 3.8.10, pytest-6.2.5, py-1.10.0, pluggy-1.0.0
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter4
plugins: benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0
collected 100 items                                                            

pytest_repeat_example.py <span class=" -Color -Color-Green">............................................... [ 47%]</span>
<span class=" -Color -Color-Green">.....................................................                    [100%]</span>

<span class=" -Color -Color-Green">============================= </span><span class=" -Color -Color-Bold -Color-Bold-Green">100 passed</span><span class=" -Color -Color-Green"> in 0.07s ==============================</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/pytest-dev/pytest-repeat">Link to pytest-repeat</a></p>
</div>
<div class="section" id="pytest-sugar-show-the-failures-and-errors-instantly-with-a-progress-bar">
<h2><span class="section-number">6.13.7. </span>pytest-sugar: Show the Failures and Errors Instantly With a Progress Bar<a class="headerlink" href="#pytest-sugar-show-the-failures-and-errors-instantly-with-a-progress-bar" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pytest-sugar 
</pre></div>
</div>
</div>
</div>
<p>It can be frustrating to wait for a lot of tests to run before knowing the status of the tests. If you want to see the failures and errors instantly with a progress bar, use pytest-sugar.</p>
<p>pytest-sugar is a plugin for pytest. The code below shows how the outputs will look like when running pytest.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.10, pytest 6.2.5, pytest-sugar 0.9.4)</span>
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter5
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0, sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>
 <span class=" -Color -Color-Cyan">pytest_sugar_example/</span>test_benchmark_example.py <span class=" -Color -Color-Green">‚úì</span>                  <span class=" -Color -Color-Green">1% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">‚ñè         </span>
 <span class=" -Color -Color-Cyan">pytest_sugar_example/</span>test_fixture.py <span class=" -Color -Color-Green">‚úì</span>                            <span class=" -Color -Color-Green">2% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">‚ñé         </span>
 <span class=" -Color -Color-Cyan">pytest_sugar_example/</span>test_parametrize.py <span class=" -Color -Color-Green">‚úì‚úì</span>                       <span class=" -Color -Color-Green">4% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">‚ñç         </span>
 <span class=" -Color -Color-Cyan">pytest_sugar_example/</span>test_repeat_example.py <span class=" -Color -Color-Green">‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì</span> <span class=" -Color -Color-Green">23% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">‚ñà‚ñà‚ñç       </span>
                                             <span class=" -Color -Color-Green">‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì</span> <span class=" -Color -Color-Green">42% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">‚ñà‚ñà‚ñà‚ñà‚ñé     </span>
                                             <span class=" -Color -Color-Green">‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì</span> <span class=" -Color -Color-Green">62% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñé   </span>
                                             <span class=" -Color -Color-Green">‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì</span> <span class=" -Color -Color-Green">81% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñè </span>
                                             <span class=" -Color -Color-Green">‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì‚úì100% </span><span class=" -Color -Color-Green -Color-Green-BGBlack">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span>

<span class=" -Color -Color-Yellow">---------------------------------------------------- benchmark: 1 tests ---------------------------------------------------</span>
Name (time in ns)          Min         Max      Mean   StdDev    Median     IQR  Outliers  OPS (Mops/s)  Rounds  Iterations
<span class=" -Color -Color-Yellow">---------------------------------------------------------------------------------------------------------------------------</span>
test_concat         <span class=" -Color -Color-Bold">  302.8003  3,012.5000  328.2844  97.9087  321.5999  8.2495</span>  866;2220<span class=" -Color -Color-Bold">        3.0461</span>   90868          20
<span class=" -Color -Color-Yellow">---------------------------------------------------------------------------------------------------------------------------</span>

Legend:
  Outliers: 1 Standard Deviation from Mean; 1.5 IQR (InterQuartile Range) from 1st Quartile and 3rd Quartile.
  OPS: Operations Per Second, computed as 1 / Mean

Results (2.63s):
<span class=" -Color -Color-Green">     104 passed</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://github.com/Teemu/pytest-sugar">Link to pytest-sugar</a>.</p>
</div>
<div class="section" id="pytest-steps-share-data-between-tests">
<h2><span class="section-number">6.13.8. </span>pytest-steps: Share Data Between Tests<a class="headerlink" href="#pytest-steps-share-data-between-tests" title="Permalink to this headline">¬∂</a></h2>
<p>Have you ever wanted to use the result of one test for another test? That is when pytest_steps comes in handy.</p>
<p><img alt="" src="../_images/pytest_steps.png" /></p>
<p>In the code below, I use the result of <code class="docutils literal notranslate"><span class="pre">sum_test</span></code> as the input of <code class="docutils literal notranslate"><span class="pre">average_2_nums</span></code>. The argument <code class="docutils literal notranslate"><span class="pre">steps_data</span></code> allows me to share the data between 2 tests.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pytest_steps</span> <span class="kn">import</span> <span class="n">test_steps</span>


<span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span>


<span class="k">def</span> <span class="nf">average_2_nums</span><span class="p">(</span><span class="nb">sum</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span> <span class="o">/</span> <span class="mi">2</span>


<span class="k">def</span> <span class="nf">sum_test</span><span class="p">(</span><span class="n">steps_data</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">4</span>
    <span class="n">steps_data</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">perc_difference_test</span><span class="p">(</span><span class="n">steps_data</span><span class="p">):</span>
    <span class="n">avg</span> <span class="o">=</span> <span class="n">average_2_nums</span><span class="p">(</span><span class="n">steps_data</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">avg</span> <span class="o">==</span> <span class="mi">2</span>


<span class="nd">@test_steps</span><span class="p">(</span><span class="n">sum_test</span><span class="p">,</span> <span class="n">perc_difference_test</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">test_calc_suite</span><span class="p">(</span><span class="n">test_step</span><span class="p">,</span> <span class="n">steps_data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">test_step</span> <span class="o">==</span> <span class="s1">&#39;sum_test&#39;</span><span class="p">:</span>
        <span class="n">sum_test</span><span class="p">(</span><span class="n">steps_data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">test_step</span> <span class="o">==</span> <span class="s1">&#39;perc_difference_test&#39;</span><span class="p">:</span>
        <span class="n">perc_difference_test</span><span class="p">(</span><span class="n">steps_data</span><span class="p">)</span>

</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest test_steps.py
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">============================= test session starts ==============================</span>
platform darwin -- Python 3.8.10, pytest-7.1.2, pluggy-0.13.1
rootdir: /Users/khuyen/book/Efficient_Python_tricks_and_tools_for_data_scientists/Chapter5
plugins: anyio-3.5.0, steps-1.8.0, typeguard-2.12.1
<span class=" -Color -Color-Bold">collecting ... </span>
<span class=" -Color -Color-Bold">collected 2 items                                                              </span>

test_steps.py <span class=" -Color -Color-Green">..                                                         [100%]</span>

<span class=" -Color -Color-Green">============================== </span><span class=" -Color -Color-Bold -Color-Bold-Green">2 passed</span><span class=" -Color -Color-Green"> in 0.02s ===============================</span>
</pre></div>
</div>
</div>
</div>
<p><a class="reference external" href="https://smarie.github.io/python-pytest-steps/">Link to pytest_steps</a>.</p>
</div>
<div class="section" id="pandera-a-python-library-to-validate-your-pandas-dataframe">
<h2><span class="section-number">6.13.9. </span>Pandera: a Python Library to Validate Your Pandas DataFrame<a class="headerlink" href="#pandera-a-python-library-to-validate-your-pandas-dataframe" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pandera
</pre></div>
</div>
</div>
</div>
<p>The outputs of your pandas DataFrame might not be like what you expected either due to the error in your code or the change in the data format. Using data that is different from what you expected can cause errors or lead to decrease performance.</p>
<p>Thus, it is important to validate your data before using it. A good tool to validate pandas DataFrame is pandera. Pandera is easy to read and use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandera</span> <span class="k">as</span> <span class="nn">pa</span>
<span class="kn">from</span> <span class="nn">pandera</span> <span class="kn">import</span> <span class="n">check_input</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;col1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">],</span> <span class="s2">&quot;col2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;text_1&quot;</span><span class="p">,</span> <span class="s2">&quot;text_2&quot;</span><span class="p">,</span> <span class="s2">&quot;text_3&quot;</span><span class="p">]})</span>
<span class="n">schema</span> <span class="o">=</span> <span class="n">pa</span><span class="o">.</span><span class="n">DataFrameSchema</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;col1&quot;</span><span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="k">lambda</span> <span class="n">minute</span><span class="p">:</span> <span class="mi">5</span> <span class="o">&lt;=</span> <span class="n">minute</span><span class="p">)),</span>
        <span class="s2">&quot;col2&quot;</span><span class="p">:</span> <span class="n">pa</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">pa</span><span class="o">.</span><span class="n">Check</span><span class="o">.</span><span class="n">str_startswith</span><span class="p">(</span><span class="s2">&quot;text_&quot;</span><span class="p">)),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">validated_df</span> <span class="o">=</span> <span class="n">schema</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">validated_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.0</td>
      <td>text_1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.0</td>
      <td>text_2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10.0</td>
      <td>text_3</td>
    </tr>
  </tbody>
</table>
</div></div><script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 40;
                var nbb_unformatted_code = "import pandera as pa\nfrom pandera import check_input\nimport pandas as pd\n\ndf = pd.DataFrame({\"col1\": [5.0, 8.0, 10.0], \"col2\": [\"text_1\", \"text_2\", \"text_3\"]})\nschema = pa.DataFrameSchema(\n    {\n        \"col1\": pa.Column(float, pa.Check(lambda minute: 5 <= minute)),\n        \"col2\": pa.Column(str, pa.Check.str_startswith(\"text_\")),\n    }\n)\nvalidated_df = schema(df)\nvalidated_df";
                var nbb_formatted_code = "import pandera as pa\nfrom pandera import check_input\nimport pandas as pd\n\ndf = pd.DataFrame({\"col1\": [5.0, 8.0, 10.0], \"col2\": [\"text_1\", \"text_2\", \"text_3\"]})\nschema = pa.DataFrameSchema(\n    {\n        \"col1\": pa.Column(float, pa.Check(lambda minute: 5 <= minute)),\n        \"col2\": pa.Column(str, pa.Check.str_startswith(\"text_\")),\n    }\n)\nvalidated_df = schema(df)\nvalidated_df";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>You can also use the pandera‚Äôs decorator check_input to validates input pandas DataFrame before entering the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@check_input</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">plus_three</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;col1_plus_3&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="n">plus_three</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
      <th>col1_plus_3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>5.0</td>
      <td>text_1</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8.0</td>
      <td>text_2</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10.0</td>
      <td>text_3</td>
      <td>13.0</td>
    </tr>
  </tbody>
</table>
</div></div><script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 41;
                var nbb_unformatted_code = "@check_input(schema)\ndef plus_three(df):\n\tdf['col1_plus_3'] = df['col1'] + 3\n\treturn df \n\nplus_three(df)";
                var nbb_formatted_code = "@check_input(schema)\ndef plus_three(df):\n    df[\"col1_plus_3\"] = df[\"col1\"] + 3\n    return df\n\n\nplus_three(df)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p><a class="reference external" href="https://pandera.readthedocs.io/en/stable/">Link to Pandera</a></p>
</div>
<div class="section" id="deepdiff-find-deep-differences-of-python-objects">
<h2><span class="section-number">6.13.10. </span>DeepDiff Find Deep Differences of Python Objects<a class="headerlink" href="#deepdiff-find-deep-differences-of-python-objects" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install deepdiff
</pre></div>
</div>
</div>
</div>
<p>When testing the outputs of your functions, it can be frustrated to see your tests fail because of something you don‚Äôt care too much about such as:</p>
<ul class="simple">
<li><p>order of items in a list</p></li>
<li><p>different ways to specify the same thing such as abbreviation</p></li>
<li><p>exact value up to the last decimal point, etc</p></li>
</ul>
<p>Is there a way that you can exclude certain parts of the object from the comparison? That is when DeepDiff comes in handy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">deepdiff</span> <span class="kn">import</span> <span class="n">DeepDiff</span> 
</pre></div>
</div>
</div>
</div>
<p>DeepDiff can output a meaningful comparison like below:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">price1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;apple&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]}</span>
<span class="n">price2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;apple&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;banana&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}</span>

<span class="n">DeepDiff</span><span class="p">(</span><span class="n">price1</span><span class="p">,</span> <span class="n">price2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;values_changed&#39;: {&quot;root[&#39;banana&#39;][0]&quot;: {&#39;new_value&#39;: 2, &#39;old_value&#39;: 3},
  &quot;root[&#39;banana&#39;][1]&quot;: {&#39;new_value&#39;: 3, &#39;old_value&#39;: 2}}}
</pre></div>
</div>
</div>
</div>
<p>With DeepDiff, you also have full control of which characteristics of the Python object DeepDiff should ignore. In the example below, since the order is ignored <code class="docutils literal notranslate"><span class="pre">[3,</span> <span class="pre">2]</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">[2,</span> <span class="pre">3]</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ignore orders </span>

<span class="n">DeepDiff</span><span class="p">(</span><span class="n">price1</span><span class="p">,</span> <span class="n">price2</span><span class="p">,</span> <span class="n">ignore_order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{}
</pre></div>
</div>
</div>
</div>
<p>We can also exclude certain part of our object from the comparison. In the code below, we ignore <code class="docutils literal notranslate"><span class="pre">ml</span></code> and <code class="docutils literal notranslate"><span class="pre">machine</span> <span class="pre">learning</span></code> since <code class="docutils literal notranslate"><span class="pre">ml</span></code> is a abbreviation of <code class="docutils literal notranslate"><span class="pre">machine</span> <span class="pre">learning</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">experience1</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;machine learning&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">experience2</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ml&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;python&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>

<span class="n">DeepDiff</span><span class="p">(</span>
    <span class="n">experience1</span><span class="p">,</span>
    <span class="n">experience2</span><span class="p">,</span>
    <span class="n">exclude_paths</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;root[&#39;ml&#39;]&quot;</span><span class="p">,</span> <span class="s2">&quot;root[&#39;machine learning&#39;]&quot;</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{}
</pre></div>
</div>
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 25;
                var nbb_unformatted_code = "experience1 = {\"machine learning\": 2, \"python\": 3}\nexperience2 = {\"ml\": 2, \"python\": 3}\n\nDeepDiff(\n    experience1,\n    experience2,\n    exclude_paths={\"root['ml']\", \"root['machine learning']\"},\n)";
                var nbb_formatted_code = "experience1 = {\"machine learning\": 2, \"python\": 3}\nexperience2 = {\"ml\": 2, \"python\": 3}\n\nDeepDiff(\n    experience1,\n    experience2,\n    exclude_paths={\"root['ml']\", \"root['machine learning']\"},\n)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p>Cmpare 2 numbers up to a specific decimal point:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">num1</span> <span class="o">=</span> <span class="mf">0.258</span>
<span class="n">num2</span> <span class="o">=</span> <span class="mf">0.259</span>

<span class="n">DeepDiff</span><span class="p">(</span><span class="n">num1</span><span class="p">,</span> <span class="n">num2</span><span class="p">,</span> <span class="n">significant_digits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{}
</pre></div>
</div>
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 34;
                var nbb_unformatted_code = "num1 = 0.258\nnum2 = 0.259\n\nDeepDiff(num1, num2, significant_digits=2)";
                var nbb_formatted_code = "num1 = 0.258\nnum2 = 0.259\n\nDeepDiff(num1, num2, significant_digits=2)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p><a class="reference external" href="https://github.com/seperman/deepdiff">Link to DeepDiff</a>.</p>
</div>
<div class="section" id="hypothesis-property-based-testing-in-python">
<h2><span class="section-number">6.13.11. </span>hypothesis: Property-based Testing in Python<a class="headerlink" href="#hypothesis-property-based-testing-in-python" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-code docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install hypothesis
</pre></div>
</div>
</div>
</div>
<p>If you want to test some properties or assumptions, it can be cumbersome to write a wide range of scenarios. To automatically run your tests against a wide range of scenarios and find edge cases in your code that you would otherwise have missed, use hypothesis.</p>
<p>In the code below, I test if the addition of two floats is commutative. The test fails when either <code class="docutils literal notranslate"><span class="pre">x</span></code> or <code class="docutils literal notranslate"><span class="pre">y</span></code> is <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># test_hypothesis.py </span>

<span class="kn">from</span> <span class="nn">hypothesis</span> <span class="kn">import</span> <span class="n">given</span>
<span class="kn">from</span> <span class="nn">hypothesis.strategies</span> <span class="kn">import</span> <span class="n">floats</span>



<span class="nd">@given</span><span class="p">(</span><span class="n">floats</span><span class="p">(),</span> <span class="n">floats</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">test_floats_are_commutative</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">==</span> <span class="n">y</span> <span class="o">+</span> <span class="n">x</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest test_hypothesis.py
</pre></div>
</div>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">Test session starts (platform: linux, Python 3.8.10, pytest 6.2.5, pytest-sugar 0.9.4)</span>
benchmark: 3.4.1 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /home/khuyen/book/book/Chapter5
plugins: hydra-core-1.1.1, Faker-8.12.1, benchmark-3.4.1, repeat-0.9.1, anyio-3.3.0, hypothesis-6.31.6, sugar-0.9.4
<span class=" -Color -Color-Bold">collecting ... </span>

‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï test_floats_are_commutative ‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï‚Äï

    <span class=" -Color -Color-White">@given</span>(floats(), floats())
&gt;   def test_floats_are_commutative(x, y):

<span class=" -Color -Color-Bold -Color-Bold-Red">test_hypothesis.py</span>:7: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

x = 0.0, y = nan

    <span class=" -Color -Color-White">@given</span>(floats(), floats())
    def test_floats_are_commutative(x, y):
&gt;       assert x + y == y + x
<span class=" -Color -Color-Bold -Color-Bold-Red">E       assert (0.0 + nan) == (nan + 0.0)</span>

<span class=" -Color -Color-Bold -Color-Bold-Red">test_hypothesis.py</span>:8: AssertionError
---------------------------------- Hypothesis ----------------------------------
Falsifying example: test_floats_are_commutative(
    x=0.0, y=nan,  # Saw 1 signaling NaN
)

 test_hypothesis.py <span class=" -Color -Color-Red">‚®Ø</span>                                            <span class=" -Color -Color-Red">100% </span><span class=" -Color -Color-Red -Color-Red-BGBlack">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span>
=========================== short test summary info ============================
FAILED test_hypothesis.py::test_floats_are_commutative - assert (0.0 + nan) =...

Results (0.38s):
<span class=" -Color -Color-Red">       1 failed</span>
         - test_hypothesis.py:6 <span class=" -Color -Color-Red">test_floats_are_commutative</span>
</pre></div>
</div>
</div>
</div>
<p>Now I can rewrite my code to make it more robust against these edge cases.</p>
<p><a class="reference external" href="https://hypothesis.readthedocs.io/en/latest/quickstart.html">Link to hypothesis</a>.</p>
</div>
<div class="section" id="deepchecks-check-category-mismatch-between-train-and-test-set">
<h2><span class="section-number">6.13.12. </span>Deepchecks: Check Category Mismatch Between Train and Test Set<a class="headerlink" href="#deepchecks-check-category-mismatch-between-train-and-test-set" title="Permalink to this headline">¬∂</a></h2>
<div class="cell tag_hide-cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install deepchecks 
</pre></div>
</div>
</div>
</div>
<p>Sometimes, it is important to know if your test set contains the same categories in the train set. If you want to check the category mismatch between the train and test set, use Deepchecks‚Äôs <code class="docutils literal notranslate"><span class="pre">CategoryMismatchTrainTest</span></code>.</p>
<p>In the example below, the result shows that there are 2 new categories in the test set. They are ‚Äòd‚Äô and ‚Äòe‚Äô.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">deepchecks.checks.integrity.new_category</span> <span class="kn">import</span> <span class="n">CategoryMismatchTrainTest</span>
<span class="kn">from</span> <span class="nn">deepchecks.base</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 18;
                var nbb_unformatted_code = "from deepchecks.checks.integrity.new_category import CategoryMismatchTrainTest\nfrom deepchecks.base import Dataset\nimport pandas as pd";
                var nbb_formatted_code = "from deepchecks.checks.integrity.new_category import CategoryMismatchTrainTest\nfrom deepchecks.base import Dataset\nimport pandas as pd";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;col1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">]})</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;col1&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">]})</span>

<span class="n">train_ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">cat_features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">])</span>
<span class="n">test_ds</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">cat_features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;col1&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 19;
                var nbb_unformatted_code = "train = pd.DataFrame({'col1': ['a', 'b', 'c']})\ntest = pd.DataFrame({'col1': ['c', 'd', 'e']})\n\ntrain_ds = Dataset(train, cat_features=['col1'])\ntest_ds = Dataset(test, cat_features=['col1'])";
                var nbb_formatted_code = "train = pd.DataFrame({\"col1\": [\"a\", \"b\", \"c\"]})\ntest = pd.DataFrame({\"col1\": [\"c\", \"d\", \"e\"]})\n\ntrain_ds = Dataset(train, cat_features=[\"col1\"])\ntest_ds = Dataset(test, cat_features=[\"col1\"])";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">CategoryMismatchTrainTest</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">test_ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><h4>Category Mismatch Train Test</h4><p>Find new categories in the test set.</p><h5>Additional Outputs</h5><style type="text/css">
#T_1a4e2_ table {
  text-align: left;
  white-space: pre-wrap;
}
#T_1a4e2_ thead {
  text-align: left;
  white-space: pre-wrap;
}
#T_1a4e2_ tbody {
  text-align: left;
  white-space: pre-wrap;
}
#T_1a4e2_ th {
  text-align: left;
  white-space: pre-wrap;
}
#T_1a4e2_ td {
  text-align: left;
  white-space: pre-wrap;
}
</style>
<table id="T_1a4e2_">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >Number of new categories</th>
      <th class="col_heading level0 col1" >Percent of new categories in sample</th>
      <th class="col_heading level0 col2" >New categories examples</th>
    </tr>
    <tr>
      <th class="index_name level0" >Column</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_1a4e2_level0_row0" class="row_heading level0 row0" >col1</th>
      <td id="T_1a4e2_row0_col0" class="data row0 col0" >2</td>
      <td id="T_1a4e2_row0_col1" class="data row0 col1" >66.67%</td>
      <td id="T_1a4e2_row0_col2" class="data row0 col2" >['d', 'e']</td>
    </tr>
  </tbody>
</table>
</div><script type="application/javascript">
            setTimeout(function() {
                var nbb_cell_id = 22;
                var nbb_unformatted_code = "CategoryMismatchTrainTest().run(train_ds, test_ds)";
                var nbb_formatted_code = "CategoryMismatchTrainTest().run(train_ds, test_ds)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);
            </script></div>
</div>
<p><a class="reference external" href="https://docs.deepchecks.com/en/stable/">Link to Deepchecks</a></p>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./Chapter5"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="better_pandas.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title"><span class="section-number">6.12. </span>Better Pandas</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../Chapter6/Chapter6.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Cool Tools</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Khuyen Tran<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>